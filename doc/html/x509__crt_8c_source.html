<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>even-network: prerequisites/c-libp2p/thirdparty/mbedtls/x509_crt.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="2018-12-27 at 10-36-23.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">even-network
   </div>
   <div id="projectbrief">EVEN Network â€” is an open cross-chain platform with EVEN cryptocurrency that allows users to interact with more than one blockchain at a time.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0dc8670ce003965ad6657bffb381fe41.html">prerequisites</a></li><li class="navelem"><a class="el" href="dir_d3dc2089ddf61d8be1e3bff92bba4632.html">c-libp2p</a></li><li class="navelem"><a class="el" href="dir_3cc4b7e6e8cb3f4ecac6acb546e524a7.html">thirdparty</a></li><li class="navelem"><a class="el" href="dir_e89f8300491e216f523c46c748afd590.html">mbedtls</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">x509_crt.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  X.509 certificate parsing and verification</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Copyright (C) 2006-2015, ARM Limited, All Rights Reserved</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  SPDX-License-Identifier: Apache-2.0</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *  not use this file except in compliance with the License.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *  You may obtain a copy of the License at</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *  http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *  See the License for the specific language governing permissions and</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *  limitations under the License.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *  This file is part of mbed TLS (https://tls.mbed.org)</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *  The ITU-T X.509 standard defines a certificate format for PKI.</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *  http://www.ietf.org/rfc/rfc5280.txt (Certificates and CRLs)</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *  http://www.ietf.org/rfc/rfc3279.txt (Alg IDs for CRLs)</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> *  http://www.ietf.org/rfc/rfc2986.txt (CSRs, aka PKCS#10)</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *  http://www.itu.int/ITU-T/studygroups/com17/languages/X.680-0207.pdf</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *  http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#if !defined(MBEDTLS_CONFIG_FILE)</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;mbedtls/config.h&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include MBEDTLS_CONFIG_FILE</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_X509_CRT_PARSE_C)</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="x509__crt_8h.html">mbedtls/x509_crt.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="oid_8h.html">mbedtls/oid.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_PEM_PARSE_C)</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;mbedtls/pem.h&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_PLATFORM_C)</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="platform_8h.html">mbedtls/platform.h</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#define mbedtls_free       free</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#define mbedtls_calloc    calloc</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#define mbedtls_snprintf   snprintf</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_THREADING_C)</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="threading_8h.html">mbedtls/threading.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#if defined(_WIN32) &amp;&amp; !defined(EFIX64) &amp;&amp; !defined(EFI32)</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &lt;windows.h&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_FS_IO)</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#if !defined(_WIN32) || defined(EFIX64) || defined(EFI32)</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &lt;sys/types.h&gt;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &lt;dirent.h&gt;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !_WIN32 || EFIX64 || EFI32 */</span><span class="preprocessor"></span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">/* Implementation that should never be optimized out by the compiler */</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> mbedtls_zeroize( <span class="keywordtype">void</span> *v, <span class="keywordtype">size_t</span> n ) {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p = v; <span class="keywordflow">while</span>( n-- ) *p++ = 0;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> * Default profile</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> <a class="code" href="group__x509__module.html#ga9cd2de10ffeff0f339abcc1ba7e26fdf">mbedtls_x509_crt_profile_default</a> =</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;{</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">/* Hashes from SHA-1 and above */</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA1 ) |</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_RIPEMD160 ) |</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA224 ) |</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA256 ) |</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA384 ) |</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA512 ),</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    0xFFFFFFF, <span class="comment">/* Any PK alg    */</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    0xFFFFFFF, <span class="comment">/* Any curve     */</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    2048,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;};</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"> * Next-default profile</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> <a class="code" href="group__x509__module.html#ga8ab1f8a044fd25f76ecb4ba15c6d5bcd">mbedtls_x509_crt_profile_next</a> =</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;{</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">/* Hashes from SHA-256 and above */</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA256 ) |</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA384 ) |</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA512 ),</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    0xFFFFFFF, <span class="comment">/* Any PK alg    */</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_ECP_C)</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">/* Curves at or above 128-bit security level */</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2daf73bbf7b29d26a0bc77dcff47cd6b276">MBEDTLS_ECP_DP_SECP256R1</a> ) |</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2da08d0615820297b8c90f8ec7cbd88f641">MBEDTLS_ECP_DP_SECP384R1</a> ) |</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2daaa2d9d42df56aab024ef760ee9dffca2">MBEDTLS_ECP_DP_SECP521R1</a> ) |</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2dade9d3762e81c6e1d6e499d21e8190be5">MBEDTLS_ECP_DP_BP256R1</a> ) |</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2daaf562eeec4368f2c501c163b4707900a">MBEDTLS_ECP_DP_BP384R1</a> ) |</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2da803c5f7c0d68be4556a688746be1c9e1">MBEDTLS_ECP_DP_BP512R1</a> ) |</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2da6de9f87d43d7c29c7f91e9986ccfc25f">MBEDTLS_ECP_DP_SECP256K1</a> ),</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    0,</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    2048,</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;};</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"> * NSA Suite B Profile</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> <a class="code" href="group__x509__module.html#gaf09067a39129236125e353a68ceb45d6">mbedtls_x509_crt_profile_suiteb</a> =</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;{</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">/* Only SHA-256 and 384 */</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA256 ) |</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_MD_SHA384 ),</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">/* Only ECDSA */</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( MBEDTLS_PK_ECDSA ),</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_ECP_C)</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">/* Only NIST P-256 and P-384 */</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2daf73bbf7b29d26a0bc77dcff47cd6b276">MBEDTLS_ECP_DP_SECP256R1</a> ) |</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2da08d0615820297b8c90f8ec7cbd88f641">MBEDTLS_ECP_DP_SECP384R1</a> ),</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    0,</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    0,</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;};</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment"> * Check md_alg against profile</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"> * Return 0 if md_alg acceptable for this profile, -1 otherwise</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_profile_check_md_alg( <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> *profile,</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                      mbedtls_md_type_t md_alg )</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;{</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span>( ( profile-&gt;<a class="code" href="structmbedtls__x509__crt__profile.html#a1251640211d47c8e4b80b99d5b178685">allowed_mds</a> &amp; <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( md_alg ) ) != 0 )</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;}</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment"> * Check pk_alg against profile</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment"> * Return 0 if pk_alg acceptable for this profile, -1 otherwise</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_profile_check_pk_alg( <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> *profile,</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                                      <a class="code" href="pk_8h.html#a3fe41eff5605ae727eb9d28dad297020">mbedtls_pk_type_t</a> pk_alg )</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;{</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">if</span>( ( profile-&gt;<a class="code" href="structmbedtls__x509__crt__profile.html#a13cba76eca3f0bce8a93b8f59fe69370">allowed_pks</a> &amp; <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( pk_alg ) ) != 0 )</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment"> * Check key against profile</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment"> * Return 0 if pk_alg acceptable for this profile, -1 otherwise</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_profile_check_key( <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> *profile,</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                   <a class="code" href="pk_8h.html#a3fe41eff5605ae727eb9d28dad297020">mbedtls_pk_type_t</a> pk_alg,</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="structmbedtls__pk__context.html">mbedtls_pk_context</a> *pk )</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;{</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_RSA_C)</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span>( pk_alg == MBEDTLS_PK_RSA || pk_alg == MBEDTLS_PK_RSASSA_PSS )</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="pk_8h.html#a4a31083a590b155dd54d22cf618eefcc">mbedtls_pk_get_bitlen</a>( pk ) &gt;= profile-&gt;<a class="code" href="structmbedtls__x509__crt__profile.html#a094e9eb35ed5e9a16b67d2e8bd97e83c">rsa_min_bitlen</a> )</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_ECP_C)</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">if</span>( pk_alg == MBEDTLS_PK_ECDSA ||</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        pk_alg == MBEDTLS_PK_ECKEY ||</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        pk_alg == MBEDTLS_PK_ECKEY_DH )</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <a class="code" href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2d">mbedtls_ecp_group_id</a> gid = mbedtls_pk_ec( *pk )-&gt;grp.id;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">if</span>( ( profile-&gt;<a class="code" href="structmbedtls__x509__crt__profile.html#a8149f4d17f3f465e2255f5af997e4c8e">allowed_curves</a> &amp; <a class="code" href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a>( gid ) ) != 0 )</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;}</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment"> *  Version  ::=  INTEGER  {  v1(0), v2(1), v3(2)  }</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_get_version( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **p,</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                             <span class="keywordtype">int</span> *ver )</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;{</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordtype">size_t</span> len;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( p, end, &amp;len,</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            MBEDTLS_ASN1_CONTEXT_SPECIFIC | MBEDTLS_ASN1_CONSTRUCTED | 0 ) ) != 0 )</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keywordflow">if</span>( ret == <a class="code" href="group__asn1__module.html#gab055945fda47ad0e16dc59f8c5ecb86e">MBEDTLS_ERR_ASN1_UNEXPECTED_TAG</a> )</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            *ver = 0;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    end = *p + len;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#a7f8a8b447c11f2200cc5aa8033801b72">mbedtls_asn1_get_int</a>( p, end, ver ) ) != 0 )</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga527608dc04b2c831fe5b161ec26aab76">MBEDTLS_ERR_X509_INVALID_VERSION</a> + ret );</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span>( *p != end )</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga527608dc04b2c831fe5b161ec26aab76">MBEDTLS_ERR_X509_INVALID_VERSION</a> +</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"> *  Validity ::= SEQUENCE {</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"> *       notBefore      Time,</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"> *       notAfter       Time }</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_get_dates( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **p,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end,</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                           <a class="code" href="structmbedtls__x509__time.html">mbedtls_x509_time</a> *from,</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                           <a class="code" href="structmbedtls__x509__time.html">mbedtls_x509_time</a> *to )</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;{</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordtype">size_t</span> len;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( p, end, &amp;len,</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            MBEDTLS_ASN1_CONSTRUCTED | MBEDTLS_ASN1_SEQUENCE ) ) != 0 )</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gac36bf085ce8f7f57f039bda8828bd824">MBEDTLS_ERR_X509_INVALID_DATE</a> + ret );</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    end = *p + len;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_x509_get_time( p, end, from ) ) != 0 )</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_x509_get_time( p, end, to ) ) != 0 )</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span>( *p != end )</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gac36bf085ce8f7f57f039bda8828bd824">MBEDTLS_ERR_X509_INVALID_DATE</a> +</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment"> * X.509 v2/v3 unique identifier (not parsed)</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_get_uid( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **p,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end,</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                         <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> *uid, <span class="keywordtype">int</span> n )</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;{</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span>( *p == end )</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    uid-&gt;<a class="code" href="structmbedtls__asn1__buf.html#abcca2df9a773acd5b59831ac55993dd1">tag</a> = **p;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( p, end, &amp;uid-&gt;<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a>,</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            MBEDTLS_ASN1_CONTEXT_SPECIFIC | MBEDTLS_ASN1_CONSTRUCTED | n ) ) != 0 )</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">if</span>( ret == <a class="code" href="group__asn1__module.html#gab055945fda47ad0e16dc59f8c5ecb86e">MBEDTLS_ERR_ASN1_UNEXPECTED_TAG</a> )</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    uid-&gt;<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> = *p;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    *p += uid-&gt;<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_get_basic_constraints( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **p,</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end,</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                                       <span class="keywordtype">int</span> *ca_istrue,</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                                       <span class="keywordtype">int</span> *max_pathlen )</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;{</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordtype">size_t</span> len;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">     * BasicConstraints ::= SEQUENCE {</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">     *      cA                      BOOLEAN DEFAULT FALSE,</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">     *      pathLenConstraint       INTEGER (0..MAX) OPTIONAL }</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    *ca_istrue = 0; <span class="comment">/* DEFAULT FALSE */</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    *max_pathlen = 0; <span class="comment">/* endless */</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( p, end, &amp;len,</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            MBEDTLS_ASN1_CONSTRUCTED | MBEDTLS_ASN1_SEQUENCE ) ) != 0 )</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">if</span>( *p == end )</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#aec9e4bbd8690a8ab17cabf87893dbd2b">mbedtls_asn1_get_bool</a>( p, end, ca_istrue ) ) != 0 )</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">if</span>( ret == <a class="code" href="group__asn1__module.html#gab055945fda47ad0e16dc59f8c5ecb86e">MBEDTLS_ERR_ASN1_UNEXPECTED_TAG</a> )</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            ret = <a class="code" href="asn1_8h.html#a7f8a8b447c11f2200cc5aa8033801b72">mbedtls_asn1_get_int</a>( p, end, ca_istrue );</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">if</span>( *ca_istrue != 0 )</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            *ca_istrue = 1;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">if</span>( *p == end )</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#a7f8a8b447c11f2200cc5aa8033801b72">mbedtls_asn1_get_int</a>( p, end, max_pathlen ) ) != 0 )</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span>( *p != end )</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    (*max_pathlen)++;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;}</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_get_ns_cert_type( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **p,</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end,</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ns_cert_type)</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;{</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <a class="code" href="structmbedtls__asn1__bitstring.html">mbedtls_x509_bitstring</a> bs = { 0, 0, NULL };</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae2dcf021cf1326b62e2f23aa3bda69d0">mbedtls_asn1_get_bitstring</a>( p, end, &amp;bs ) ) != 0 )</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span>( bs.<a class="code" href="structmbedtls__asn1__bitstring.html#a943b4155650f680f3906ca9be0e66f80">len</a> != 1 )</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                <a class="code" href="group__asn1__module.html#ga0ebe8e0a4894533db505303504eea59b">MBEDTLS_ERR_ASN1_INVALID_LENGTH</a> );</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">/* Get actual bitstring */</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    *ns_cert_type = *bs.<a class="code" href="structmbedtls__asn1__bitstring.html#af09328f8b1a8cb5bf4afae369ce3629c">p</a>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_get_key_usage( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **p,</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end,</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *key_usage)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;{</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordtype">size_t</span> i;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="structmbedtls__asn1__bitstring.html">mbedtls_x509_bitstring</a> bs = { 0, 0, NULL };</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae2dcf021cf1326b62e2f23aa3bda69d0">mbedtls_asn1_get_bitstring</a>( p, end, &amp;bs ) ) != 0 )</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">if</span>( bs.<a class="code" href="structmbedtls__asn1__bitstring.html#a943b4155650f680f3906ca9be0e66f80">len</a> &lt; 1 )</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                <a class="code" href="group__asn1__module.html#ga0ebe8e0a4894533db505303504eea59b">MBEDTLS_ERR_ASN1_INVALID_LENGTH</a> );</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">/* Get actual bitstring */</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    *key_usage = 0;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">for</span>( i = 0; i &lt; bs.<a class="code" href="structmbedtls__asn1__bitstring.html#a943b4155650f680f3906ca9be0e66f80">len</a> &amp;&amp; i &lt; <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> int ); i++ )</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        *key_usage |= (<span class="keywordtype">unsigned</span> int) bs.<a class="code" href="structmbedtls__asn1__bitstring.html#af09328f8b1a8cb5bf4afae369ce3629c">p</a>[i] &lt;&lt; (8*i);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment"> * ExtKeyUsageSyntax ::= SEQUENCE SIZE (1..MAX) OF KeyPurposeId</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment"> * KeyPurposeId ::= OBJECT IDENTIFIER</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_get_ext_key_usage( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **p,</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                               <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *ext_key_usage)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;{</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#a872d62128956b3574bb0e681536c0d6b">mbedtls_asn1_get_sequence_of</a>( p, end, ext_key_usage, MBEDTLS_ASN1_OID ) ) != 0 )</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">/* Sequence length must be &gt;= 1 */</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span>( ext_key_usage-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> == NULL )</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                <a class="code" href="group__asn1__module.html#ga0ebe8e0a4894533db505303504eea59b">MBEDTLS_ERR_ASN1_INVALID_LENGTH</a> );</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;}</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"> * SubjectAltName ::= GeneralNames</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment"> * GeneralNames ::= SEQUENCE SIZE (1..MAX) OF GeneralName</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment"> * GeneralName ::= CHOICE {</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"> *      otherName                       [0]     OtherName,</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"> *      rfc822Name                      [1]     IA5String,</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment"> *      dNSName                         [2]     IA5String,</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"> *      x400Address                     [3]     ORAddress,</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"> *      directoryName                   [4]     Name,</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"> *      ediPartyName                    [5]     EDIPartyName,</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"> *      uniformResourceIdentifier       [6]     IA5String,</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"> *      iPAddress                       [7]     OCTET STRING,</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"> *      registeredID                    [8]     OBJECT IDENTIFIER }</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> * OtherName ::= SEQUENCE {</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment"> *      type-id    OBJECT IDENTIFIER,</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"> *      value      [0] EXPLICIT ANY DEFINED BY type-id }</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> * EDIPartyName ::= SEQUENCE {</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"> *      nameAssigner            [0]     DirectoryString OPTIONAL,</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"> *      partyName               [1]     DirectoryString }</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"> * NOTE: we only parse and use dNSName at this point.</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_get_subject_alt_name( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **p,</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end,</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                                      <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *subject_alt_name )</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;{</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordtype">size_t</span> len, tag_len;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_asn1_buf</a> *buf;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tag;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_asn1_sequence</a> *cur = subject_alt_name;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">/* Get main sequence tag */</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( p, end, &amp;len,</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            MBEDTLS_ASN1_CONSTRUCTED | MBEDTLS_ASN1_SEQUENCE ) ) != 0 )</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span>( *p + len != end )</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">while</span>( *p &lt; end )</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordflow">if</span>( ( end - *p ) &lt; 1 )</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                    <a class="code" href="group__asn1__module.html#ga284c12cf03a4ffeee89a63750f00dfdd">MBEDTLS_ERR_ASN1_OUT_OF_DATA</a> );</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        tag = **p;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        (*p)++;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ad45c1d0ed3694fe903342cb32647bfb1">mbedtls_asn1_get_len</a>( p, end, &amp;tag_len ) ) != 0 )</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">if</span>( ( tag &amp; MBEDTLS_ASN1_CONTEXT_SPECIFIC ) != MBEDTLS_ASN1_CONTEXT_SPECIFIC )</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                    <a class="code" href="group__asn1__module.html#gab055945fda47ad0e16dc59f8c5ecb86e">MBEDTLS_ERR_ASN1_UNEXPECTED_TAG</a> );</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="comment">/* Skip everything but DNS name */</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">if</span>( tag != ( MBEDTLS_ASN1_CONTEXT_SPECIFIC | 2 ) )</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            *p += tag_len;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="comment">/* Allocate and assign next pointer */</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">if</span>( cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> != NULL )</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="keywordflow">if</span>( cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a> != NULL )</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> );</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a> = mbedtls_calloc( 1, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_asn1_sequence</a> ) );</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keywordflow">if</span>( cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a> == NULL )</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                        <a class="code" href="group__asn1__module.html#gab7d40360e48e414ffa1a4df1961723d2">MBEDTLS_ERR_ASN1_ALLOC_FAILED</a> );</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            cur = cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a>;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        buf = &amp;(cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        buf-&gt;tag = tag;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        buf-&gt;p = *p;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        buf-&gt;len = tag_len;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        *p += buf-&gt;len;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">/* Set final sequence entry&#39;s next pointer to NULL */</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a> = NULL;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span>( *p != end )</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment"> * X.509 v3 extensions</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_get_crt_ext( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **p,</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end,</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                             <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt )</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;{</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordtype">size_t</span> len;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end_ext_data, *end_ext_octet;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_x509_get_ext( p, end, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a6baebf9741097506a60521fbcaf5996b">v3_ext</a>, 3 ) ) != 0 )</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="keywordflow">if</span>( ret == <a class="code" href="group__asn1__module.html#gab055945fda47ad0e16dc59f8c5ecb86e">MBEDTLS_ERR_ASN1_UNEXPECTED_TAG</a> )</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">while</span>( *p &lt; end )</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">         * Extension  ::=  SEQUENCE  {</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">         *      extnID      OBJECT IDENTIFIER,</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">         *      critical    BOOLEAN DEFAULT FALSE,</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">         *      extnValue   OCTET STRING  }</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> extn_oid = {0, 0, NULL};</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordtype">int</span> is_critical = 0; <span class="comment">/* DEFAULT FALSE */</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordtype">int</span> ext_type = 0;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( p, end, &amp;len,</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                MBEDTLS_ASN1_CONSTRUCTED | MBEDTLS_ASN1_SEQUENCE ) ) != 0 )</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        end_ext_data = *p + len;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="comment">/* Get extension ID */</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        extn_oid.<a class="code" href="structmbedtls__asn1__buf.html#abcca2df9a773acd5b59831ac55993dd1">tag</a> = **p;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( p, end, &amp;extn_oid.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a>, MBEDTLS_ASN1_OID ) ) != 0 )</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        extn_oid.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> = *p;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        *p += extn_oid.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keywordflow">if</span>( ( end - *p ) &lt; 1 )</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                    <a class="code" href="group__asn1__module.html#ga284c12cf03a4ffeee89a63750f00dfdd">MBEDTLS_ERR_ASN1_OUT_OF_DATA</a> );</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="comment">/* Get optional critical */</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#aec9e4bbd8690a8ab17cabf87893dbd2b">mbedtls_asn1_get_bool</a>( p, end_ext_data, &amp;is_critical ) ) != 0 &amp;&amp;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            ( ret != <a class="code" href="group__asn1__module.html#gab055945fda47ad0e16dc59f8c5ecb86e">MBEDTLS_ERR_ASN1_UNEXPECTED_TAG</a> ) )</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="comment">/* Data should be octet string type */</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( p, end_ext_data, &amp;len,</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                MBEDTLS_ASN1_OCTET_STRING ) ) != 0 )</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> + ret );</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        end_ext_octet = *p + len;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">if</span>( end_ext_octet != end_ext_data )</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                    <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">         * Detect supported extensions</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        ret = <a class="code" href="oid_8h.html#a962c76f60bc09ae7174027f8d4111753">mbedtls_oid_get_x509_ext_type</a>( &amp;extn_oid, &amp;ext_type );</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="comment">/* No parser found, skip extension */</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            *p = end_ext_octet;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor">#if !defined(MBEDTLS_X509_ALLOW_UNSUPPORTED_CRITICAL_EXTENSION)</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            <span class="keywordflow">if</span>( is_critical )</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <span class="comment">/* Data is marked as critical: fail */</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                        <a class="code" href="group__asn1__module.html#gab055945fda47ad0e16dc59f8c5ecb86e">MBEDTLS_ERR_ASN1_UNEXPECTED_TAG</a> );</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            }</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="comment">/* Forbid repeated extensions */</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="keywordflow">if</span>( ( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> &amp; ext_type ) != 0 )</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> );</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> |= ext_type;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">switch</span>( ext_type )</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">case</span> MBEDTLS_X509_EXT_BASIC_CONSTRAINTS:</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <span class="comment">/* Parse basic constraints */</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            <span class="keywordflow">if</span>( ( ret = x509_get_basic_constraints( p, end_ext_octet,</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                    &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a196b3a43dae5a1c0058f46075f832890">ca_istrue</a>, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ab0af43652f426ace28052ec47fdde6fb">max_pathlen</a> ) ) != 0 )</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">case</span> MBEDTLS_X509_EXT_KEY_USAGE:</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            <span class="comment">/* Parse key usage */</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">if</span>( ( ret = x509_get_key_usage( p, end_ext_octet,</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                    &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a3b7650600aa6e637b8ab534a938aee94">key_usage</a> ) ) != 0 )</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">case</span> MBEDTLS_X509_EXT_EXTENDED_KEY_USAGE:</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="comment">/* Parse extended key usage */</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">if</span>( ( ret = x509_get_ext_key_usage( p, end_ext_octet,</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                    &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac94f7360a7143ce1b983fab46c34dcf2">ext_key_usage</a> ) ) != 0 )</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keywordflow">case</span> MBEDTLS_X509_EXT_SUBJECT_ALT_NAME:</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="comment">/* Parse subject alt name */</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="keywordflow">if</span>( ( ret = x509_get_subject_alt_name( p, end_ext_octet,</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                    &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a1f148e8fb52e03e2604e716386a07df4">subject_alt_names</a> ) ) != 0 )</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="keywordflow">case</span> MBEDTLS_X509_EXT_NS_CERT_TYPE:</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <span class="comment">/* Parse netscape certificate type */</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="keywordflow">if</span>( ( ret = x509_get_ns_cert_type( p, end_ext_octet,</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                    &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#adc36c60aa279fae8bd35a20b9c2bba22">ns_cert_type</a> ) ) != 0 )</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga185bc7f27a2b1f7742537a2377c52ee3">MBEDTLS_ERR_X509_FEATURE_UNAVAILABLE</a> );</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    }</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">if</span>( *p != end )</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a> +</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;}</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment"> * Parse and fill a single X.509 certificate in DER format</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_crt_parse_der_core( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf,</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                                    <span class="keywordtype">size_t</span> buflen )</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;{</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordtype">size_t</span> len;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p, *end, *crt_end;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> sig_params1, sig_params2, sig_oid2;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    memset( &amp;sig_params1, 0, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> ) );</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    memset( &amp;sig_params2, 0, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> ) );</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    memset( &amp;sig_oid2, 0, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> ) );</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">     * Check for valid input</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">if</span>( crt == NULL || buf == NULL )</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a> );</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">// Use the original buffer until we figure out actual length</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    p = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) buf;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    len = buflen;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    end = p + len;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">     * Certificate  ::=  SEQUENCE  {</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">     *      tbsCertificate       TBSCertificate,</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">     *      signatureAlgorithm   AlgorithmIdentifier,</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">     *      signatureValue       BIT STRING  }</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( &amp;p, end, &amp;len,</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            MBEDTLS_ASN1_CONSTRUCTED | MBEDTLS_ASN1_SEQUENCE ) ) != 0 )</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga45b8366804b7e2cbf3e25011f054802c">MBEDTLS_ERR_X509_INVALID_FORMAT</a> );</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">if</span>( len &gt; (<span class="keywordtype">size_t</span>) ( end - p ) )</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga45b8366804b7e2cbf3e25011f054802c">MBEDTLS_ERR_X509_INVALID_FORMAT</a> +</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    crt_end = p + len;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// Create and populate a new buffer for the raw field</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> = crt_end - buf;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> = p = mbedtls_calloc( 1, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> );</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span>( p == NULL )</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gacf6d98c6cbb76728260d1dcb1fe3bc7d">MBEDTLS_ERR_X509_ALLOC_FAILED</a> );</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    memcpy( p, buf, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> );</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">// Direct pointers to the new buffer </span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    p += crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> - len;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    end = crt_end = p + len;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">     * TBSCertificate  ::=  SEQUENCE  {</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a44e9a884baad5737ef0930af94ca3f94">tbs</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> = p;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( &amp;p, end, &amp;len,</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            MBEDTLS_ASN1_CONSTRUCTED | MBEDTLS_ASN1_SEQUENCE ) ) != 0 )</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga45b8366804b7e2cbf3e25011f054802c">MBEDTLS_ERR_X509_INVALID_FORMAT</a> + ret );</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    end = p + len;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a44e9a884baad5737ef0930af94ca3f94">tbs</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> = end - crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a44e9a884baad5737ef0930af94ca3f94">tbs</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">     * Version  ::=  INTEGER  {  v1(0), v2(1), v3(2)  }</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">     * CertificateSerialNumber  ::=  INTEGER</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">     * signature            AlgorithmIdentifier</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">if</span>( ( ret = x509_get_version(  &amp;p, end, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a>  ) ) != 0 ||</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        ( ret = mbedtls_x509_get_serial(   &amp;p, end, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c3ae8b4aba6e1c40cb1f6a85da36116">serial</a>   ) ) != 0 ||</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        ( ret = mbedtls_x509_get_alg(      &amp;p, end, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a128c3a665ffdce696b402435a74e97aa">sig_oid</a>,</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                                            &amp;sig_params1 ) ) != 0 )</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    {</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    }</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a>++;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a> &gt; 3 )</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    {</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gab80a4eb806328731def21ec2ebcbc365">MBEDTLS_ERR_X509_UNKNOWN_VERSION</a> );</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_x509_get_sig_alg( &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a128c3a665ffdce696b402435a74e97aa">sig_oid</a>, &amp;sig_params1,</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                                  &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c56937aaf2a51a1d8bc814b142734ca">sig_md</a>, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a65d5d20352a08c77e173808fde1f8660">sig_pk</a>,</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                                  &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a67c497ed6535050997c014507a866e9e">sig_opts</a> ) ) != 0 )</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    {</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">     * issuer               Name</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#afb876a6a7b85e160620c4549324d9e8d">issuer_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> = p;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( &amp;p, end, &amp;len,</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            MBEDTLS_ASN1_CONSTRUCTED | MBEDTLS_ASN1_SEQUENCE ) ) != 0 )</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga45b8366804b7e2cbf3e25011f054802c">MBEDTLS_ERR_X509_INVALID_FORMAT</a> + ret );</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_x509_get_name( &amp;p, p + len, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ade48d67edd24629e28361d3fbc0aafd9">issuer</a> ) ) != 0 )</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#afb876a6a7b85e160620c4549324d9e8d">issuer_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> = p - crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#afb876a6a7b85e160620c4549324d9e8d">issuer_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">     * Validity ::= SEQUENCE {</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">     *      notBefore      Time,</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">     *      notAfter       Time }</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">if</span>( ( ret = x509_get_dates( &amp;p, end, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a>,</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                                         &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a> ) ) != 0 )</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    {</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    }</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">     * subject              Name</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> = p;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a>( &amp;p, end, &amp;len,</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            MBEDTLS_ASN1_CONSTRUCTED | MBEDTLS_ASN1_SEQUENCE ) ) != 0 )</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    {</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga45b8366804b7e2cbf3e25011f054802c">MBEDTLS_ERR_X509_INVALID_FORMAT</a> + ret );</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordflow">if</span>( len &amp;&amp; ( ret = mbedtls_x509_get_name( &amp;p, p + len, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a773e92423092ab65e5e50031bd9663a5">subject</a> ) ) != 0 )</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> = p - crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">     * SubjectPublicKeyInfo</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span>( ( ret = <a class="code" href="pk_8h.html#a261a06b48443981316e19bd1c2c377f9">mbedtls_pk_parse_subpubkey</a>( &amp;p, end, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a> ) ) != 0 )</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    {</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    }</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">     *  issuerUniqueID  [1]  IMPLICIT UniqueIdentifier OPTIONAL,</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment">     *                       -- If present, version shall be v2 or v3</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment">     *  subjectUniqueID [2]  IMPLICIT UniqueIdentifier OPTIONAL,</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">     *                       -- If present, version shall be v2 or v3</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">     *  extensions      [3]  EXPLICIT Extensions OPTIONAL</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">     *                       -- If present, version shall be v3</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a> == 2 || crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a> == 3 )</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        ret = x509_get_uid( &amp;p, end, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a6bb2a7142b718fa43b948770ccc98dcd">issuer_id</a>,  1 );</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        }</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    }</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a> == 2 || crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a> == 3 )</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        ret = x509_get_uid( &amp;p, end, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#adbbaba207a103a73f41b4b72ffc540f5">subject_id</a>,  2 );</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="preprocessor">#if !defined(MBEDTLS_X509_ALLOW_EXTENSIONS_NON_V3)</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a> == 3 )</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        ret = x509_get_crt_ext( &amp;p, end, crt );</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        }</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    }</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="keywordflow">if</span>( p != end )</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    {</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga45b8366804b7e2cbf3e25011f054802c">MBEDTLS_ERR_X509_INVALID_FORMAT</a> +</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    end = crt_end;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">     *  }</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment">     *  -- end of TBSCertificate</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">     *  signatureAlgorithm   AlgorithmIdentifier,</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">     *  signatureValue       BIT STRING</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_x509_get_alg( &amp;p, end, &amp;sig_oid2, &amp;sig_params2 ) ) != 0 )</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a128c3a665ffdce696b402435a74e97aa">sig_oid</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> != sig_oid2.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ||</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        memcmp( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a128c3a665ffdce696b402435a74e97aa">sig_oid</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, sig_oid2.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a128c3a665ffdce696b402435a74e97aa">sig_oid</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) != 0 ||</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        sig_params1.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> != sig_params2.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ||</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        ( sig_params1.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> != 0 &amp;&amp;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;          memcmp( sig_params1.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, sig_params2.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, sig_params1.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) != 0 ) )</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gac489ce5e8ba417bcd86012ebbb7f5044">MBEDTLS_ERR_X509_SIG_MISMATCH</a> );</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_x509_get_sig( &amp;p, end, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#aea76ebaa8c8e23129bd905cdc0242a3a">sig</a> ) ) != 0 )</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    }</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">if</span>( p != end )</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    {</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( crt );</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#ga45b8366804b7e2cbf3e25011f054802c">MBEDTLS_ERR_X509_INVALID_FORMAT</a> +</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                <a class="code" href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a> );</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    }</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;}</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment"> * Parse one X.509 certificate in DER format from a buffer and add them to a</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment"> * chained list</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#ga003c2483a2691e025641fa9d68d4a96a">mbedtls_x509_crt_parse_der</a>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *chain, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf,</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                        <span class="keywordtype">size_t</span> buflen )</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;{</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt = chain, *prev = NULL;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">     * Check for valid input</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">if</span>( crt == NULL || buf == NULL )</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a> );</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">while</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a> != 0 &amp;&amp; crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a> != NULL )</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    {</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        prev = crt;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        crt = crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a>;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    }</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">     * Add new certificate on the end of the chain if needed.</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a> != 0 &amp;&amp; crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a> == NULL )</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    {</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a> = mbedtls_calloc( 1, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> ) );</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a> == NULL )</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gacf6d98c6cbb76728260d1dcb1fe3bc7d">MBEDTLS_ERR_X509_ALLOC_FAILED</a> );</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        prev = crt;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <a class="code" href="group__x509__module.html#ga016dd06bc770e77b84005f305df20ed1">mbedtls_x509_crt_init</a>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a> );</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        crt = crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a>;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">if</span>( ( ret = x509_crt_parse_der_core( crt, buf, buflen ) ) != 0 )</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    {</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordflow">if</span>( prev )</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            prev-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a> = NULL;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="keywordflow">if</span>( crt != chain )</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            mbedtls_free( crt );</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;}</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment"> * Parse one or more PEM certificates from a buffer and add them to the chained</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment"> * list</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#ga033567483649030f7f859db4f4cb7e14">mbedtls_x509_crt_parse</a>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *chain, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> buflen )</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;{</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordtype">int</span> success = 0, first_error = 0, total_failed = 0;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_PEM_PARSE_C)</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordtype">int</span> buf_format = MBEDTLS_X509_FORMAT_DER;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">     * Check for valid input</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordflow">if</span>( chain == NULL || buf == NULL )</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a> );</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">     * Determine buffer content. Buffer contains either one DER certificate or</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">     * one or more PEM certificates.</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_PEM_PARSE_C)</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">if</span>( buflen != 0 &amp;&amp; buf[buflen - 1] == <span class="charliteral">&#39;\0&#39;</span> &amp;&amp;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        strstr( (<span class="keyword">const</span> <span class="keywordtype">char</span> *) buf, <span class="stringliteral">&quot;-----BEGIN CERTIFICATE-----&quot;</span> ) != NULL )</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    {</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        buf_format = MBEDTLS_X509_FORMAT_PEM;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">if</span>( buf_format == MBEDTLS_X509_FORMAT_DER )</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__x509__module.html#ga003c2483a2691e025641fa9d68d4a96a">mbedtls_x509_crt_parse_der</a>( chain, buf, buflen );</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__x509__module.html#ga003c2483a2691e025641fa9d68d4a96a">mbedtls_x509_crt_parse_der</a>( chain, buf, buflen );</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_PEM_PARSE_C)</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">if</span>( buf_format == MBEDTLS_X509_FORMAT_PEM )</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    {</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        mbedtls_pem_context pem;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="comment">/* 1 rather than 0 since the terminating NULL byte is counted in */</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordflow">while</span>( buflen &gt; 1 )</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        {</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            <span class="keywordtype">size_t</span> use_len;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            mbedtls_pem_init( &amp;pem );</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            <span class="comment">/* If we get there, we know the string is null-terminated */</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            ret = mbedtls_pem_read_buffer( &amp;pem,</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                           <span class="stringliteral">&quot;-----BEGIN CERTIFICATE-----&quot;</span>,</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                           <span class="stringliteral">&quot;-----END CERTIFICATE-----&quot;</span>,</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                           buf, NULL, 0, &amp;use_len );</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            <span class="keywordflow">if</span>( ret == 0 )</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            {</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">                 * Was PEM encoded</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                buflen -= use_len;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                buf += use_len;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            }</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ret == MBEDTLS_ERR_PEM_BAD_INPUT_DATA )</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;            }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ret != MBEDTLS_ERR_PEM_NO_HEADER_FOOTER_PRESENT )</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                mbedtls_pem_free( &amp;pem );</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">                 * PEM header and footer were found</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                buflen -= use_len;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                buf += use_len;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                <span class="keywordflow">if</span>( first_error == 0 )</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                    first_error = ret;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                total_failed++;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            }</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            ret = <a class="code" href="group__x509__module.html#ga003c2483a2691e025641fa9d68d4a96a">mbedtls_x509_crt_parse_der</a>( chain, pem.buf, pem.buflen );</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            mbedtls_pem_free( &amp;pem );</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            {</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">                 * Quit parsing on a memory error</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                <span class="keywordflow">if</span>( ret == <a class="code" href="group__x509__module.html#gacf6d98c6cbb76728260d1dcb1fe3bc7d">MBEDTLS_ERR_X509_ALLOC_FAILED</a> )</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                    <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                <span class="keywordflow">if</span>( first_error == 0 )</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                    first_error = ret;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                total_failed++;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            }</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            success = 1;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        }</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    }</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keywordflow">if</span>( success )</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        <span class="keywordflow">return</span>( total_failed );</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( first_error )</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <span class="keywordflow">return</span>( first_error );</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeb90af9ad906c5075b1ad625ebc26553">MBEDTLS_ERR_X509_CERT_UNKNOWN_FORMAT</a> );</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MBEDTLS_PEM_PARSE_C */</span><span class="preprocessor"></span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;}</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_FS_IO)</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment"> * Load one or more certificates and add them to the chained list</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#gad4da63133d3590aa311488497d4c38ec">mbedtls_x509_crt_parse_file</a>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *chain, <span class="keyword">const</span> <span class="keywordtype">char</span> *path )</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;{</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordtype">size_t</span> n;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_pk_load_file( path, &amp;buf, &amp;n ) ) != 0 )</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    ret = <a class="code" href="group__x509__module.html#ga033567483649030f7f859db4f4cb7e14">mbedtls_x509_crt_parse</a>( chain, buf, n );</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    mbedtls_zeroize( buf, n );</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    mbedtls_free( buf );</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;}</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#ga571fc89b9f3217ab3dd67bd7af905066">mbedtls_x509_crt_parse_path</a>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *chain, <span class="keyword">const</span> <span class="keywordtype">char</span> *path )</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;{</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="preprocessor">#if defined(_WIN32) &amp;&amp; !defined(EFIX64) &amp;&amp; !defined(EFI32)</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordtype">int</span> w_ret;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    WCHAR szDir[MAX_PATH];</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordtype">char</span> filename[MAX_PATH];</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordtype">size_t</span> len = strlen( path );</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    WIN32_FIND_DATAW file_data;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <a class="code" href="group__compat.html#gab521aa5010fb1afb801a899a55569e03">HANDLE</a> hFind;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordflow">if</span>( len &gt; MAX_PATH - 3 )</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a> );</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    memset( szDir, 0, <span class="keyword">sizeof</span>(szDir) );</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    memset( filename, 0, MAX_PATH );</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    memcpy( filename, path, len );</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    filename[len++] = <span class="charliteral">&#39;\\&#39;</span>;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    p = filename + len;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    filename[len++] = <span class="charliteral">&#39;*&#39;</span>;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    w_ret = MultiByteToWideChar( CP_ACP, 0, filename, len, szDir,</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                                 MAX_PATH - 3 );</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">if</span>( w_ret == 0 )</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a> );</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    hFind = FindFirstFileW( szDir, &amp;file_data );</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="keywordflow">if</span>( hFind == <a class="code" href="group__compat.html#ga5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a> )</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gad85d9c7aa5c30b9730297bef3386407c">MBEDTLS_ERR_X509_FILE_IO_ERROR</a> );</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    len = MAX_PATH - len;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">do</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    {</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        memset( p, 0, len );</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="keywordflow">if</span>( file_data.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY )</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        w_ret = WideCharToMultiByte( CP_ACP, 0, file_data.cFileName,</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                                     lstrlenW( file_data.cFileName ),</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                                     p, (<span class="keywordtype">int</span>) len - 1,</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                                     NULL, NULL );</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="keywordflow">if</span>( w_ret == 0 )</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gad85d9c7aa5c30b9730297bef3386407c">MBEDTLS_ERR_X509_FILE_IO_ERROR</a> );</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        w_ret = <a class="code" href="group__x509__module.html#gad4da63133d3590aa311488497d4c38ec">mbedtls_x509_crt_parse_file</a>( chain, filename );</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keywordflow">if</span>( w_ret &lt; 0 )</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            ret++;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;            ret += w_ret;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    }</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="keywordflow">while</span>( FindNextFileW( hFind, &amp;file_data ) != 0 );</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">if</span>( GetLastError() != ERROR_NO_MORE_FILES )</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        ret = <a class="code" href="group__x509__module.html#gad85d9c7aa5c30b9730297bef3386407c">MBEDTLS_ERR_X509_FILE_IO_ERROR</a>;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    FindClose( hFind );</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* _WIN32 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keywordtype">int</span> t_ret;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="keywordtype">int</span> snp_ret;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keyword">struct </span>stat sb;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keyword">struct </span>dirent *entry;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="keywordtype">char</span> entry_name[MBEDTLS_X509_MAX_FILE_PATH_LEN];</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    DIR *dir = opendir( path );</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">if</span>( dir == NULL )</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gad85d9c7aa5c30b9730297bef3386407c">MBEDTLS_ERR_X509_FILE_IO_ERROR</a> );</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_THREADING_PTHREAD)</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_mutex_lock( &amp;mbedtls_threading_readdir_mutex ) ) != 0 )</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        closedir( dir );</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    }</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">while</span>( ( entry = readdir( dir ) ) != NULL )</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    {</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        snp_ret = mbedtls_snprintf( entry_name, <span class="keyword">sizeof</span> entry_name,</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                                    <span class="stringliteral">&quot;%s/%s&quot;</span>, path, entry-&gt;d_name );</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        <span class="keywordflow">if</span>( snp_ret &lt; 0 || (<span class="keywordtype">size_t</span>)snp_ret &gt;= <span class="keyword">sizeof</span> entry_name )</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            ret = <a class="code" href="group__x509__module.html#gab9516fc53ff90c547fd77d35c71feec7">MBEDTLS_ERR_X509_BUFFER_TOO_SMALL</a>;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="namespacecleanup.html">cleanup</a>;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        }</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( stat( entry_name, &amp;sb ) == -1 )</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            ret = <a class="code" href="group__x509__module.html#gad85d9c7aa5c30b9730297bef3386407c">MBEDTLS_ERR_X509_FILE_IO_ERROR</a>;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="namespacecleanup.html">cleanup</a>;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        }</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keywordflow">if</span>( !S_ISREG( sb.st_mode ) )</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="comment">// Ignore parse errors</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        t_ret = <a class="code" href="group__x509__module.html#gad4da63133d3590aa311488497d4c38ec">mbedtls_x509_crt_parse_file</a>( chain, entry_name );</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        <span class="keywordflow">if</span>( t_ret &lt; 0 )</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            ret++;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            ret += t_ret;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    }</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<a class="code" href="namespacecleanup.html">cleanup</a>:</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    closedir( dir );</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_THREADING_PTHREAD)</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">if</span>( mbedtls_mutex_unlock( &amp;mbedtls_threading_readdir_mutex ) != 0 )</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        ret = <a class="code" href="threading_8h.html#a51005c51b928706511d3c2ea3390c07f">MBEDTLS_ERR_THREADING_MUTEX_ERROR</a>;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* _WIN32 */</span><span class="preprocessor"></span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;}</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MBEDTLS_FS_IO */</span><span class="preprocessor"></span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_info_subject_alt_name( <span class="keywordtype">char</span> **buf, <span class="keywordtype">size_t</span> *size,</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *subject_alt_name )</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;{</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordtype">size_t</span> i;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordtype">size_t</span> n = *size;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordtype">char</span> *p = *buf;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *cur = subject_alt_name;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *sep = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordtype">size_t</span> sep_len = 0;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="keywordflow">while</span>( cur != NULL )</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    {</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keywordflow">if</span>( cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> + sep_len &gt;= n )</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        {</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            *p = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gab9516fc53ff90c547fd77d35c71feec7">MBEDTLS_ERR_X509_BUFFER_TOO_SMALL</a> );</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        }</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        n -= cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> + sep_len;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <span class="keywordflow">for</span>( i = 0; i &lt; sep_len; i++ )</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            *p++ = sep[i];</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keywordflow">for</span>( i = 0; i &lt; cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a>; i++ )</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            *p++ = cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>[i];</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        sep = <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        sep_len = 2;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        cur = cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a>;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    }</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    *p = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    *size = n;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    *buf = p;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;}</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="preprocessor">#define PRINT_ITEM(i)                           \</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="preprocessor">    {                                           \</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="preprocessor">        ret = mbedtls_snprintf( p, n, &quot;%s&quot; i, sep );    \</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="preprocessor">        MBEDTLS_X509_SAFE_SNPRINTF;                        \</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="preprocessor">        sep = &quot;, &quot;;                             \</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="preprocessor">    }</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="preprocessor">#define CERT_TYPE(type,name)                    \</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="preprocessor">    if( ns_cert_type &amp; type )                   \</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="preprocessor">        PRINT_ITEM( name );</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_info_cert_type( <span class="keywordtype">char</span> **buf, <span class="keywordtype">size_t</span> *size,</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ns_cert_type )</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;{</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keywordtype">size_t</span> n = *size;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordtype">char</span> *p = *buf;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *sep = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    CERT_TYPE( MBEDTLS_X509_NS_CERT_TYPE_SSL_CLIENT,         <span class="stringliteral">&quot;SSL Client&quot;</span> );</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    CERT_TYPE( MBEDTLS_X509_NS_CERT_TYPE_SSL_SERVER,         <span class="stringliteral">&quot;SSL Server&quot;</span> );</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    CERT_TYPE( MBEDTLS_X509_NS_CERT_TYPE_EMAIL,              <span class="stringliteral">&quot;Email&quot;</span> );</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    CERT_TYPE( MBEDTLS_X509_NS_CERT_TYPE_OBJECT_SIGNING,     <span class="stringliteral">&quot;Object Signing&quot;</span> );</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    CERT_TYPE( MBEDTLS_X509_NS_CERT_TYPE_RESERVED,           <span class="stringliteral">&quot;Reserved&quot;</span> );</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    CERT_TYPE( MBEDTLS_X509_NS_CERT_TYPE_SSL_CA,             <span class="stringliteral">&quot;SSL CA&quot;</span> );</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    CERT_TYPE( MBEDTLS_X509_NS_CERT_TYPE_EMAIL_CA,           <span class="stringliteral">&quot;Email CA&quot;</span> );</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    CERT_TYPE( MBEDTLS_X509_NS_CERT_TYPE_OBJECT_SIGNING_CA,  <span class="stringliteral">&quot;Object Signing CA&quot;</span> );</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    *size = n;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    *buf = p;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;}</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="preprocessor">#define KEY_USAGE(code,name)    \</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="preprocessor">    if( key_usage &amp; code )      \</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="preprocessor">        PRINT_ITEM( name );</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_info_key_usage( <span class="keywordtype">char</span> **buf, <span class="keywordtype">size_t</span> *size,</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key_usage )</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;{</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <span class="keywordtype">size_t</span> n = *size;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keywordtype">char</span> *p = *buf;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *sep = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    KEY_USAGE( MBEDTLS_X509_KU_DIGITAL_SIGNATURE,    <span class="stringliteral">&quot;Digital Signature&quot;</span> );</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    KEY_USAGE( MBEDTLS_X509_KU_NON_REPUDIATION,      <span class="stringliteral">&quot;Non Repudiation&quot;</span> );</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    KEY_USAGE( MBEDTLS_X509_KU_KEY_ENCIPHERMENT,     <span class="stringliteral">&quot;Key Encipherment&quot;</span> );</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    KEY_USAGE( MBEDTLS_X509_KU_DATA_ENCIPHERMENT,    <span class="stringliteral">&quot;Data Encipherment&quot;</span> );</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    KEY_USAGE( MBEDTLS_X509_KU_KEY_AGREEMENT,        <span class="stringliteral">&quot;Key Agreement&quot;</span> );</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    KEY_USAGE( MBEDTLS_X509_KU_KEY_CERT_SIGN,        <span class="stringliteral">&quot;Key Cert Sign&quot;</span> );</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    KEY_USAGE( MBEDTLS_X509_KU_CRL_SIGN,             <span class="stringliteral">&quot;CRL Sign&quot;</span> );</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    KEY_USAGE( MBEDTLS_X509_KU_ENCIPHER_ONLY,        <span class="stringliteral">&quot;Encipher Only&quot;</span> );</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    KEY_USAGE( MBEDTLS_X509_KU_DECIPHER_ONLY,        <span class="stringliteral">&quot;Decipher Only&quot;</span> );</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    *size = n;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    *buf = p;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;}</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_info_ext_key_usage( <span class="keywordtype">char</span> **buf, <span class="keywordtype">size_t</span> *size,</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *extended_key_usage )</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;{</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *desc;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="keywordtype">size_t</span> n = *size;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordtype">char</span> *p = *buf;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *cur = extended_key_usage;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *sep = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">while</span>( cur != NULL )</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    {</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="oid_8h.html#a5f8ddcd81a3857571001628d3410bb68">mbedtls_oid_get_extended_key_usage</a>( &amp;cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>, &amp;desc ) != 0 )</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            desc = <span class="stringliteral">&quot;???&quot;</span>;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;%s%s&quot;</span>, sep, desc );</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        sep = <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;        cur = cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a>;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    }</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    *size = n;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    *buf = p;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;}</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment"> * Return an informational string about the certificate.</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="preprocessor">#define BEFORE_COLON    18</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="preprocessor">#define BC              &quot;18&quot;</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#gabaf30f2269fc3b6608b25871f9d09da6">mbedtls_x509_crt_info</a>( <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> size, <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix,</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                   <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt )</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;{</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordtype">size_t</span> n;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <span class="keywordtype">char</span> key_size_str[BEFORE_COLON];</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    p = buf;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    n = size;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordflow">if</span>( NULL == crt )</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    {</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\nCertificate is uninitialised!\n&quot;</span> );</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="keywordflow">return</span>( (<span class="keywordtype">int</span>) ( size - n ) );</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    }</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;%scert. version     : %d\n&quot;</span>,</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                               prefix, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">version</a> );</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;%sserial number     : &quot;</span>,</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                               prefix );</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    ret = mbedtls_x509_serial_gets( p, n, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c3ae8b4aba6e1c40cb1f6a85da36116">serial</a> );</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%sissuer name       : &quot;</span>, prefix );</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    ret = mbedtls_x509_dn_gets( p, n, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ade48d67edd24629e28361d3fbc0aafd9">issuer</a>  );</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%ssubject name      : &quot;</span>, prefix );</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    ret = mbedtls_x509_dn_gets( p, n, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a773e92423092ab65e5e50031bd9663a5">subject</a> );</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%sissued  on        : &quot;</span> \</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                   <span class="stringliteral">&quot;%04d-%02d-%02d %02d:%02d:%02d&quot;</span>, prefix,</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                   crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a>.year, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a>.mon,</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;                   crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a>.<a class="code" href="structmbedtls__x509__time.html#a20712c77a94123d4610c87d6863cf092">day</a>,  crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a>.hour,</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                   crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a>.min,  crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a>.<a class="code" href="structmbedtls__x509__time.html#a267d51d8fbecde50b06b883db7f98ec2">sec</a> );</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%sexpires on        : &quot;</span> \</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                   <span class="stringliteral">&quot;%04d-%02d-%02d %02d:%02d:%02d&quot;</span>, prefix,</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                   crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a>.year, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a>.mon,</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                   crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a>.<a class="code" href="structmbedtls__x509__time.html#a20712c77a94123d4610c87d6863cf092">day</a>,  crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a>.hour,</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                   crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a>.min,  crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a>.<a class="code" href="structmbedtls__x509__time.html#a267d51d8fbecde50b06b883db7f98ec2">sec</a> );</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%ssigned using      : &quot;</span>, prefix );</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    ret = mbedtls_x509_sig_alg_gets( p, n, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a128c3a665ffdce696b402435a74e97aa">sig_oid</a>, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a65d5d20352a08c77e173808fde1f8660">sig_pk</a>,</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                             crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c56937aaf2a51a1d8bc814b142734ca">sig_md</a>, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a67c497ed6535050997c014507a866e9e">sig_opts</a> );</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="comment">/* Key size */</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordflow">if</span>( ( ret = mbedtls_x509_key_size_helper( key_size_str, BEFORE_COLON,</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                                      <a class="code" href="pk_8h.html#a1b0fb8d16905ec72515dd574b77a4518">mbedtls_pk_get_name</a>( &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a> ) ) ) != 0 )</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    {</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    }</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%s%-&quot;</span> BC <span class="stringliteral">&quot;s: %d bits&quot;</span>, prefix, key_size_str,</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                          (<span class="keywordtype">int</span>) <a class="code" href="pk_8h.html#a4a31083a590b155dd54d22cf618eefcc">mbedtls_pk_get_bitlen</a>( &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a> ) );</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">     * Optional extensions</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> &amp; MBEDTLS_X509_EXT_BASIC_CONSTRAINTS )</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%sbasic constraints : CA=%s&quot;</span>, prefix,</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                        crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a196b3a43dae5a1c0058f46075f832890">ca_istrue</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span> );</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ab0af43652f426ace28052ec47fdde6fb">max_pathlen</a> &gt; 0 )</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        {</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;, max_pathlen=%d&quot;</span>, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ab0af43652f426ace28052ec47fdde6fb">max_pathlen</a> - 1 );</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        }</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> &amp; MBEDTLS_X509_EXT_SUBJECT_ALT_NAME )</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    {</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%ssubject alt name  : &quot;</span>, prefix );</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="keywordflow">if</span>( ( ret = x509_info_subject_alt_name( &amp;p, &amp;n,</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                                            &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a1f148e8fb52e03e2604e716386a07df4">subject_alt_names</a> ) ) != 0 )</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    }</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> &amp; MBEDTLS_X509_EXT_NS_CERT_TYPE )</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    {</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%scert. type        : &quot;</span>, prefix );</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <span class="keywordflow">if</span>( ( ret = x509_info_cert_type( &amp;p, &amp;n, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#adc36c60aa279fae8bd35a20b9c2bba22">ns_cert_type</a> ) ) != 0 )</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    }</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> &amp; MBEDTLS_X509_EXT_KEY_USAGE )</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    {</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%skey usage         : &quot;</span>, prefix );</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <span class="keywordflow">if</span>( ( ret = x509_info_key_usage( &amp;p, &amp;n, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a3b7650600aa6e637b8ab534a938aee94">key_usage</a> ) ) != 0 )</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    }</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> &amp; MBEDTLS_X509_EXT_EXTENDED_KEY_USAGE )</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    {</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n%sext key usage     : &quot;</span>, prefix );</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <span class="keywordflow">if</span>( ( ret = x509_info_ext_key_usage( &amp;p, &amp;n,</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                                             &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac94f7360a7143ce1b983fab46c34dcf2">ext_key_usage</a> ) ) != 0 )</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    }</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;\n&quot;</span> );</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keywordflow">return</span>( (<span class="keywordtype">int</span>) ( size - n ) );</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;}</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="keyword">struct </span>x509_crt_verify_string {</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keywordtype">int</span> code;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *string;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;};</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>x509_crt_verify_string x509_crt_verify_strings[] = {</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    { <a class="code" href="group__x509__module.html#ga5f03158dcacc5914872e38c68231b642">MBEDTLS_X509_BADCERT_EXPIRED</a>,       <span class="stringliteral">&quot;The certificate validity has expired&quot;</span> },</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    { <a class="code" href="group__x509__module.html#gaddd96a9eb80fab17bce02d2a147ea504">MBEDTLS_X509_BADCERT_REVOKED</a>,       <span class="stringliteral">&quot;The certificate has been revoked (is on a CRL)&quot;</span> },</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    { <a class="code" href="group__x509__module.html#ga6e71468985ebf243ca7cfce5c3dea881">MBEDTLS_X509_BADCERT_CN_MISMATCH</a>,   <span class="stringliteral">&quot;The certificate Common Name (CN) does not match with the expected CN&quot;</span> },</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    { <a class="code" href="group__x509__module.html#ga0e5b1d4c9c1a1a3227238c82042c1d1b">MBEDTLS_X509_BADCERT_NOT_TRUSTED</a>,   <span class="stringliteral">&quot;The certificate is not correctly signed by the trusted CA&quot;</span> },</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    { <a class="code" href="group__x509__module.html#gad1da8228ca957c2947fd329c32fc7ca4">MBEDTLS_X509_BADCRL_NOT_TRUSTED</a>,    <span class="stringliteral">&quot;The CRL is not correctly signed by the trusted CA&quot;</span> },</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    { <a class="code" href="group__x509__module.html#gaebccb1707af21f2d3d6610a7c6485f32">MBEDTLS_X509_BADCRL_EXPIRED</a>,        <span class="stringliteral">&quot;The CRL is expired&quot;</span> },</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    { <a class="code" href="group__x509__module.html#ga8bca03e3c2c89460bea17ab142b0b7ab">MBEDTLS_X509_BADCERT_MISSING</a>,       <span class="stringliteral">&quot;Certificate was missing&quot;</span> },</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    { <a class="code" href="group__x509__module.html#ga1b87b2e1d26077023adf2a5c65a76776">MBEDTLS_X509_BADCERT_SKIP_VERIFY</a>,   <span class="stringliteral">&quot;Certificate verification was skipped&quot;</span> },</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    { <a class="code" href="group__x509__module.html#ga76bdd50937a671ef62474b7e38e23e02">MBEDTLS_X509_BADCERT_OTHER</a>,         <span class="stringliteral">&quot;Other reason (can be used by verify callback)&quot;</span> },</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    { <a class="code" href="group__x509__module.html#gac769acbb18e53198ae2d2e63bd339cfa">MBEDTLS_X509_BADCERT_FUTURE</a>,        <span class="stringliteral">&quot;The certificate validity starts in the future&quot;</span> },</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    { <a class="code" href="group__x509__module.html#gad93c0f614969729f7d13fb0a3acac68e">MBEDTLS_X509_BADCRL_FUTURE</a>,         <span class="stringliteral">&quot;The CRL is from the future&quot;</span> },</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    { <a class="code" href="group__x509__module.html#ga28705c8c3091a013487df25842249c0f">MBEDTLS_X509_BADCERT_KEY_USAGE</a>,     <span class="stringliteral">&quot;Usage does not match the keyUsage extension&quot;</span> },</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    { <a class="code" href="group__x509__module.html#gac3dab3183efdbca7e988916e7fc1a02a">MBEDTLS_X509_BADCERT_EXT_KEY_USAGE</a>, <span class="stringliteral">&quot;Usage does not match the extendedKeyUsage extension&quot;</span> },</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    { <a class="code" href="group__x509__module.html#gaa383ae441177fa7a16fb2313bb48bb10">MBEDTLS_X509_BADCERT_NS_CERT_TYPE</a>,  <span class="stringliteral">&quot;Usage does not match the nsCertType extension&quot;</span> },</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    { <a class="code" href="group__x509__module.html#ga41b54b526c11bf51cc431ef1a151816d">MBEDTLS_X509_BADCERT_BAD_MD</a>,        <span class="stringliteral">&quot;The certificate is signed with an unacceptable hash.&quot;</span> },</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    { <a class="code" href="group__x509__module.html#ga9332fa1e09a373cc56234525b14546c4">MBEDTLS_X509_BADCERT_BAD_PK</a>,        <span class="stringliteral">&quot;The certificate is signed with an unacceptable PK alg (eg RSA vs ECDSA).&quot;</span> },</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    { <a class="code" href="group__x509__module.html#gaef5f9a34b327eb79750ebc3779e98282">MBEDTLS_X509_BADCERT_BAD_KEY</a>,       <span class="stringliteral">&quot;The certificate is signed with an unacceptable key (eg bad curve, RSA too short).&quot;</span> },</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    { <a class="code" href="group__x509__module.html#gad3f810fb74f94164185b88b90fffa329">MBEDTLS_X509_BADCRL_BAD_MD</a>,         <span class="stringliteral">&quot;The CRL is signed with an unacceptable hash.&quot;</span> },</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    { <a class="code" href="group__x509__module.html#ga182a6f1f465e566de7586e6ee8fa7c4e">MBEDTLS_X509_BADCRL_BAD_PK</a>,         <span class="stringliteral">&quot;The CRL is signed with an unacceptable PK alg (eg RSA vs ECDSA).&quot;</span> },</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    { <a class="code" href="group__x509__module.html#gac2947ead6fd1035296826110ca74a364">MBEDTLS_X509_BADCRL_BAD_KEY</a>,        <span class="stringliteral">&quot;The CRL is signed with an unacceptable key (eg bad curve, RSA too short).&quot;</span> },</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    { 0, NULL }</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;};</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#gae88f1d8e6696eb2beeffe0a708219e6b">mbedtls_x509_crt_verify_info</a>( <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> size, <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix,</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                          uint32_t flags )</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;{</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span>x509_crt_verify_string *cur;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keywordtype">char</span> *p = buf;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="keywordtype">size_t</span> n = size;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="keywordflow">for</span>( cur = x509_crt_verify_strings; cur-&gt;string != NULL ; cur++ )</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    {</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="keywordflow">if</span>( ( flags &amp; cur-&gt;code ) == 0 )</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;%s%s\n&quot;</span>, prefix, cur-&gt;string );</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        flags ^= cur-&gt;code;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    }</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    <span class="keywordflow">if</span>( flags != 0 )</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    {</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        ret = mbedtls_snprintf( p, n, <span class="stringliteral">&quot;%sUnknown reason &quot;</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                                       <span class="stringliteral">&quot;(this should not happen)\n&quot;</span>, prefix );</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        MBEDTLS_X509_SAFE_SNPRINTF;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    }</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="keywordflow">return</span>( (<span class="keywordtype">int</span>) ( size - n ) );</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;}</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_X509_CHECK_KEY_USAGE)</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#ga0ab7857ffd82467207e718bb9f0131a2">mbedtls_x509_crt_check_key_usage</a>( <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt,</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> usage )</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;{</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> usage_must, usage_may;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> may_mask = MBEDTLS_X509_KU_ENCIPHER_ONLY</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;                          | MBEDTLS_X509_KU_DECIPHER_ONLY;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">if</span>( ( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> &amp; MBEDTLS_X509_EXT_KEY_USAGE ) == 0 )</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    usage_must = usage &amp; ~may_mask;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keywordflow">if</span>( ( ( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a3b7650600aa6e637b8ab534a938aee94">key_usage</a> &amp; ~may_mask ) &amp; usage_must ) != usage_must )</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a> );</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    usage_may = usage &amp; may_mask;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keywordflow">if</span>( ( ( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a3b7650600aa6e637b8ab534a938aee94">key_usage</a> &amp; may_mask ) | usage_may ) != usage_may )</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a> );</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;}</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_X509_CHECK_EXTENDED_KEY_USAGE)</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#gad21c0e75a3fdbeb1f65e4d339e479df3">mbedtls_x509_crt_check_extended_key_usage</a>( <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt,</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *usage_oid,</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                                       <span class="keywordtype">size_t</span> usage_len )</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;{</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *cur;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="comment">/* Extension is not mandatory, absent means no restriction */</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordflow">if</span>( ( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> &amp; MBEDTLS_X509_EXT_EXTENDED_KEY_USAGE ) == 0 )</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment">     * Look for the requested usage (or wildcard ANY) in our list</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordflow">for</span>( cur = &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac94f7360a7143ce1b983fab46c34dcf2">ext_key_usage</a>; cur != NULL; cur = cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a> )</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    {</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> *cur_oid = &amp;cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        <span class="keywordflow">if</span>( cur_oid-&gt;<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> == usage_len &amp;&amp;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;            memcmp( cur_oid-&gt;<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, usage_oid, usage_len ) == 0 )</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        {</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        }</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="asn1_8h.html#a0b81f225b3551ec7c4da69b2d183d10b">MBEDTLS_OID_CMP</a>( <a class="code" href="oid_8h.html#a61da0671b3897e73edf219d44e45b693">MBEDTLS_OID_ANY_EXTENDED_KEY_USAGE</a>, cur_oid ) == 0 )</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    }</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a> );</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;}</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MBEDTLS_X509_CHECK_EXTENDED_KEY_USAGE */</span><span class="preprocessor"></span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_X509_CRL_PARSE_C)</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment"> * Return 1 if the certificate is revoked, or 0 otherwise.</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#ga0dc256a70f90cb68002d53bafffab232">mbedtls_x509_crt_is_revoked</a>( <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt, <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crl.html">mbedtls_x509_crl</a> *crl )</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;{</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crl__entry.html">mbedtls_x509_crl_entry</a> *cur = &amp;crl-&gt;<a class="code" href="structmbedtls__x509__crl.html#a880036b1b4a2b449542f8f1fa389694f">entry</a>;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordflow">while</span>( cur != NULL &amp;&amp; cur-&gt;serial.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> != 0 )</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    {</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c3ae8b4aba6e1c40cb1f6a85da36116">serial</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> == cur-&gt;serial.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> &amp;&amp;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            memcmp( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c3ae8b4aba6e1c40cb1f6a85da36116">serial</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, cur-&gt;serial.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c3ae8b4aba6e1c40cb1f6a85da36116">serial</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) == 0 )</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        {</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            <span class="keywordflow">if</span>( mbedtls_x509_time_is_past( &amp;cur-&gt;revocation_date ) )</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                <span class="keywordflow">return</span>( 1 );</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        }</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        cur = cur-&gt;next;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    }</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;}</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment"> * Check that the given certificate is not revoked according to the CRL.</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment"> * Skip validation is no CRL for the given CA is present.</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_crt_verifycrl( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt, <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *ca,</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                               <a class="code" href="structmbedtls__x509__crl.html">mbedtls_x509_crl</a> *crl_list,</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                               <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> *profile )</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;{</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    <span class="keywordtype">int</span> flags = 0;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> hash[MBEDTLS_MD_MAX_SIZE];</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="keyword">const</span> <a class="code" href="structmbedtls__md__info__t.html">mbedtls_md_info_t</a> *md_info;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <span class="keywordflow">if</span>( ca == NULL )</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        <span class="keywordflow">return</span>( flags );</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="keywordflow">while</span>( crl_list != NULL )</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    {</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        <span class="keywordflow">if</span>( crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#aaf0d47225a63a5d9bf0e2e99d641e72d">version</a> == 0 ||</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#a009d0e1b844df85a2389ec10b770a6f6">issuer_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> != ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ||</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;            memcmp( crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#a009d0e1b844df85a2389ec10b770a6f6">issuer_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>,</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                    crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#a009d0e1b844df85a2389ec10b770a6f6">issuer_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) != 0 )</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        {</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            crl_list = crl_list-&gt;next;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        }</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="comment">         * Check if the CA is configured to sign CRLs</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_X509_CHECK_KEY_USAGE)</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="group__x509__module.html#ga0ab7857ffd82467207e718bb9f0131a2">mbedtls_x509_crt_check_key_usage</a>( ca, MBEDTLS_X509_KU_CRL_SIGN ) != 0 )</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        {</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            flags |= <a class="code" href="group__x509__module.html#gad1da8228ca957c2947fd329c32fc7ca4">MBEDTLS_X509_BADCRL_NOT_TRUSTED</a>;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        }</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment">         * Check if CRL is correctly signed by the trusted CA</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <span class="keywordflow">if</span>( x509_profile_check_md_alg( profile, crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#a85c03124f3b4a2afe8b5c47fab13a8a9">sig_md</a> ) != 0 )</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            flags |= <a class="code" href="group__x509__module.html#gad3f810fb74f94164185b88b90fffa329">MBEDTLS_X509_BADCRL_BAD_MD</a>;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        <span class="keywordflow">if</span>( x509_profile_check_pk_alg( profile, crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#a8c94375266c53f6e73d0134dc978151a">sig_pk</a> ) != 0 )</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;            flags |= <a class="code" href="group__x509__module.html#ga182a6f1f465e566de7586e6ee8fa7c4e">MBEDTLS_X509_BADCRL_BAD_PK</a>;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        md_info = <a class="code" href="md_8h.html#aca53b51e0c8eb0e07c7eb4a3e6acfa0d">mbedtls_md_info_from_type</a>( crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#a85c03124f3b4a2afe8b5c47fab13a8a9">sig_md</a> );</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <span class="keywordflow">if</span>( md_info == NULL )</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        {</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">             * Cannot check &#39;unknown&#39; hash</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            flags |= <a class="code" href="group__x509__module.html#gad1da8228ca957c2947fd329c32fc7ca4">MBEDTLS_X509_BADCRL_NOT_TRUSTED</a>;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        }</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <a class="code" href="md_8h.html#a36c5d8bda1905e0434708f0ef5912dda">mbedtls_md</a>( md_info, crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#ab8086dd1a2a3d82363cc91e1cdfb5850">tbs</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#ab8086dd1a2a3d82363cc91e1cdfb5850">tbs</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a>, hash );</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        <span class="keywordflow">if</span>( x509_profile_check_key( profile, crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#a8c94375266c53f6e73d0134dc978151a">sig_pk</a>, &amp;ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a> ) != 0 )</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            flags |= <a class="code" href="group__x509__module.html#gaef5f9a34b327eb79750ebc3779e98282">MBEDTLS_X509_BADCERT_BAD_KEY</a>;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="pk_8h.html#a81f0c5e40b839f5eca676c2c2752036f">mbedtls_pk_verify_ext</a>( crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#a8c94375266c53f6e73d0134dc978151a">sig_pk</a>, crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#ad59e3744b290f19d6400678d364aef77">sig_opts</a>, &amp;ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a>,</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                           crl_list-&gt;<a class="code" href="structmbedtls__x509__crl.html#a85c03124f3b4a2afe8b5c47fab13a8a9">sig_md</a>, hash, <a class="code" href="md_8h.html#ae20f4ddcf2bbf2e59cafc6fab8c993d6">mbedtls_md_get_size</a>( md_info ),</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                           crl_list-&gt;sig.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, crl_list-&gt;sig.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) != 0 )</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        {</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;            flags |= <a class="code" href="group__x509__module.html#gad1da8228ca957c2947fd329c32fc7ca4">MBEDTLS_X509_BADCRL_NOT_TRUSTED</a>;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        }</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="comment">         * Check for validity of CRL (Do not drop out)</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="keywordflow">if</span>( mbedtls_x509_time_is_past( &amp;crl_list-&gt;next_update ) )</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;            flags |= <a class="code" href="group__x509__module.html#gaebccb1707af21f2d3d6610a7c6485f32">MBEDTLS_X509_BADCRL_EXPIRED</a>;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <span class="keywordflow">if</span>( mbedtls_x509_time_is_future( &amp;crl_list-&gt;this_update ) )</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;            flags |= <a class="code" href="group__x509__module.html#gad93c0f614969729f7d13fb0a3acac68e">MBEDTLS_X509_BADCRL_FUTURE</a>;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">         * Check if certificate is revoked</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="group__x509__module.html#ga0dc256a70f90cb68002d53bafffab232">mbedtls_x509_crt_is_revoked</a>( crt, crl_list ) )</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        {</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            flags |= <a class="code" href="group__x509__module.html#gaddd96a9eb80fab17bce02d2a147ea504">MBEDTLS_X509_BADCERT_REVOKED</a>;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        }</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        crl_list = crl_list-&gt;next;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    }</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="keywordflow">return</span>( flags );</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;}</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MBEDTLS_X509_CRL_PARSE_C */</span><span class="preprocessor"></span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="comment"> * Like memcmp, but case-insensitive and always returns -1 if different</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_memcasecmp( <span class="keyword">const</span> <span class="keywordtype">void</span> *s1, <span class="keyword">const</span> <span class="keywordtype">void</span> *s2, <span class="keywordtype">size_t</span> len )</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;{</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="keywordtype">size_t</span> i;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> diff;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *n1 = s1, *n2 = s2;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="keywordflow">for</span>( i = 0; i &lt; len; i++ )</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    {</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        diff = n1[i] ^ n2[i];</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="keywordflow">if</span>( diff == 0 )</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="keywordflow">if</span>( diff == 32 &amp;&amp;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;            ( ( n1[i] &gt;= <span class="charliteral">&#39;a&#39;</span> &amp;&amp; n1[i] &lt;= <span class="charliteral">&#39;z&#39;</span> ) ||</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;              ( n1[i] &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; n1[i] &lt;= <span class="charliteral">&#39;Z&#39;</span> ) ) )</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        {</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        }</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    }</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;}</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment"> * Return 0 if name matches wildcard, -1 otherwise</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_check_wildcard( <span class="keyword">const</span> <span class="keywordtype">char</span> *cn, <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> *name )</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;{</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="keywordtype">size_t</span> i;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordtype">size_t</span> cn_idx = 0, cn_len = strlen( cn );</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="keywordflow">if</span>( name-&gt;len &lt; 3 || name-&gt;p[0] != <span class="charliteral">&#39;*&#39;</span> || name-&gt;p[1] != <span class="charliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keywordflow">for</span>( i = 0; i &lt; cn_len; ++i )</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    {</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        <span class="keywordflow">if</span>( cn[i] == <span class="charliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        {</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;            cn_idx = i;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        }</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    }</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">if</span>( cn_idx == 0 )</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordflow">if</span>( cn_len - cn_idx == name-&gt;len - 1 &amp;&amp;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        x509_memcasecmp( name-&gt;p + 1, cn + cn_idx, name-&gt;len - 1 ) == 0 )</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    {</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    }</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;}</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment"> * Compare two X.509 strings, case-insensitive, and allowing for some encoding</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="comment"> * variations (but not all).</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment"> * Return 0 if equal, -1 otherwise.</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_string_cmp( <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> *a, <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__buf.html">mbedtls_x509_buf</a> *b )</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;{</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="keywordflow">if</span>( a-&gt;tag == b-&gt;tag &amp;&amp;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        a-&gt;len == b-&gt;len &amp;&amp;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        memcmp( a-&gt;p, b-&gt;p, b-&gt;len ) == 0 )</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    {</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    }</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="keywordflow">if</span>( ( a-&gt;tag == MBEDTLS_ASN1_UTF8_STRING || a-&gt;tag == MBEDTLS_ASN1_PRINTABLE_STRING ) &amp;&amp;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        ( b-&gt;tag == MBEDTLS_ASN1_UTF8_STRING || b-&gt;tag == MBEDTLS_ASN1_PRINTABLE_STRING ) &amp;&amp;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        a-&gt;len == b-&gt;len &amp;&amp;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        x509_memcasecmp( a-&gt;p, b-&gt;p, b-&gt;len ) == 0 )</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    {</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    }</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;}</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment"> * Compare two X.509 Names (aka rdnSequence).</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment"> * See RFC 5280 section 7.1, though we don&#39;t implement the whole algorithm:</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment"> * we sometimes return unequal when the full algorithm would return equal,</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment"> * but never the other way. (In particular, we don&#39;t do Unicode normalisation</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment"> * or space folding.)</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment"> * Return 0 if equal, -1 otherwise.</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_name_cmp( <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__named__data.html">mbedtls_x509_name</a> *a, <span class="keyword">const</span> <a class="code" href="structmbedtls__asn1__named__data.html">mbedtls_x509_name</a> *b )</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;{</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="comment">/* Avoid recursion, it might not be optimised by the compiler */</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordflow">while</span>( a != NULL || b != NULL )</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        <span class="keywordflow">if</span>( a == NULL || b == NULL )</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;            <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <span class="comment">/* type */</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        <span class="keywordflow">if</span>( a-&gt;oid.tag != b-&gt;oid.tag ||</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;            a-&gt;oid.len != b-&gt;oid.len ||</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;            memcmp( a-&gt;oid.p, b-&gt;oid.p, b-&gt;oid.len ) != 0 )</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        {</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;            <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        }</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        <span class="comment">/* value */</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        <span class="keywordflow">if</span>( x509_string_cmp( &amp;a-&gt;val, &amp;b-&gt;val ) != 0 )</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;            <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        <span class="comment">/* structure of the list of sets */</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        <span class="keywordflow">if</span>( a-&gt;next_merged != b-&gt;next_merged )</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;            <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        a = a-&gt;next;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        b = b-&gt;next;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    }</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <span class="comment">/* a == NULL == b */</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;}</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="comment"> * Check if &#39;parent&#39; is a suitable parent (signing CA) for &#39;child&#39;.</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment"> * Return 0 if yes, -1 if not.</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="comment"> * top means parent is a locally-trusted certificate</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment"> * bottom means child is the end entity cert</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_crt_check_parent( <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *child,</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *parent,</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                                  <span class="keywordtype">int</span> top, <span class="keywordtype">int</span> bottom )</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;{</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="keywordtype">int</span> need_ca_bit;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="comment">/* Parent must be the issuer */</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="keywordflow">if</span>( x509_name_cmp( &amp;child-&gt;<a class="code" href="structmbedtls__x509__crt.html#ade48d67edd24629e28361d3fbc0aafd9">issuer</a>, &amp;parent-&gt;subject ) != 0 )</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="comment">/* Parent must have the basicConstraints CA bit set as a general rule */</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    need_ca_bit = 1;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <span class="comment">/* Exception: v1/v2 certificates that are locally trusted. */</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="keywordflow">if</span>( top &amp;&amp; parent-&gt;version &lt; 3 )</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        need_ca_bit = 0;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="comment">/* Exception: self-signed end-entity certs that are locally trusted. */</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keywordflow">if</span>( top &amp;&amp; bottom &amp;&amp;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> == parent-&gt;raw.len &amp;&amp;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        memcmp( child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, parent-&gt;raw.p, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) == 0 )</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    {</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        need_ca_bit = 0;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    }</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="keywordflow">if</span>( need_ca_bit &amp;&amp; ! parent-&gt;ca_istrue )</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_X509_CHECK_KEY_USAGE)</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordflow">if</span>( need_ca_bit &amp;&amp;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        <a class="code" href="group__x509__module.html#ga0ab7857ffd82467207e718bb9f0131a2">mbedtls_x509_crt_check_key_usage</a>( parent, MBEDTLS_X509_KU_KEY_CERT_SIGN ) != 0 )</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    {</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keywordflow">return</span>( -1 );</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    }</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;}</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_crt_verify_top(</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *child, <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *trust_ca,</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                <a class="code" href="structmbedtls__x509__crl.html">mbedtls_x509_crl</a> *ca_crl,</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> *profile,</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                <span class="keywordtype">int</span> path_cnt, <span class="keywordtype">int</span> self_cnt, uint32_t *flags,</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                <span class="keywordtype">int</span> (*f_vrfy)(<span class="keywordtype">void</span> *, <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *, <span class="keywordtype">int</span>, uint32_t *),</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                <span class="keywordtype">void</span> *p_vrfy )</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;{</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    uint32_t ca_flags = 0;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="keywordtype">int</span> check_path_cnt;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> hash[MBEDTLS_MD_MAX_SIZE];</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="keyword">const</span> <a class="code" href="structmbedtls__md__info__t.html">mbedtls_md_info_t</a> *md_info;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <span class="keywordflow">if</span>( mbedtls_x509_time_is_past( &amp;child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a> ) )</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#ga5f03158dcacc5914872e38c68231b642">MBEDTLS_X509_BADCERT_EXPIRED</a>;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keywordflow">if</span>( mbedtls_x509_time_is_future( &amp;child-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a> ) )</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#gac769acbb18e53198ae2d2e63bd339cfa">MBEDTLS_X509_BADCERT_FUTURE</a>;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <span class="keywordflow">if</span>( x509_profile_check_md_alg( profile, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c56937aaf2a51a1d8bc814b142734ca">sig_md</a> ) != 0 )</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#ga41b54b526c11bf51cc431ef1a151816d">MBEDTLS_X509_BADCERT_BAD_MD</a>;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="keywordflow">if</span>( x509_profile_check_pk_alg( profile, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a65d5d20352a08c77e173808fde1f8660">sig_pk</a> ) != 0 )</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#ga9332fa1e09a373cc56234525b14546c4">MBEDTLS_X509_BADCERT_BAD_PK</a>;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment">     * Child is the top of the chain. Check against the trust_ca list.</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    *flags |= <a class="code" href="group__x509__module.html#ga0e5b1d4c9c1a1a3227238c82042c1d1b">MBEDTLS_X509_BADCERT_NOT_TRUSTED</a>;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    md_info = <a class="code" href="md_8h.html#aca53b51e0c8eb0e07c7eb4a3e6acfa0d">mbedtls_md_info_from_type</a>( child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c56937aaf2a51a1d8bc814b142734ca">sig_md</a> );</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    <span class="keywordflow">if</span>( md_info == NULL )</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    {</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="comment">         * Cannot check &#39;unknown&#39;, no need to try any CA</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        trust_ca = NULL;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    }</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;        <a class="code" href="md_8h.html#a36c5d8bda1905e0434708f0ef5912dda">mbedtls_md</a>( md_info, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a44e9a884baad5737ef0930af94ca3f94">tbs</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a44e9a884baad5737ef0930af94ca3f94">tbs</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a>, hash );</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="keywordflow">for</span>( <span class="comment">/* trust_ca */</span> ; trust_ca != NULL; trust_ca = trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a> )</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    {</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        <span class="keywordflow">if</span>( x509_crt_check_parent( child, trust_ca, 1, path_cnt == 0 ) != 0 )</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        check_path_cnt = path_cnt + 1;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="comment">         * Reduce check_path_cnt to check against if top of the chain is</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="comment">         * the same as the trusted CA</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        <span class="keywordflow">if</span>( child-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> == trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> &amp;&amp;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;            memcmp( child-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>,</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                            child-&gt;<a class="code" href="structmbedtls__x509__crt.html#afb876a6a7b85e160620c4549324d9e8d">issuer_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) == 0 )</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        {</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            check_path_cnt--;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        }</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        <span class="comment">/* Self signed certificates do not count towards the limit */</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        <span class="keywordflow">if</span>( trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#ab0af43652f426ace28052ec47fdde6fb">max_pathlen</a> &gt; 0 &amp;&amp;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;            trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#ab0af43652f426ace28052ec47fdde6fb">max_pathlen</a> &lt; check_path_cnt - self_cnt )</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        }</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        <span class="keywordflow">if</span>( mbedtls_x509_time_is_past( &amp;trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a> ) )</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        {</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;        }</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        <span class="keywordflow">if</span>( mbedtls_x509_time_is_future( &amp;trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a> ) )</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        {</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;        }</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="pk_8h.html#a81f0c5e40b839f5eca676c2c2752036f">mbedtls_pk_verify_ext</a>( child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a65d5d20352a08c77e173808fde1f8660">sig_pk</a>, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a67c497ed6535050997c014507a866e9e">sig_opts</a>, &amp;trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a>,</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                           child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c56937aaf2a51a1d8bc814b142734ca">sig_md</a>, hash, <a class="code" href="md_8h.html#ae20f4ddcf2bbf2e59cafc6fab8c993d6">mbedtls_md_get_size</a>( md_info ),</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                           child-&gt;<a class="code" href="structmbedtls__x509__crt.html#aea76ebaa8c8e23129bd905cdc0242a3a">sig</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#aea76ebaa8c8e23129bd905cdc0242a3a">sig</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) != 0 )</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;        {</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        }</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">         * Top of chain is signed by a trusted CA</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        *flags &amp;= ~<a class="code" href="group__x509__module.html#ga0e5b1d4c9c1a1a3227238c82042c1d1b">MBEDTLS_X509_BADCERT_NOT_TRUSTED</a>;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        <span class="keywordflow">if</span>( x509_profile_check_key( profile, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a65d5d20352a08c77e173808fde1f8660">sig_pk</a>, &amp;trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a> ) != 0 )</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;            *flags |= <a class="code" href="group__x509__module.html#gaef5f9a34b327eb79750ebc3779e98282">MBEDTLS_X509_BADCERT_BAD_KEY</a>;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    }</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment">     * If top of chain is not the same as the trusted CA send a verify request</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment">     * to the callback for any issues with validity and CRL presence for the</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment">     * trusted CA certificate.</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="keywordflow">if</span>( trust_ca != NULL &amp;&amp;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        ( child-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> != trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ||</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;          memcmp( child-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, trust_ca-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">subject_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>,</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                            child-&gt;<a class="code" href="structmbedtls__x509__crt.html#afb876a6a7b85e160620c4549324d9e8d">issuer_raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) != 0 ) )</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    {</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_X509_CRL_PARSE_C)</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        <span class="comment">/* Check trusted CA&#39;s CRL for the chain&#39;s top crt */</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        *flags |= x509_crt_verifycrl( child, trust_ca, ca_crl, profile );</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        ((void) ca_crl);</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        <span class="keywordflow">if</span>( NULL != f_vrfy )</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        {</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;            <span class="keywordflow">if</span>( ( ret = f_vrfy( p_vrfy, trust_ca, path_cnt + 1,</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                                &amp;ca_flags ) ) != 0 )</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            {</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;            }</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        }</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    }</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    <span class="comment">/* Call callback on top cert */</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="keywordflow">if</span>( NULL != f_vrfy )</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    {</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        <span class="keywordflow">if</span>( ( ret = f_vrfy( p_vrfy, child, path_cnt, flags ) ) != 0 )</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    }</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    *flags |= ca_flags;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;}</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> x509_crt_verify_child(</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *child, <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *parent,</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;                <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *trust_ca, <a class="code" href="structmbedtls__x509__crl.html">mbedtls_x509_crl</a> *ca_crl,</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> *profile,</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                <span class="keywordtype">int</span> path_cnt, <span class="keywordtype">int</span> self_cnt, uint32_t *flags,</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                <span class="keywordtype">int</span> (*f_vrfy)(<span class="keywordtype">void</span> *, <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *, <span class="keywordtype">int</span>, uint32_t *),</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                <span class="keywordtype">void</span> *p_vrfy )</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;{</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    uint32_t parent_flags = 0;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> hash[MBEDTLS_MD_MAX_SIZE];</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *grandparent;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keyword">const</span> <a class="code" href="structmbedtls__md__info__t.html">mbedtls_md_info_t</a> *md_info;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <span class="comment">/* Counting intermediate self signed certificates */</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordflow">if</span>( ( path_cnt != 0 ) &amp;&amp; x509_name_cmp( &amp;child-&gt;<a class="code" href="structmbedtls__x509__crt.html#ade48d67edd24629e28361d3fbc0aafd9">issuer</a>, &amp;child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a773e92423092ab65e5e50031bd9663a5">subject</a> ) == 0 )</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;        self_cnt++;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="comment">/* path_cnt is 0 for the first intermediate CA */</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordflow">if</span>( 1 + path_cnt &gt; <a class="code" href="group__x509__module.html#gab98caf7dfede54b5c576b5a27a5c6a6a">MBEDTLS_X509_MAX_INTERMEDIATE_CA</a> )</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    {</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#ga0e5b1d4c9c1a1a3227238c82042c1d1b">MBEDTLS_X509_BADCERT_NOT_TRUSTED</a>;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaba46df0041dcf48fa9d164d28cf3a154">MBEDTLS_ERR_X509_CERT_VERIFY_FAILED</a> );</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    }</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    <span class="keywordflow">if</span>( mbedtls_x509_time_is_past( &amp;child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">valid_to</a> ) )</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#ga5f03158dcacc5914872e38c68231b642">MBEDTLS_X509_BADCERT_EXPIRED</a>;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">if</span>( mbedtls_x509_time_is_future( &amp;child-&gt;<a class="code" href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">valid_from</a> ) )</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#gac769acbb18e53198ae2d2e63bd339cfa">MBEDTLS_X509_BADCERT_FUTURE</a>;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keywordflow">if</span>( x509_profile_check_md_alg( profile, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c56937aaf2a51a1d8bc814b142734ca">sig_md</a> ) != 0 )</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#ga41b54b526c11bf51cc431ef1a151816d">MBEDTLS_X509_BADCERT_BAD_MD</a>;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <span class="keywordflow">if</span>( x509_profile_check_pk_alg( profile, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a65d5d20352a08c77e173808fde1f8660">sig_pk</a> ) != 0 )</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#ga9332fa1e09a373cc56234525b14546c4">MBEDTLS_X509_BADCERT_BAD_PK</a>;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    md_info = <a class="code" href="md_8h.html#aca53b51e0c8eb0e07c7eb4a3e6acfa0d">mbedtls_md_info_from_type</a>( child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c56937aaf2a51a1d8bc814b142734ca">sig_md</a> );</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    <span class="keywordflow">if</span>( md_info == NULL )</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    {</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="comment">         * Cannot check &#39;unknown&#39; hash</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#ga0e5b1d4c9c1a1a3227238c82042c1d1b">MBEDTLS_X509_BADCERT_NOT_TRUSTED</a>;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    }</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        <a class="code" href="md_8h.html#a36c5d8bda1905e0434708f0ef5912dda">mbedtls_md</a>( md_info, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a44e9a884baad5737ef0930af94ca3f94">tbs</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a44e9a884baad5737ef0930af94ca3f94">tbs</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a>, hash );</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        <span class="keywordflow">if</span>( x509_profile_check_key( profile, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a65d5d20352a08c77e173808fde1f8660">sig_pk</a>, &amp;parent-&gt;pk ) != 0 )</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;            *flags |= <a class="code" href="group__x509__module.html#gaef5f9a34b327eb79750ebc3779e98282">MBEDTLS_X509_BADCERT_BAD_KEY</a>;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="pk_8h.html#a81f0c5e40b839f5eca676c2c2752036f">mbedtls_pk_verify_ext</a>( child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a65d5d20352a08c77e173808fde1f8660">sig_pk</a>, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a67c497ed6535050997c014507a866e9e">sig_opts</a>, &amp;parent-&gt;pk,</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;                           child-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5c56937aaf2a51a1d8bc814b142734ca">sig_md</a>, hash, <a class="code" href="md_8h.html#ae20f4ddcf2bbf2e59cafc6fab8c993d6">mbedtls_md_get_size</a>( md_info ),</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;                           child-&gt;<a class="code" href="structmbedtls__x509__crt.html#aea76ebaa8c8e23129bd905cdc0242a3a">sig</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, child-&gt;<a class="code" href="structmbedtls__x509__crt.html#aea76ebaa8c8e23129bd905cdc0242a3a">sig</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> ) != 0 )</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        {</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;            *flags |= <a class="code" href="group__x509__module.html#ga0e5b1d4c9c1a1a3227238c82042c1d1b">MBEDTLS_X509_BADCERT_NOT_TRUSTED</a>;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        }</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    }</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_X509_CRL_PARSE_C)</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    <span class="comment">/* Check trusted CA&#39;s CRL for the given crt */</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    *flags |= x509_crt_verifycrl(child, parent, ca_crl, profile );</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="comment">/* Look for a grandparent in trusted CAs */</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="keywordflow">for</span>( grandparent = trust_ca;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;         grandparent != NULL;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;         grandparent = grandparent-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a> )</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    {</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        <span class="keywordflow">if</span>( x509_crt_check_parent( parent, grandparent,</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                                   0, path_cnt == 0 ) == 0 )</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    }</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    <span class="keywordflow">if</span>( grandparent != NULL )</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    {</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        ret = x509_crt_verify_top( parent, grandparent, ca_crl, profile,</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                                path_cnt + 1, self_cnt, &amp;parent_flags, f_vrfy, p_vrfy );</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    }</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    {</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;        <span class="comment">/* Look for a grandparent upwards the chain */</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        <span class="keywordflow">for</span>( grandparent = parent-&gt;next;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;             grandparent != NULL;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;             grandparent = grandparent-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a> )</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        {</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;            <span class="comment">/* +2 because the current step is not yet accounted for</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="comment">             * and because max_pathlen is one higher than it should be.</span></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="comment">             * Also self signed certificates do not count to the limit. */</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            <span class="keywordflow">if</span>( grandparent-&gt;<a class="code" href="structmbedtls__x509__crt.html#ab0af43652f426ace28052ec47fdde6fb">max_pathlen</a> &gt; 0 &amp;&amp;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                grandparent-&gt;<a class="code" href="structmbedtls__x509__crt.html#ab0af43652f426ace28052ec47fdde6fb">max_pathlen</a> &lt; 2 + path_cnt - self_cnt )</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;            {</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;            }</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;            <span class="keywordflow">if</span>( x509_crt_check_parent( parent, grandparent,</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                                       0, path_cnt == 0 ) == 0 )</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        }</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        <span class="comment">/* Is our parent part of the chain or at the top? */</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        <span class="keywordflow">if</span>( grandparent != NULL )</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        {</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;            ret = x509_crt_verify_child( parent, grandparent, trust_ca, ca_crl,</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                                         profile, path_cnt + 1, self_cnt, &amp;parent_flags,</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                                         f_vrfy, p_vrfy );</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;            <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        }</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        {</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;            ret = x509_crt_verify_top( parent, trust_ca, ca_crl, profile,</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                                       path_cnt + 1, self_cnt, &amp;parent_flags,</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                                       f_vrfy, p_vrfy );</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        }</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    }</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="comment">/* child is verified to be a child of the parent, call verify callback */</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    <span class="keywordflow">if</span>( NULL != f_vrfy )</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;        <span class="keywordflow">if</span>( ( ret = f_vrfy( p_vrfy, child, path_cnt, flags ) ) != 0 )</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    *flags |= parent_flags;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;}</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="comment"> * Verify the certificate validity</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#ga98ed4504e4f832b735a230acf54fcde3">mbedtls_x509_crt_verify</a>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt,</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                     <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *trust_ca,</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                     <a class="code" href="structmbedtls__x509__crl.html">mbedtls_x509_crl</a> *ca_crl,</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">char</span> *cn, uint32_t *flags,</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                     <span class="keywordtype">int</span> (*f_vrfy)(<span class="keywordtype">void</span> *, <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *, <span class="keywordtype">int</span>, uint32_t *),</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                     <span class="keywordtype">void</span> *p_vrfy )</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;{</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaf044a51e5b5bc854bf12aeeccb440e55">mbedtls_x509_crt_verify_with_profile</a>( crt, trust_ca, ca_crl,</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                &amp;<a class="code" href="group__x509__module.html#ga9cd2de10ffeff0f339abcc1ba7e26fdf">mbedtls_x509_crt_profile_default</a>, cn, flags, f_vrfy, p_vrfy ) );</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;}</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment"> * Verify the certificate validity, with profile</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="keywordtype">int</span> <a class="code" href="group__x509__module.html#gaf044a51e5b5bc854bf12aeeccb440e55">mbedtls_x509_crt_verify_with_profile</a>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt,</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                     <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *trust_ca,</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                     <a class="code" href="structmbedtls__x509__crl.html">mbedtls_x509_crl</a> *ca_crl,</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                     <span class="keyword">const</span> <a class="code" href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a> *profile,</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">char</span> *cn, uint32_t *flags,</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                     <span class="keywordtype">int</span> (*f_vrfy)(<span class="keywordtype">void</span> *, <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *, <span class="keywordtype">int</span>, uint32_t *),</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                     <span class="keywordtype">void</span> *p_vrfy )</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;{</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="keywordtype">size_t</span> cn_len;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <span class="keywordtype">int</span> pathlen = 0, selfsigned = 0;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *parent;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    <a class="code" href="structmbedtls__asn1__named__data.html">mbedtls_x509_name</a> *name;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *cur = NULL;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <a class="code" href="pk_8h.html#a3fe41eff5605ae727eb9d28dad297020">mbedtls_pk_type_t</a> pk_type;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    <span class="keywordflow">if</span>( profile == NULL )</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a> );</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    *flags = 0;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    <span class="keywordflow">if</span>( cn != NULL )</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    {</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        name = &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a773e92423092ab65e5e50031bd9663a5">subject</a>;</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        cn_len = strlen( cn );</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        <span class="keywordflow">if</span>( crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">ext_types</a> &amp; MBEDTLS_X509_EXT_SUBJECT_ALT_NAME )</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        {</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;            cur = &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a1f148e8fb52e03e2604e716386a07df4">subject_alt_names</a>;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;            <span class="keywordflow">while</span>( cur != NULL )</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;            {</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                <span class="keywordflow">if</span>( cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> == cn_len &amp;&amp;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                    x509_memcasecmp( cn, cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, cn_len ) == 0 )</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                <span class="keywordflow">if</span>( cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> &gt; 2 &amp;&amp;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                    memcmp( cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, <span class="stringliteral">&quot;*.&quot;</span>, 2 ) == 0 &amp;&amp;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                    x509_check_wildcard( cn, &amp;cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">buf</a> ) == 0 )</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                {</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                }</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                cur = cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a>;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;            }</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;            <span class="keywordflow">if</span>( cur == NULL )</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                *flags |= <a class="code" href="group__x509__module.html#ga6e71468985ebf243ca7cfce5c3dea881">MBEDTLS_X509_BADCERT_CN_MISMATCH</a>;</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        }</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        {</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;            <span class="keywordflow">while</span>( name != NULL )</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;            {</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="asn1_8h.html#a0b81f225b3551ec7c4da69b2d183d10b">MBEDTLS_OID_CMP</a>( <a class="code" href="oid_8h.html#aed77a0ed6d223075b9fb1f346368cf89">MBEDTLS_OID_AT_CN</a>, &amp;name-&gt;oid ) == 0 )</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                {</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                    <span class="keywordflow">if</span>( name-&gt;val.len == cn_len &amp;&amp;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                        x509_memcasecmp( name-&gt;val.p, cn, cn_len ) == 0 )</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                    <span class="keywordflow">if</span>( name-&gt;val.len &gt; 2 &amp;&amp;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                        memcmp( name-&gt;val.p, <span class="stringliteral">&quot;*.&quot;</span>, 2 ) == 0 &amp;&amp;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                        x509_check_wildcard( cn, &amp;name-&gt;val ) == 0 )</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                }</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                name = name-&gt;next;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;            }</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            <span class="keywordflow">if</span>( name == NULL )</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                *flags |= <a class="code" href="group__x509__module.html#ga6e71468985ebf243ca7cfce5c3dea881">MBEDTLS_X509_BADCERT_CN_MISMATCH</a>;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        }</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    }</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    <span class="comment">/* Check the type and size of the key */</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    pk_type = <a class="code" href="pk_8h.html#ab568e6594c1c4cffaa5046e1e0cada55">mbedtls_pk_get_type</a>( &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a> );</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    <span class="keywordflow">if</span>( x509_profile_check_pk_alg( profile, pk_type ) != 0 )</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#ga9332fa1e09a373cc56234525b14546c4">MBEDTLS_X509_BADCERT_BAD_PK</a>;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    <span class="keywordflow">if</span>( x509_profile_check_key( profile, pk_type, &amp;crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a> ) != 0 )</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        *flags |= <a class="code" href="group__x509__module.html#gaef5f9a34b327eb79750ebc3779e98282">MBEDTLS_X509_BADCERT_BAD_KEY</a>;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    <span class="comment">/* Look for a parent in trusted CAs */</span></div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    <span class="keywordflow">for</span>( parent = trust_ca; parent != NULL; parent = parent-&gt;next )</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    {</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        <span class="keywordflow">if</span>( x509_crt_check_parent( crt, parent, 0, pathlen == 0 ) == 0 )</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    }</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;    <span class="keywordflow">if</span>( parent != NULL )</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    {</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;        ret = x509_crt_verify_top( crt, parent, ca_crl, profile,</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                                   pathlen, selfsigned, flags, f_vrfy, p_vrfy );</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;        <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    }</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    {</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <span class="comment">/* Look for a parent upwards the chain */</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="keywordflow">for</span>( parent = crt-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a>; parent != NULL; parent = parent-&gt;next )</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;            <span class="keywordflow">if</span>( x509_crt_check_parent( crt, parent, 0, pathlen == 0 ) == 0 )</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        <span class="comment">/* Are we part of the chain or at the top? */</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        <span class="keywordflow">if</span>( parent != NULL )</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        {</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;            ret = x509_crt_verify_child( crt, parent, trust_ca, ca_crl, profile,</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                                         pathlen, selfsigned, flags, f_vrfy, p_vrfy );</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;            <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        }</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        {</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;            ret = x509_crt_verify_top( crt, trust_ca, ca_crl, profile,</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;                                       pathlen, selfsigned, flags, f_vrfy, p_vrfy );</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;            <span class="keywordflow">if</span>( ret != 0 )</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                <span class="keywordflow">return</span>( ret );</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        }</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    }</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    <span class="keywordflow">if</span>( *flags != 0 )</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        <span class="keywordflow">return</span>( <a class="code" href="group__x509__module.html#gaba46df0041dcf48fa9d164d28cf3a154">MBEDTLS_ERR_X509_CERT_VERIFY_FAILED</a> );</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <span class="keywordflow">return</span>( 0 );</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;}</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="comment"> * Initialize a certificate chain</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__x509__module.html#ga016dd06bc770e77b84005f305df20ed1">mbedtls_x509_crt_init</a>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt )</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;{</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    memset( crt, 0, <span class="keyword">sizeof</span>(<a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a>) );</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;}</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment"> * Unallocate all certificate data</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *crt )</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;{</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *cert_cur = crt;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> *cert_prv;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    <a class="code" href="structmbedtls__asn1__named__data.html">mbedtls_x509_name</a> *name_cur;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    <a class="code" href="structmbedtls__asn1__named__data.html">mbedtls_x509_name</a> *name_prv;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *seq_cur;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> *seq_prv;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    <span class="keywordflow">if</span>( crt == NULL )</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    <span class="keywordflow">do</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    {</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        <a class="code" href="pk_8h.html#ac6a9786d96abfd73c4dff6814238feb9">mbedtls_pk_free</a>( &amp;cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">pk</a> );</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="preprocessor">#if defined(MBEDTLS_X509_RSASSA_PSS_SUPPORT)</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        mbedtls_free( cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#a67c497ed6535050997c014507a866e9e">sig_opts</a> );</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;        name_cur = cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#ade48d67edd24629e28361d3fbc0aafd9">issuer</a>.<a class="code" href="structmbedtls__asn1__named__data.html#a38f29c37c55319b3c0a9c998c3e5bd0d">next</a>;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;        <span class="keywordflow">while</span>( name_cur != NULL )</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;        {</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;            name_prv = name_cur;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;            name_cur = name_cur-&gt;<a class="code" href="structmbedtls__asn1__named__data.html#a38f29c37c55319b3c0a9c998c3e5bd0d">next</a>;</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;            mbedtls_zeroize( name_prv, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__asn1__named__data.html">mbedtls_x509_name</a> ) );</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;            mbedtls_free( name_prv );</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;        }</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;        name_cur = cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#a773e92423092ab65e5e50031bd9663a5">subject</a>.<a class="code" href="structmbedtls__asn1__named__data.html#a38f29c37c55319b3c0a9c998c3e5bd0d">next</a>;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;        <span class="keywordflow">while</span>( name_cur != NULL )</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;        {</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;            name_prv = name_cur;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            name_cur = name_cur-&gt;<a class="code" href="structmbedtls__asn1__named__data.html#a38f29c37c55319b3c0a9c998c3e5bd0d">next</a>;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;            mbedtls_zeroize( name_prv, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__asn1__named__data.html">mbedtls_x509_name</a> ) );</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;            mbedtls_free( name_prv );</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;        }</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;        seq_cur = cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac94f7360a7143ce1b983fab46c34dcf2">ext_key_usage</a>.<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a>;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;        <span class="keywordflow">while</span>( seq_cur != NULL )</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;        {</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;            seq_prv = seq_cur;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;            seq_cur = seq_cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a>;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;            mbedtls_zeroize( seq_prv, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> ) );</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;            mbedtls_free( seq_prv );</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        }</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;        seq_cur = cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#a1f148e8fb52e03e2604e716386a07df4">subject_alt_names</a>.<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a>;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;        <span class="keywordflow">while</span>( seq_cur != NULL )</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;        {</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;            seq_prv = seq_cur;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;            seq_cur = seq_cur-&gt;<a class="code" href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">next</a>;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;            mbedtls_zeroize( seq_prv, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__asn1__sequence.html">mbedtls_x509_sequence</a> ) );</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;            mbedtls_free( seq_prv );</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;        }</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;        <span class="keywordflow">if</span>( cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> != NULL )</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;        {</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;            mbedtls_zeroize( cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a>, cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">len</a> );</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;            mbedtls_free( cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">raw</a>.<a class="code" href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">p</a> );</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;        }</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;        cert_cur = cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a>;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    }</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;    <span class="keywordflow">while</span>( cert_cur != NULL );</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    cert_cur = crt;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <span class="keywordflow">do</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    {</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        cert_prv = cert_cur;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;        cert_cur = cert_cur-&gt;<a class="code" href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">next</a>;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;        mbedtls_zeroize( cert_prv, <span class="keyword">sizeof</span>( <a class="code" href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a> ) );</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        <span class="keywordflow">if</span>( cert_prv != crt )</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;            mbedtls_free( cert_prv );</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;    }</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    <span class="keywordflow">while</span>( cert_cur != NULL );</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;}</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MBEDTLS_X509_CRT_PARSE_C */</span><span class="preprocessor"></span></div><div class="ttc" id="oid_8h_html_a962c76f60bc09ae7174027f8d4111753"><div class="ttname"><a href="oid_8h.html#a962c76f60bc09ae7174027f8d4111753">mbedtls_oid_get_x509_ext_type</a></div><div class="ttdeci">int mbedtls_oid_get_x509_ext_type(const mbedtls_asn1_buf *oid, int *ext_type)</div><div class="ttdoc">Translate an X.509 extension OID into local values. </div></div>
<div class="ttc" id="group__x509__module_html_gaba46df0041dcf48fa9d164d28cf3a154"><div class="ttname"><a href="group__x509__module.html#gaba46df0041dcf48fa9d164d28cf3a154">MBEDTLS_ERR_X509_CERT_VERIFY_FAILED</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_CERT_VERIFY_FAILED</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00073">x509.h:73</a></div></div>
<div class="ttc" id="group__x509__module_html_gad3f810fb74f94164185b88b90fffa329"><div class="ttname"><a href="group__x509__module.html#gad3f810fb74f94164185b88b90fffa329">MBEDTLS_X509_BADCRL_BAD_MD</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCRL_BAD_MD</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00103">x509.h:103</a></div></div>
<div class="ttc" id="structmbedtls__x509__crl__entry_html"><div class="ttname"><a href="structmbedtls__x509__crl__entry.html">mbedtls_x509_crl_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="c-libp2p_2include_2mbedtls_2x509__crl_8h_source.html#l00051">x509_crl.h:51</a></div></div>
<div class="ttc" id="group__x509__module_html_ga98ed4504e4f832b735a230acf54fcde3"><div class="ttname"><a href="group__x509__module.html#ga98ed4504e4f832b735a230acf54fcde3">mbedtls_x509_crt_verify</a></div><div class="ttdeci">int mbedtls_x509_crt_verify(mbedtls_x509_crt *crt, mbedtls_x509_crt *trust_ca, mbedtls_x509_crl *ca_crl, const char *cn, uint32_t *flags, int(*f_vrfy)(void *, mbedtls_x509_crt *, int, uint32_t *), void *p_vrfy)</div><div class="ttdoc">Verify the certificate signature. </div></div>
<div class="ttc" id="structmbedtls__pk__context_html"><div class="ttname"><a href="structmbedtls__pk__context.html">mbedtls_pk_context</a></div><div class="ttdoc">Public key container. </div><div class="ttdef"><b>Definition:</b> <a href="pk_8h_source.html#l00126">pk.h:126</a></div></div>
<div class="ttc" id="pk_8h_html_a261a06b48443981316e19bd1c2c377f9"><div class="ttname"><a href="pk_8h.html#a261a06b48443981316e19bd1c2c377f9">mbedtls_pk_parse_subpubkey</a></div><div class="ttdeci">int mbedtls_pk_parse_subpubkey(unsigned char **p, const unsigned char *end, mbedtls_pk_context *pk)</div><div class="ttdoc">Parse a SubjectPublicKeyInfo DER structure. </div></div>
<div class="ttc" id="group__x509__module_html_ga527608dc04b2c831fe5b161ec26aab76"><div class="ttname"><a href="group__x509__module.html#ga527608dc04b2c831fe5b161ec26aab76">MBEDTLS_ERR_X509_INVALID_VERSION</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_INVALID_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00063">x509.h:63</a></div></div>
<div class="ttc" id="group__asn1__module_html_ga0ebe8e0a4894533db505303504eea59b"><div class="ttname"><a href="group__asn1__module.html#ga0ebe8e0a4894533db505303504eea59b">MBEDTLS_ERR_ASN1_INVALID_LENGTH</a></div><div class="ttdeci">#define MBEDTLS_ERR_ASN1_INVALID_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00052">asn1.h:52</a></div></div>
<div class="ttc" id="structmbedtls__x509__crl_html_aaf0d47225a63a5d9bf0e2e99d641e72d"><div class="ttname"><a href="structmbedtls__x509__crl.html#aaf0d47225a63a5d9bf0e2e99d641e72d">mbedtls_x509_crl::version</a></div><div class="ttdeci">int version</div><div class="ttdef"><b>Definition:</b> <a href="c-libp2p_2include_2mbedtls_2x509__crl_8h_source.html#l00074">x509_crl.h:74</a></div></div>
<div class="ttc" id="group__x509__module_html_gaf044a51e5b5bc854bf12aeeccb440e55"><div class="ttname"><a href="group__x509__module.html#gaf044a51e5b5bc854bf12aeeccb440e55">mbedtls_x509_crt_verify_with_profile</a></div><div class="ttdeci">int mbedtls_x509_crt_verify_with_profile(mbedtls_x509_crt *crt, mbedtls_x509_crt *trust_ca, mbedtls_x509_crl *ca_crl, const mbedtls_x509_crt_profile *profile, const char *cn, uint32_t *flags, int(*f_vrfy)(void *, mbedtls_x509_crt *, int, uint32_t *), void *p_vrfy)</div><div class="ttdoc">Verify the certificate signature according to profile. </div></div>
<div class="ttc" id="group__x509__module_html_gac36bf085ce8f7f57f039bda8828bd824"><div class="ttname"><a href="group__x509__module.html#gac36bf085ce8f7f57f039bda8828bd824">MBEDTLS_ERR_X509_INVALID_DATE</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_INVALID_DATE</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00067">x509.h:67</a></div></div>
<div class="ttc" id="group__x509__module_html_gaef5f9a34b327eb79750ebc3779e98282"><div class="ttname"><a href="group__x509__module.html#gaef5f9a34b327eb79750ebc3779e98282">MBEDTLS_X509_BADCERT_BAD_KEY</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_BAD_KEY</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00102">x509.h:102</a></div></div>
<div class="ttc" id="group__x509__module_html_ga45b8366804b7e2cbf3e25011f054802c"><div class="ttname"><a href="group__x509__module.html#ga45b8366804b7e2cbf3e25011f054802c">MBEDTLS_ERR_X509_INVALID_FORMAT</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_INVALID_FORMAT</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00062">x509.h:62</a></div></div>
<div class="ttc" id="structmbedtls__asn1__buf_html_a0af0cf9b0801a21ce4652e859876f195"><div class="ttname"><a href="structmbedtls__asn1__buf.html#a0af0cf9b0801a21ce4652e859876f195">mbedtls_asn1_buf::p</a></div><div class="ttdeci">unsigned char * p</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00122">asn1.h:122</a></div></div>
<div class="ttc" id="structmbedtls__asn1__bitstring_html_af09328f8b1a8cb5bf4afae369ce3629c"><div class="ttname"><a href="structmbedtls__asn1__bitstring.html#af09328f8b1a8cb5bf4afae369ce3629c">mbedtls_asn1_bitstring::p</a></div><div class="ttdeci">unsigned char * p</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00133">asn1.h:133</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a1f148e8fb52e03e2604e716386a07df4"><div class="ttname"><a href="structmbedtls__x509__crt.html#a1f148e8fb52e03e2604e716386a07df4">mbedtls_x509_crt::subject_alt_names</a></div><div class="ttdeci">mbedtls_x509_sequence subject_alt_names</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00075">x509_crt.h:75</a></div></div>
<div class="ttc" id="asn1_8h_html_ae8d7dd42a3b99b61d2ef60bc0c2eaf0d"><div class="ttname"><a href="asn1_8h.html#ae8d7dd42a3b99b61d2ef60bc0c2eaf0d">mbedtls_asn1_get_tag</a></div><div class="ttdeci">int mbedtls_asn1_get_tag(unsigned char **p, const unsigned char *end, size_t *len, int tag)</div><div class="ttdoc">Get the tag and length of the tag. Check for the requested tag. Updates the pointer to immediately be...</div></div>
<div class="ttc" id="structmbedtls__asn1__sequence_html_a6ef535e31a30926169ee6877af393434"><div class="ttname"><a href="structmbedtls__asn1__sequence.html#a6ef535e31a30926169ee6877af393434">mbedtls_asn1_sequence::buf</a></div><div class="ttdeci">mbedtls_asn1_buf buf</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00142">asn1.h:142</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a60878e1cb7a3058f19042d8f189158b0"><div class="ttname"><a href="structmbedtls__x509__crt.html#a60878e1cb7a3058f19042d8f189158b0">mbedtls_x509_crt::ext_types</a></div><div class="ttdeci">int ext_types</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00077">x509_crt.h:77</a></div></div>
<div class="ttc" id="group__x509__module_html_gacf6d98c6cbb76728260d1dcb1fe3bc7d"><div class="ttname"><a href="group__x509__module.html#gacf6d98c6cbb76728260d1dcb1fe3bc7d">MBEDTLS_ERR_X509_ALLOC_FAILED</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_ALLOC_FAILED</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00076">x509.h:76</a></div></div>
<div class="ttc" id="group__x509__module_html_gab9516fc53ff90c547fd77d35c71feec7"><div class="ttname"><a href="group__x509__module.html#gab9516fc53ff90c547fd77d35c71feec7">MBEDTLS_ERR_X509_BUFFER_TOO_SMALL</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_BUFFER_TOO_SMALL</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00078">x509.h:78</a></div></div>
<div class="ttc" id="ecp_8h_html_af79e530ea8f8416480f805baa20b1a2da803c5f7c0d68be4556a688746be1c9e1"><div class="ttname"><a href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2da803c5f7c0d68be4556a688746be1c9e1">MBEDTLS_ECP_DP_BP512R1</a></div><div class="ttdef"><b>Definition:</b> <a href="ecp_8h_source.html#l00063">ecp.h:63</a></div></div>
<div class="ttc" id="group__x509__module_html_gab80a4eb806328731def21ec2ebcbc365"><div class="ttname"><a href="group__x509__module.html#gab80a4eb806328731def21ec2ebcbc365">MBEDTLS_ERR_X509_UNKNOWN_VERSION</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_UNKNOWN_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00070">x509.h:70</a></div></div>
<div class="ttc" id="pk_8h_html_a81f0c5e40b839f5eca676c2c2752036f"><div class="ttname"><a href="pk_8h.html#a81f0c5e40b839f5eca676c2c2752036f">mbedtls_pk_verify_ext</a></div><div class="ttdeci">int mbedtls_pk_verify_ext(mbedtls_pk_type_t type, const void *options, mbedtls_pk_context *ctx, mbedtls_md_type_t md_alg, const unsigned char *hash, size_t hash_len, const unsigned char *sig, size_t sig_len)</div><div class="ttdoc">Verify signature, with options. (Includes verification of the padding depending on type...</div></div>
<div class="ttc" id="structmbedtls__x509__crt__profile_html_a8149f4d17f3f465e2255f5af997e4c8e"><div class="ttname"><a href="structmbedtls__x509__crt__profile.html#a8149f4d17f3f465e2255f5af997e4c8e">mbedtls_x509_crt_profile::allowed_curves</a></div><div class="ttdeci">uint32_t allowed_curves</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00111">x509_crt.h:111</a></div></div>
<div class="ttc" id="structmbedtls__x509__crl_html"><div class="ttname"><a href="structmbedtls__x509__crl.html">mbedtls_x509_crl</a></div><div class="ttdef"><b>Definition:</b> <a href="c-libp2p_2include_2mbedtls_2x509__crl_8h_source.html#l00069">x509_crl.h:69</a></div></div>
<div class="ttc" id="group__x509__module_html_ga76bdd50937a671ef62474b7e38e23e02"><div class="ttname"><a href="group__x509__module.html#ga76bdd50937a671ef62474b7e38e23e02">MBEDTLS_X509_BADCERT_OTHER</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_OTHER</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00094">x509.h:94</a></div></div>
<div class="ttc" id="structmbedtls__x509__crl_html_a009d0e1b844df85a2389ec10b770a6f6"><div class="ttname"><a href="structmbedtls__x509__crl.html#a009d0e1b844df85a2389ec10b770a6f6">mbedtls_x509_crl::issuer_raw</a></div><div class="ttdeci">mbedtls_x509_buf issuer_raw</div><div class="ttdef"><b>Definition:</b> <a href="c-libp2p_2include_2mbedtls_2x509__crl_8h_source.html#l00077">x509_crl.h:77</a></div></div>
<div class="ttc" id="group__x509__module_html_ga003c2483a2691e025641fa9d68d4a96a"><div class="ttname"><a href="group__x509__module.html#ga003c2483a2691e025641fa9d68d4a96a">mbedtls_x509_crt_parse_der</a></div><div class="ttdeci">int mbedtls_x509_crt_parse_der(mbedtls_x509_crt *chain, const unsigned char *buf, size_t buflen)</div><div class="ttdoc">Parse a single DER formatted certificate and add it to the chained list. </div></div>
<div class="ttc" id="group__x509__module_html_gaebccb1707af21f2d3d6610a7c6485f32"><div class="ttname"><a href="group__x509__module.html#gaebccb1707af21f2d3d6610a7c6485f32">MBEDTLS_X509_BADCRL_EXPIRED</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCRL_EXPIRED</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00091">x509.h:91</a></div></div>
<div class="ttc" id="pk_8h_html_a4a31083a590b155dd54d22cf618eefcc"><div class="ttname"><a href="pk_8h.html#a4a31083a590b155dd54d22cf618eefcc">mbedtls_pk_get_bitlen</a></div><div class="ttdeci">size_t mbedtls_pk_get_bitlen(const mbedtls_pk_context *ctx)</div><div class="ttdoc">Get the size in bits of the underlying key. </div></div>
<div class="ttc" id="structmbedtls__asn1__buf_html_abcca2df9a773acd5b59831ac55993dd1"><div class="ttname"><a href="structmbedtls__asn1__buf.html#abcca2df9a773acd5b59831ac55993dd1">mbedtls_asn1_buf::tag</a></div><div class="ttdeci">int tag</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00120">asn1.h:120</a></div></div>
<div class="ttc" id="pk_8h_html_a3fe41eff5605ae727eb9d28dad297020"><div class="ttname"><a href="pk_8h.html#a3fe41eff5605ae727eb9d28dad297020">mbedtls_pk_type_t</a></div><div class="ttdeci">mbedtls_pk_type_t</div><div class="ttdoc">Public key types. </div><div class="ttdef"><b>Definition:</b> <a href="pk_8h_source.html#l00074">pk.h:74</a></div></div>
<div class="ttc" id="group__x509__module_html_ga0dc256a70f90cb68002d53bafffab232"><div class="ttname"><a href="group__x509__module.html#ga0dc256a70f90cb68002d53bafffab232">mbedtls_x509_crt_is_revoked</a></div><div class="ttdeci">int mbedtls_x509_crt_is_revoked(const mbedtls_x509_crt *crt, const mbedtls_x509_crl *crl)</div><div class="ttdoc">Verify the certificate revocation status. </div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_ac9dbc43b90ddd74fe55452495a304923"><div class="ttname"><a href="structmbedtls__x509__crt.html#ac9dbc43b90ddd74fe55452495a304923">mbedtls_x509_crt::next</a></div><div class="ttdeci">struct mbedtls_x509_crt * next</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00092">x509_crt.h:92</a></div></div>
<div class="ttc" id="structmbedtls__asn1__sequence_html"><div class="ttname"><a href="structmbedtls__asn1__sequence.html">mbedtls_asn1_sequence</a></div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00140">asn1.h:140</a></div></div>
<div class="ttc" id="oid_8h_html_a5f8ddcd81a3857571001628d3410bb68"><div class="ttname"><a href="oid_8h.html#a5f8ddcd81a3857571001628d3410bb68">mbedtls_oid_get_extended_key_usage</a></div><div class="ttdeci">int mbedtls_oid_get_extended_key_usage(const mbedtls_asn1_buf *oid, const char **desc)</div><div class="ttdoc">Translate Extended Key Usage OID into description. </div></div>
<div class="ttc" id="platform_8h_html"><div class="ttname"><a href="platform_8h.html">platform.h</a></div><div class="ttdoc">mbed TLS Platform abstraction layer </div></div>
<div class="ttc" id="group__x509__module_html_ga9cd2de10ffeff0f339abcc1ba7e26fdf"><div class="ttname"><a href="group__x509__module.html#ga9cd2de10ffeff0f339abcc1ba7e26fdf">mbedtls_x509_crt_profile_default</a></div><div class="ttdeci">const mbedtls_x509_crt_profile mbedtls_x509_crt_profile_default</div></div>
<div class="ttc" id="group__x509__module_html_ga0ab7857ffd82467207e718bb9f0131a2"><div class="ttname"><a href="group__x509__module.html#ga0ab7857ffd82467207e718bb9f0131a2">mbedtls_x509_crt_check_key_usage</a></div><div class="ttdeci">int mbedtls_x509_crt_check_key_usage(const mbedtls_x509_crt *crt, unsigned int usage)</div><div class="ttdoc">Check usage of certificate against keyUsage extension. </div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_ade48d67edd24629e28361d3fbc0aafd9"><div class="ttname"><a href="structmbedtls__x509__crt.html#ade48d67edd24629e28361d3fbc0aafd9">mbedtls_x509_crt::issuer</a></div><div class="ttdeci">mbedtls_x509_name issuer</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00064">x509_crt.h:64</a></div></div>
<div class="ttc" id="group__x509__module_html_gac769acbb18e53198ae2d2e63bd339cfa"><div class="ttname"><a href="group__x509__module.html#gac769acbb18e53198ae2d2e63bd339cfa">MBEDTLS_X509_BADCERT_FUTURE</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_FUTURE</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00095">x509.h:95</a></div></div>
<div class="ttc" id="group__asn1__module_html_gacf6fad8d80fa050c3463539412674a20"><div class="ttname"><a href="group__asn1__module.html#gacf6fad8d80fa050c3463539412674a20">MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</a></div><div class="ttdeci">#define MBEDTLS_ERR_ASN1_LENGTH_MISMATCH</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00053">asn1.h:53</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_adbbaba207a103a73f41b4b72ffc540f5"><div class="ttname"><a href="structmbedtls__x509__crt.html#adbbaba207a103a73f41b4b72ffc540f5">mbedtls_x509_crt::subject_id</a></div><div class="ttdeci">mbedtls_x509_buf subject_id</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00073">x509_crt.h:73</a></div></div>
<div class="ttc" id="oid_8h_html"><div class="ttname"><a href="oid_8h.html">oid.h</a></div><div class="ttdoc">Object Identifier (OID) database. </div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a44e9a884baad5737ef0930af94ca3f94"><div class="ttname"><a href="structmbedtls__x509__crt.html#a44e9a884baad5737ef0930af94ca3f94">mbedtls_x509_crt::tbs</a></div><div class="ttdeci">mbedtls_x509_buf tbs</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00055">x509_crt.h:55</a></div></div>
<div class="ttc" id="group__x509__module_html_ga9332fa1e09a373cc56234525b14546c4"><div class="ttname"><a href="group__x509__module.html#ga9332fa1e09a373cc56234525b14546c4">MBEDTLS_X509_BADCERT_BAD_PK</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_BAD_PK</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00101">x509.h:101</a></div></div>
<div class="ttc" id="structmbedtls__x509__crl_html_a880036b1b4a2b449542f8f1fa389694f"><div class="ttname"><a href="structmbedtls__x509__crl.html#a880036b1b4a2b449542f8f1fa389694f">mbedtls_x509_crl::entry</a></div><div class="ttdeci">mbedtls_x509_crl_entry entry</div><div class="ttdef"><b>Definition:</b> <a href="c-libp2p_2include_2mbedtls_2x509__crl_8h_source.html#l00084">x509_crl.h:84</a></div></div>
<div class="ttc" id="structmbedtls__asn1__named__data_html"><div class="ttname"><a href="structmbedtls__asn1__named__data.html">mbedtls_asn1_named_data</a></div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00150">asn1.h:150</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_ac30aeab20c2cdf74dae631d6d0691651"><div class="ttname"><a href="structmbedtls__x509__crt.html#ac30aeab20c2cdf74dae631d6d0691651">mbedtls_x509_crt::subject_raw</a></div><div class="ttdeci">mbedtls_x509_buf subject_raw</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00062">x509_crt.h:62</a></div></div>
<div class="ttc" id="group__x509__module_html_gab33c1e4e20bea7ce536119f54a113c6b"><div class="ttname"><a href="group__x509__module.html#gab33c1e4e20bea7ce536119f54a113c6b">mbedtls_x509_crt_free</a></div><div class="ttdeci">void mbedtls_x509_crt_free(mbedtls_x509_crt *crt)</div><div class="ttdoc">Unallocate all certificate data. </div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a128c3a665ffdce696b402435a74e97aa"><div class="ttname"><a href="structmbedtls__x509__crt.html#a128c3a665ffdce696b402435a74e97aa">mbedtls_x509_crt::sig_oid</a></div><div class="ttdeci">mbedtls_x509_buf sig_oid</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00059">x509_crt.h:59</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_afb876a6a7b85e160620c4549324d9e8d"><div class="ttname"><a href="structmbedtls__x509__crt.html#afb876a6a7b85e160620c4549324d9e8d">mbedtls_x509_crt::issuer_raw</a></div><div class="ttdeci">mbedtls_x509_buf issuer_raw</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00061">x509_crt.h:61</a></div></div>
<div class="ttc" id="group__x509__module_html_gaf09067a39129236125e353a68ceb45d6"><div class="ttname"><a href="group__x509__module.html#gaf09067a39129236125e353a68ceb45d6">mbedtls_x509_crt_profile_suiteb</a></div><div class="ttdeci">const mbedtls_x509_crt_profile mbedtls_x509_crt_profile_suiteb</div></div>
<div class="ttc" id="structmbedtls__x509__crl_html_a85c03124f3b4a2afe8b5c47fab13a8a9"><div class="ttname"><a href="structmbedtls__x509__crl.html#a85c03124f3b4a2afe8b5c47fab13a8a9">mbedtls_x509_crl::sig_md</a></div><div class="ttdeci">mbedtls_md_type_t sig_md</div><div class="ttdef"><b>Definition:</b> <a href="c-libp2p_2include_2mbedtls_2x509__crl_8h_source.html#l00090">x509_crl.h:90</a></div></div>
<div class="ttc" id="md_8h_html_ae20f4ddcf2bbf2e59cafc6fab8c993d6"><div class="ttname"><a href="md_8h.html#ae20f4ddcf2bbf2e59cafc6fab8c993d6">mbedtls_md_get_size</a></div><div class="ttdeci">unsigned char mbedtls_md_get_size(const mbedtls_md_info_t *md_info)</div><div class="ttdoc">Returns the size of the message digest output. </div></div>
<div class="ttc" id="group__asn1__module_html_ga284c12cf03a4ffeee89a63750f00dfdd"><div class="ttname"><a href="group__asn1__module.html#ga284c12cf03a4ffeee89a63750f00dfdd">MBEDTLS_ERR_ASN1_OUT_OF_DATA</a></div><div class="ttdeci">#define MBEDTLS_ERR_ASN1_OUT_OF_DATA</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00050">asn1.h:50</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a773e92423092ab65e5e50031bd9663a5"><div class="ttname"><a href="structmbedtls__x509__crt.html#a773e92423092ab65e5e50031bd9663a5">mbedtls_x509_crt::subject</a></div><div class="ttdeci">mbedtls_x509_name subject</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00065">x509_crt.h:65</a></div></div>
<div class="ttc" id="group__x509__module_html_gad1da8228ca957c2947fd329c32fc7ca4"><div class="ttname"><a href="group__x509__module.html#gad1da8228ca957c2947fd329c32fc7ca4">MBEDTLS_X509_BADCRL_NOT_TRUSTED</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCRL_NOT_TRUSTED</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00090">x509.h:90</a></div></div>
<div class="ttc" id="group__x509__module_html_gaa0788dbf0325aea4ab566717514b4422"><div class="ttname"><a href="group__x509__module.html#gaa0788dbf0325aea4ab566717514b4422">MBEDTLS_ERR_X509_INVALID_EXTENSIONS</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_INVALID_EXTENSIONS</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00069">x509.h:69</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a05af94003d5948703ca537b6a5f2d5b4"><div class="ttname"><a href="structmbedtls__x509__crt.html#a05af94003d5948703ca537b6a5f2d5b4">mbedtls_x509_crt::valid_to</a></div><div class="ttdeci">mbedtls_x509_time valid_to</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00068">x509_crt.h:68</a></div></div>
<div class="ttc" id="group__x509__module_html_gaeb90af9ad906c5075b1ad625ebc26553"><div class="ttname"><a href="group__x509__module.html#gaeb90af9ad906c5075b1ad625ebc26553">MBEDTLS_ERR_X509_CERT_UNKNOWN_FORMAT</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_CERT_UNKNOWN_FORMAT</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00074">x509.h:74</a></div></div>
<div class="ttc" id="group__x509__module_html_ga033567483649030f7f859db4f4cb7e14"><div class="ttname"><a href="group__x509__module.html#ga033567483649030f7f859db4f4cb7e14">mbedtls_x509_crt_parse</a></div><div class="ttdeci">int mbedtls_x509_crt_parse(mbedtls_x509_crt *chain, const unsigned char *buf, size_t buflen)</div><div class="ttdoc">Parse one or more certificates and add them to the chained list. Parses permissively. If some certificates can be parsed, the result is the number of failed certificates it encountered. If none complete correctly, the first error is returned. </div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_adc36c60aa279fae8bd35a20b9c2bba22"><div class="ttname"><a href="structmbedtls__x509__crt.html#adc36c60aa279fae8bd35a20b9c2bba22">mbedtls_x509_crt::ns_cert_type</a></div><div class="ttdeci">unsigned char ns_cert_type</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00085">x509_crt.h:85</a></div></div>
<div class="ttc" id="structmbedtls__asn1__buf_html"><div class="ttname"><a href="structmbedtls__asn1__buf.html">mbedtls_asn1_buf</a></div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00118">asn1.h:118</a></div></div>
<div class="ttc" id="structmbedtls__x509__time_html"><div class="ttname"><a href="structmbedtls__x509__time.html">mbedtls_x509_time</a></div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00206">x509.h:206</a></div></div>
<div class="ttc" id="threading_8h_html"><div class="ttname"><a href="threading_8h.html">threading.h</a></div><div class="ttdoc">Threading abstraction layer. </div></div>
<div class="ttc" id="group__x509__module_html_ga571fc89b9f3217ab3dd67bd7af905066"><div class="ttname"><a href="group__x509__module.html#ga571fc89b9f3217ab3dd67bd7af905066">mbedtls_x509_crt_parse_path</a></div><div class="ttdeci">int mbedtls_x509_crt_parse_path(mbedtls_x509_crt *chain, const char *path)</div><div class="ttdoc">Load one or more certificate files from a path and add them to the chained list. Parses permissively...</div></div>
<div class="ttc" id="group__x509__module_html_gaa383ae441177fa7a16fb2313bb48bb10"><div class="ttname"><a href="group__x509__module.html#gaa383ae441177fa7a16fb2313bb48bb10">MBEDTLS_X509_BADCERT_NS_CERT_TYPE</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_NS_CERT_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00099">x509.h:99</a></div></div>
<div class="ttc" id="group__x509__module_html_gac3dab3183efdbca7e988916e7fc1a02a"><div class="ttname"><a href="group__x509__module.html#gac3dab3183efdbca7e988916e7fc1a02a">MBEDTLS_X509_BADCERT_EXT_KEY_USAGE</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_EXT_KEY_USAGE</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00098">x509.h:98</a></div></div>
<div class="ttc" id="group__x509__module_html_ga8bca03e3c2c89460bea17ab142b0b7ab"><div class="ttname"><a href="group__x509__module.html#ga8bca03e3c2c89460bea17ab142b0b7ab">MBEDTLS_X509_BADCERT_MISSING</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_MISSING</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00092">x509.h:92</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a5c3ae8b4aba6e1c40cb1f6a85da36116"><div class="ttname"><a href="structmbedtls__x509__crt.html#a5c3ae8b4aba6e1c40cb1f6a85da36116">mbedtls_x509_crt::serial</a></div><div class="ttdeci">mbedtls_x509_buf serial</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00058">x509_crt.h:58</a></div></div>
<div class="ttc" id="asn1_8h_html_a872d62128956b3574bb0e681536c0d6b"><div class="ttname"><a href="asn1_8h.html#a872d62128956b3574bb0e681536c0d6b">mbedtls_asn1_get_sequence_of</a></div><div class="ttdeci">int mbedtls_asn1_get_sequence_of(unsigned char **p, const unsigned char *end, mbedtls_asn1_sequence *cur, int tag)</div><div class="ttdoc">Parses and splits an ASN.1 &quot;SEQUENCE OF &lt;tag&gt;&quot; Updated the pointer to immediately behind the full seq...</div></div>
<div class="ttc" id="group__x509__module_html_gad93c0f614969729f7d13fb0a3acac68e"><div class="ttname"><a href="group__x509__module.html#gad93c0f614969729f7d13fb0a3acac68e">MBEDTLS_X509_BADCRL_FUTURE</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCRL_FUTURE</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00096">x509.h:96</a></div></div>
<div class="ttc" id="asn1_8h_html_ae2dcf021cf1326b62e2f23aa3bda69d0"><div class="ttname"><a href="asn1_8h.html#ae2dcf021cf1326b62e2f23aa3bda69d0">mbedtls_asn1_get_bitstring</a></div><div class="ttdeci">int mbedtls_asn1_get_bitstring(unsigned char **p, const unsigned char *end, mbedtls_asn1_bitstring *bs)</div><div class="ttdoc">Retrieve a bitstring ASN.1 tag and its value. Updates the pointer to immediately behind the full tag...</div></div>
<div class="ttc" id="structmbedtls__x509__time_html_a20712c77a94123d4610c87d6863cf092"><div class="ttname"><a href="structmbedtls__x509__time.html#a20712c77a94123d4610c87d6863cf092">mbedtls_x509_time::day</a></div><div class="ttdeci">int day</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00208">x509.h:208</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt__profile_html_a094e9eb35ed5e9a16b67d2e8bd97e83c"><div class="ttname"><a href="structmbedtls__x509__crt__profile.html#a094e9eb35ed5e9a16b67d2e8bd97e83c">mbedtls_x509_crt_profile::rsa_min_bitlen</a></div><div class="ttdeci">uint32_t rsa_min_bitlen</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00112">x509_crt.h:112</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_aad3cad5d228545a1950850239741784f"><div class="ttname"><a href="structmbedtls__x509__crt.html#aad3cad5d228545a1950850239741784f">mbedtls_x509_crt::valid_from</a></div><div class="ttdeci">mbedtls_x509_time valid_from</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00067">x509_crt.h:67</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a5bfef6b8b81bc081f796cb1f6bb28839"><div class="ttname"><a href="structmbedtls__x509__crt.html#a5bfef6b8b81bc081f796cb1f6bb28839">mbedtls_x509_crt::raw</a></div><div class="ttdeci">mbedtls_x509_buf raw</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00054">x509_crt.h:54</a></div></div>
<div class="ttc" id="group__x509__module_html_gad21c0e75a3fdbeb1f65e4d339e479df3"><div class="ttname"><a href="group__x509__module.html#gad21c0e75a3fdbeb1f65e4d339e479df3">mbedtls_x509_crt_check_extended_key_usage</a></div><div class="ttdeci">int mbedtls_x509_crt_check_extended_key_usage(const mbedtls_x509_crt *crt, const char *usage_oid, size_t usage_len)</div><div class="ttdoc">Check usage of certificate against extentedJeyUsage. </div></div>
<div class="ttc" id="md_8h_html_a36c5d8bda1905e0434708f0ef5912dda"><div class="ttname"><a href="md_8h.html#a36c5d8bda1905e0434708f0ef5912dda">mbedtls_md</a></div><div class="ttdeci">int mbedtls_md(const mbedtls_md_info_t *md_info, const unsigned char *input, size_t ilen, unsigned char *output)</div><div class="ttdoc">Output = message_digest( input buffer ) </div></div>
<div class="ttc" id="pk_8h_html_ac6a9786d96abfd73c4dff6814238feb9"><div class="ttname"><a href="pk_8h.html#ac6a9786d96abfd73c4dff6814238feb9">mbedtls_pk_free</a></div><div class="ttdeci">void mbedtls_pk_free(mbedtls_pk_context *ctx)</div><div class="ttdoc">Free a mbedtls_pk_context. </div></div>
<div class="ttc" id="group__x509__module_html_ga0e5b1d4c9c1a1a3227238c82042c1d1b"><div class="ttname"><a href="group__x509__module.html#ga0e5b1d4c9c1a1a3227238c82042c1d1b">MBEDTLS_X509_BADCERT_NOT_TRUSTED</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_NOT_TRUSTED</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00089">x509.h:89</a></div></div>
<div class="ttc" id="group__x509__module_html_ga41b54b526c11bf51cc431ef1a151816d"><div class="ttname"><a href="group__x509__module.html#ga41b54b526c11bf51cc431ef1a151816d">MBEDTLS_X509_BADCERT_BAD_MD</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_BAD_MD</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00100">x509.h:100</a></div></div>
<div class="ttc" id="x509__crt_8h_html"><div class="ttname"><a href="x509__crt_8h.html">x509_crt.h</a></div><div class="ttdoc">X.509 certificate parsing and writing. </div></div>
<div class="ttc" id="structmbedtls__x509__time_html_a267d51d8fbecde50b06b883db7f98ec2"><div class="ttname"><a href="structmbedtls__x509__time.html#a267d51d8fbecde50b06b883db7f98ec2">mbedtls_x509_time::sec</a></div><div class="ttdeci">int sec</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00209">x509.h:209</a></div></div>
<div class="ttc" id="group__x509__module_html_ga8ab1f8a044fd25f76ecb4ba15c6d5bcd"><div class="ttname"><a href="group__x509__module.html#ga8ab1f8a044fd25f76ecb4ba15c6d5bcd">mbedtls_x509_crt_profile_next</a></div><div class="ttdeci">const mbedtls_x509_crt_profile mbedtls_x509_crt_profile_next</div></div>
<div class="ttc" id="asn1_8h_html_aec9e4bbd8690a8ab17cabf87893dbd2b"><div class="ttname"><a href="asn1_8h.html#aec9e4bbd8690a8ab17cabf87893dbd2b">mbedtls_asn1_get_bool</a></div><div class="ttdeci">int mbedtls_asn1_get_bool(unsigned char **p, const unsigned char *end, int *val)</div><div class="ttdoc">Retrieve a boolean ASN.1 tag and its value. Updates the pointer to immediately behind the full tag...</div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a65d5d20352a08c77e173808fde1f8660"><div class="ttname"><a href="structmbedtls__x509__crt.html#a65d5d20352a08c77e173808fde1f8660">mbedtls_x509_crt::sig_pk</a></div><div class="ttdeci">mbedtls_pk_type_t sig_pk</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00089">x509_crt.h:89</a></div></div>
<div class="ttc" id="group__x509__module_html_gaddd96a9eb80fab17bce02d2a147ea504"><div class="ttname"><a href="group__x509__module.html#gaddd96a9eb80fab17bce02d2a147ea504">MBEDTLS_X509_BADCERT_REVOKED</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_REVOKED</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00087">x509.h:87</a></div></div>
<div class="ttc" id="structmbedtls__x509__crl_html_ad59e3744b290f19d6400678d364aef77"><div class="ttname"><a href="structmbedtls__x509__crl.html#ad59e3744b290f19d6400678d364aef77">mbedtls_x509_crl::sig_opts</a></div><div class="ttdeci">void * sig_opts</div><div class="ttdef"><b>Definition:</b> <a href="c-libp2p_2include_2mbedtls_2x509__crl_8h_source.html#l00092">x509_crl.h:92</a></div></div>
<div class="ttc" id="ecp_8h_html_af79e530ea8f8416480f805baa20b1a2d"><div class="ttname"><a href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2d">mbedtls_ecp_group_id</a></div><div class="ttdeci">mbedtls_ecp_group_id</div><div class="ttdef"><b>Definition:</b> <a href="ecp_8h_source.html#l00053">ecp.h:53</a></div></div>
<div class="ttc" id="oid_8h_html_a61da0671b3897e73edf219d44e45b693"><div class="ttname"><a href="oid_8h.html#a61da0671b3897e73edf219d44e45b693">MBEDTLS_OID_ANY_EXTENDED_KEY_USAGE</a></div><div class="ttdeci">#define MBEDTLS_OID_ANY_EXTENDED_KEY_USAGE</div><div class="ttdef"><b>Definition:</b> <a href="oid_8h_source.html#l00173">oid.h:173</a></div></div>
<div class="ttc" id="asn1_8h_html_a7f8a8b447c11f2200cc5aa8033801b72"><div class="ttname"><a href="asn1_8h.html#a7f8a8b447c11f2200cc5aa8033801b72">mbedtls_asn1_get_int</a></div><div class="ttdeci">int mbedtls_asn1_get_int(unsigned char **p, const unsigned char *end, int *val)</div><div class="ttdoc">Retrieve an integer ASN.1 tag and its value. Updates the pointer to immediately behind the full tag...</div></div>
<div class="ttc" id="group__x509__module_html_gabaf30f2269fc3b6608b25871f9d09da6"><div class="ttname"><a href="group__x509__module.html#gabaf30f2269fc3b6608b25871f9d09da6">mbedtls_x509_crt_info</a></div><div class="ttdeci">int mbedtls_x509_crt_info(char *buf, size_t size, const char *prefix, const mbedtls_x509_crt *crt)</div><div class="ttdoc">Returns an informational string about the certificate. </div></div>
<div class="ttc" id="group__x509__module_html_gad4da63133d3590aa311488497d4c38ec"><div class="ttname"><a href="group__x509__module.html#gad4da63133d3590aa311488497d4c38ec">mbedtls_x509_crt_parse_file</a></div><div class="ttdeci">int mbedtls_x509_crt_parse_file(mbedtls_x509_crt *chain, const char *path)</div><div class="ttdoc">Load one or more certificates and add them to the chained list. Parses permissively. If some certificates can be parsed, the result is the number of failed certificates it encountered. If none complete correctly, the first error is returned. </div></div>
<div class="ttc" id="md_8h_html_aca53b51e0c8eb0e07c7eb4a3e6acfa0d"><div class="ttname"><a href="md_8h.html#aca53b51e0c8eb0e07c7eb4a3e6acfa0d">mbedtls_md_info_from_type</a></div><div class="ttdeci">const mbedtls_md_info_t * mbedtls_md_info_from_type(mbedtls_md_type_t md_type)</div><div class="ttdoc">Returns the message digest information associated with the given digest type. </div></div>
<div class="ttc" id="threading_8h_html_a51005c51b928706511d3c2ea3390c07f"><div class="ttname"><a href="threading_8h.html#a51005c51b928706511d3c2ea3390c07f">MBEDTLS_ERR_THREADING_MUTEX_ERROR</a></div><div class="ttdeci">#define MBEDTLS_ERR_THREADING_MUTEX_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="threading_8h_source.html#l00040">threading.h:40</a></div></div>
<div class="ttc" id="group__x509__module_html_ga5f03158dcacc5914872e38c68231b642"><div class="ttname"><a href="group__x509__module.html#ga5f03158dcacc5914872e38c68231b642">MBEDTLS_X509_BADCERT_EXPIRED</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_EXPIRED</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00086">x509.h:86</a></div></div>
<div class="ttc" id="group__compat_html_gab521aa5010fb1afb801a899a55569e03"><div class="ttname"><a href="group__compat.html#gab521aa5010fb1afb801a899a55569e03">HANDLE</a></div><div class="ttdeci">#define HANDLE</div><div class="ttdef"><b>Definition:</b> <a href="mdb_8c_source.html#l00447">mdb.c:447</a></div></div>
<div class="ttc" id="group__compat_html_ga5fdc7facea201bfce4ad308105f88d0c"><div class="ttname"><a href="group__compat.html#ga5fdc7facea201bfce4ad308105f88d0c">INVALID_HANDLE_VALUE</a></div><div class="ttdeci">#define INVALID_HANDLE_VALUE</div><div class="ttdef"><b>Definition:</b> <a href="mdb_8c_source.html#l00453">mdb.c:453</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a67c497ed6535050997c014507a866e9e"><div class="ttname"><a href="structmbedtls__x509__crt.html#a67c497ed6535050997c014507a866e9e">mbedtls_x509_crt::sig_opts</a></div><div class="ttdeci">void * sig_opts</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00090">x509_crt.h:90</a></div></div>
<div class="ttc" id="structmbedtls__x509__crl_html_ab8086dd1a2a3d82363cc91e1cdfb5850"><div class="ttname"><a href="structmbedtls__x509__crl.html#ab8086dd1a2a3d82363cc91e1cdfb5850">mbedtls_x509_crl::tbs</a></div><div class="ttdeci">mbedtls_x509_buf tbs</div><div class="ttdef"><b>Definition:</b> <a href="c-libp2p_2include_2mbedtls_2x509__crl_8h_source.html#l00072">x509_crl.h:72</a></div></div>
<div class="ttc" id="group__x509__module_html_gac2947ead6fd1035296826110ca74a364"><div class="ttname"><a href="group__x509__module.html#gac2947ead6fd1035296826110ca74a364">MBEDTLS_X509_BADCRL_BAD_KEY</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCRL_BAD_KEY</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00105">x509.h:105</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a6bb2a7142b718fa43b948770ccc98dcd"><div class="ttname"><a href="structmbedtls__x509__crt.html#a6bb2a7142b718fa43b948770ccc98dcd">mbedtls_x509_crt::issuer_id</a></div><div class="ttdeci">mbedtls_x509_buf issuer_id</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00072">x509_crt.h:72</a></div></div>
<div class="ttc" id="pk_8h_html_ab568e6594c1c4cffaa5046e1e0cada55"><div class="ttname"><a href="pk_8h.html#ab568e6594c1c4cffaa5046e1e0cada55">mbedtls_pk_get_type</a></div><div class="ttdeci">mbedtls_pk_type_t mbedtls_pk_get_type(const mbedtls_pk_context *ctx)</div><div class="ttdoc">Get the key type. </div></div>
<div class="ttc" id="structmbedtls__asn1__bitstring_html"><div class="ttname"><a href="structmbedtls__asn1__bitstring.html">mbedtls_asn1_bitstring</a></div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00129">asn1.h:129</a></div></div>
<div class="ttc" id="asn1_8h_html_a0b81f225b3551ec7c4da69b2d183d10b"><div class="ttname"><a href="asn1_8h.html#a0b81f225b3551ec7c4da69b2d183d10b">MBEDTLS_OID_CMP</a></div><div class="ttdeci">#define MBEDTLS_OID_CMP(oid_str, oid_buf)</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00102">asn1.h:102</a></div></div>
<div class="ttc" id="structmbedtls__x509__crl_html_a8c94375266c53f6e73d0134dc978151a"><div class="ttname"><a href="structmbedtls__x509__crl.html#a8c94375266c53f6e73d0134dc978151a">mbedtls_x509_crl::sig_pk</a></div><div class="ttdeci">mbedtls_pk_type_t sig_pk</div><div class="ttdef"><b>Definition:</b> <a href="c-libp2p_2include_2mbedtls_2x509__crl_8h_source.html#l00091">x509_crl.h:91</a></div></div>
<div class="ttc" id="group__x509__module_html_ga1b87b2e1d26077023adf2a5c65a76776"><div class="ttname"><a href="group__x509__module.html#ga1b87b2e1d26077023adf2a5c65a76776">MBEDTLS_X509_BADCERT_SKIP_VERIFY</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_SKIP_VERIFY</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00093">x509.h:93</a></div></div>
<div class="ttc" id="structmbedtls__asn1__buf_html_a046821787f2c5ecbf2df9f15e0d9486c"><div class="ttname"><a href="structmbedtls__asn1__buf.html#a046821787f2c5ecbf2df9f15e0d9486c">mbedtls_asn1_buf::len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00121">asn1.h:121</a></div></div>
<div class="ttc" id="asn1_8h_html_ad45c1d0ed3694fe903342cb32647bfb1"><div class="ttname"><a href="asn1_8h.html#ad45c1d0ed3694fe903342cb32647bfb1">mbedtls_asn1_get_len</a></div><div class="ttdeci">int mbedtls_asn1_get_len(unsigned char **p, const unsigned char *end, size_t *len)</div><div class="ttdoc">Get the length of an ASN.1 element. Updates the pointer to immediately behind the length...</div></div>
<div class="ttc" id="group__x509__module_html_gac489ce5e8ba417bcd86012ebbb7f5044"><div class="ttname"><a href="group__x509__module.html#gac489ce5e8ba417bcd86012ebbb7f5044">MBEDTLS_ERR_X509_SIG_MISMATCH</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_SIG_MISMATCH</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00072">x509.h:72</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html"><div class="ttname"><a href="structmbedtls__x509__crt.html">mbedtls_x509_crt</a></div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00052">x509_crt.h:52</a></div></div>
<div class="ttc" id="structmbedtls__md__info__t_html"><div class="ttname"><a href="structmbedtls__md__info__t.html">mbedtls_md_info_t</a></div><div class="ttdef"><b>Definition:</b> <a href="md__internal_8h_source.html#l00046">md_internal.h:46</a></div></div>
<div class="ttc" id="pk_8h_html_a1b0fb8d16905ec72515dd574b77a4518"><div class="ttname"><a href="pk_8h.html#a1b0fb8d16905ec72515dd574b77a4518">mbedtls_pk_get_name</a></div><div class="ttdeci">const char * mbedtls_pk_get_name(const mbedtls_pk_context *ctx)</div><div class="ttdoc">Access the type name. </div></div>
<div class="ttc" id="group__asn1__module_html_gab055945fda47ad0e16dc59f8c5ecb86e"><div class="ttname"><a href="group__asn1__module.html#gab055945fda47ad0e16dc59f8c5ecb86e">MBEDTLS_ERR_ASN1_UNEXPECTED_TAG</a></div><div class="ttdeci">#define MBEDTLS_ERR_ASN1_UNEXPECTED_TAG</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00051">asn1.h:51</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_ac94f7360a7143ce1b983fab46c34dcf2"><div class="ttname"><a href="structmbedtls__x509__crt.html#ac94f7360a7143ce1b983fab46c34dcf2">mbedtls_x509_crt::ext_key_usage</a></div><div class="ttdeci">mbedtls_x509_sequence ext_key_usage</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00083">x509_crt.h:83</a></div></div>
<div class="ttc" id="structmbedtls__asn1__named__data_html_a38f29c37c55319b3c0a9c998c3e5bd0d"><div class="ttname"><a href="structmbedtls__asn1__named__data.html#a38f29c37c55319b3c0a9c998c3e5bd0d">mbedtls_asn1_named_data::next</a></div><div class="ttdeci">struct mbedtls_asn1_named_data * next</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00154">asn1.h:154</a></div></div>
<div class="ttc" id="oid_8h_html_aed77a0ed6d223075b9fb1f346368cf89"><div class="ttname"><a href="oid_8h.html#aed77a0ed6d223075b9fb1f346368cf89">MBEDTLS_OID_AT_CN</a></div><div class="ttdeci">#define MBEDTLS_OID_AT_CN</div><div class="ttdef"><b>Definition:</b> <a href="oid_8h_source.html#l00110">oid.h:110</a></div></div>
<div class="ttc" id="group__x509__module_html_gab98caf7dfede54b5c576b5a27a5c6a6a"><div class="ttname"><a href="group__x509__module.html#gab98caf7dfede54b5c576b5a27a5c6a6a">MBEDTLS_X509_MAX_INTERMEDIATE_CA</a></div><div class="ttdeci">#define MBEDTLS_X509_MAX_INTERMEDIATE_CA</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00053">x509.h:53</a></div></div>
<div class="ttc" id="group__x509__module_html_ga182a6f1f465e566de7586e6ee8fa7c4e"><div class="ttname"><a href="group__x509__module.html#ga182a6f1f465e566de7586e6ee8fa7c4e">MBEDTLS_X509_BADCRL_BAD_PK</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCRL_BAD_PK</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00104">x509.h:104</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_ab0af43652f426ace28052ec47fdde6fb"><div class="ttname"><a href="structmbedtls__x509__crt.html#ab0af43652f426ace28052ec47fdde6fb">mbedtls_x509_crt::max_pathlen</a></div><div class="ttdeci">int max_pathlen</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00079">x509_crt.h:79</a></div></div>
<div class="ttc" id="ecp_8h_html_af79e530ea8f8416480f805baa20b1a2daf73bbf7b29d26a0bc77dcff47cd6b276"><div class="ttname"><a href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2daf73bbf7b29d26a0bc77dcff47cd6b276">MBEDTLS_ECP_DP_SECP256R1</a></div><div class="ttdef"><b>Definition:</b> <a href="ecp_8h_source.html#l00058">ecp.h:58</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt__profile_html"><div class="ttname"><a href="structmbedtls__x509__crt__profile.html">mbedtls_x509_crt_profile</a></div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00107">x509_crt.h:107</a></div></div>
<div class="ttc" id="group__x509__module_html_ga016dd06bc770e77b84005f305df20ed1"><div class="ttname"><a href="group__x509__module.html#ga016dd06bc770e77b84005f305df20ed1">mbedtls_x509_crt_init</a></div><div class="ttdeci">void mbedtls_x509_crt_init(mbedtls_x509_crt *crt)</div><div class="ttdoc">Initialize a certificate (chain) </div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a3b7650600aa6e637b8ab534a938aee94"><div class="ttname"><a href="structmbedtls__x509__crt.html#a3b7650600aa6e637b8ab534a938aee94">mbedtls_x509_crt::key_usage</a></div><div class="ttdeci">unsigned int key_usage</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00081">x509_crt.h:81</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt__profile_html_a13cba76eca3f0bce8a93b8f59fe69370"><div class="ttname"><a href="structmbedtls__x509__crt__profile.html#a13cba76eca3f0bce8a93b8f59fe69370">mbedtls_x509_crt_profile::allowed_pks</a></div><div class="ttdeci">uint32_t allowed_pks</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00110">x509_crt.h:110</a></div></div>
<div class="ttc" id="group__x509__module_html_gaeeef11ebf0b31a54a665b1a3fd65c3f7"><div class="ttname"><a href="group__x509__module.html#gaeeef11ebf0b31a54a665b1a3fd65c3f7">MBEDTLS_ERR_X509_BAD_INPUT_DATA</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_BAD_INPUT_DATA</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00075">x509.h:75</a></div></div>
<div class="ttc" id="ecp_8h_html_af79e530ea8f8416480f805baa20b1a2da08d0615820297b8c90f8ec7cbd88f641"><div class="ttname"><a href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2da08d0615820297b8c90f8ec7cbd88f641">MBEDTLS_ECP_DP_SECP384R1</a></div><div class="ttdef"><b>Definition:</b> <a href="ecp_8h_source.html#l00059">ecp.h:59</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt__profile_html_a1251640211d47c8e4b80b99d5b178685"><div class="ttname"><a href="structmbedtls__x509__crt__profile.html#a1251640211d47c8e4b80b99d5b178685">mbedtls_x509_crt_profile::allowed_mds</a></div><div class="ttdeci">uint32_t allowed_mds</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00109">x509_crt.h:109</a></div></div>
<div class="ttc" id="group__asn1__module_html_gab7d40360e48e414ffa1a4df1961723d2"><div class="ttname"><a href="group__asn1__module.html#gab7d40360e48e414ffa1a4df1961723d2">MBEDTLS_ERR_ASN1_ALLOC_FAILED</a></div><div class="ttdeci">#define MBEDTLS_ERR_ASN1_ALLOC_FAILED</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00055">asn1.h:55</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a64f66291338e6b230542d83035fe5f20"><div class="ttname"><a href="structmbedtls__x509__crt.html#a64f66291338e6b230542d83035fe5f20">mbedtls_x509_crt::pk</a></div><div class="ttdeci">mbedtls_pk_context pk</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00070">x509_crt.h:70</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_aea76ebaa8c8e23129bd905cdc0242a3a"><div class="ttname"><a href="structmbedtls__x509__crt.html#aea76ebaa8c8e23129bd905cdc0242a3a">mbedtls_x509_crt::sig</a></div><div class="ttdeci">mbedtls_x509_buf sig</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00087">x509_crt.h:87</a></div></div>
<div class="ttc" id="group__x509__module_html_gae88f1d8e6696eb2beeffe0a708219e6b"><div class="ttname"><a href="group__x509__module.html#gae88f1d8e6696eb2beeffe0a708219e6b">mbedtls_x509_crt_verify_info</a></div><div class="ttdeci">int mbedtls_x509_crt_verify_info(char *buf, size_t size, const char *prefix, uint32_t flags)</div><div class="ttdoc">Returns an informational string about the verification status of a certificate. </div></div>
<div class="ttc" id="ecp_8h_html_af79e530ea8f8416480f805baa20b1a2dade9d3762e81c6e1d6e499d21e8190be5"><div class="ttname"><a href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2dade9d3762e81c6e1d6e499d21e8190be5">MBEDTLS_ECP_DP_BP256R1</a></div><div class="ttdef"><b>Definition:</b> <a href="ecp_8h_source.html#l00061">ecp.h:61</a></div></div>
<div class="ttc" id="ecp_8h_html_af79e530ea8f8416480f805baa20b1a2daaa2d9d42df56aab024ef760ee9dffca2"><div class="ttname"><a href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2daaa2d9d42df56aab024ef760ee9dffca2">MBEDTLS_ECP_DP_SECP521R1</a></div><div class="ttdef"><b>Definition:</b> <a href="ecp_8h_source.html#l00060">ecp.h:60</a></div></div>
<div class="ttc" id="namespacecleanup_html"><div class="ttname"><a href="namespacecleanup.html">cleanup</a></div><div class="ttdef"><b>Definition:</b> <a href="cleanup_8py_source.html#l00001">cleanup.py:1</a></div></div>
<div class="ttc" id="ecp_8h_html_af79e530ea8f8416480f805baa20b1a2daaf562eeec4368f2c501c163b4707900a"><div class="ttname"><a href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2daaf562eeec4368f2c501c163b4707900a">MBEDTLS_ECP_DP_BP384R1</a></div><div class="ttdef"><b>Definition:</b> <a href="ecp_8h_source.html#l00062">ecp.h:62</a></div></div>
<div class="ttc" id="structmbedtls__asn1__bitstring_html_a943b4155650f680f3906ca9be0e66f80"><div class="ttname"><a href="structmbedtls__asn1__bitstring.html#a943b4155650f680f3906ca9be0e66f80">mbedtls_asn1_bitstring::len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00131">asn1.h:131</a></div></div>
<div class="ttc" id="ecp_8h_html_af79e530ea8f8416480f805baa20b1a2da6de9f87d43d7c29c7f91e9986ccfc25f"><div class="ttname"><a href="ecp_8h.html#af79e530ea8f8416480f805baa20b1a2da6de9f87d43d7c29c7f91e9986ccfc25f">MBEDTLS_ECP_DP_SECP256K1</a></div><div class="ttdef"><b>Definition:</b> <a href="ecp_8h_source.html#l00067">ecp.h:67</a></div></div>
<div class="ttc" id="group__x509__module_html_gad85d9c7aa5c30b9730297bef3386407c"><div class="ttname"><a href="group__x509__module.html#gad85d9c7aa5c30b9730297bef3386407c">MBEDTLS_ERR_X509_FILE_IO_ERROR</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_FILE_IO_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00077">x509.h:77</a></div></div>
<div class="ttc" id="group__x509__module_html_ga6e71468985ebf243ca7cfce5c3dea881"><div class="ttname"><a href="group__x509__module.html#ga6e71468985ebf243ca7cfce5c3dea881">MBEDTLS_X509_BADCERT_CN_MISMATCH</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_CN_MISMATCH</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00088">x509.h:88</a></div></div>
<div class="ttc" id="structmbedtls__asn1__sequence_html_ac81969ddae2ace4340503530588d83e1"><div class="ttname"><a href="structmbedtls__asn1__sequence.html#ac81969ddae2ace4340503530588d83e1">mbedtls_asn1_sequence::next</a></div><div class="ttdeci">struct mbedtls_asn1_sequence * next</div><div class="ttdef"><b>Definition:</b> <a href="asn1_8h_source.html#l00143">asn1.h:143</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a6baebf9741097506a60521fbcaf5996b"><div class="ttname"><a href="structmbedtls__x509__crt.html#a6baebf9741097506a60521fbcaf5996b">mbedtls_x509_crt::v3_ext</a></div><div class="ttdeci">mbedtls_x509_buf v3_ext</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00074">x509_crt.h:74</a></div></div>
<div class="ttc" id="group__x509__module_html_gaedcb73f1c615c266a348a0c62763c5de"><div class="ttname"><a href="group__x509__module.html#gaedcb73f1c615c266a348a0c62763c5de">MBEDTLS_X509_ID_FLAG</a></div><div class="ttdeci">#define MBEDTLS_X509_ID_FLAG(id)</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00100">x509_crt.h:100</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a196b3a43dae5a1c0058f46075f832890"><div class="ttname"><a href="structmbedtls__x509__crt.html#a196b3a43dae5a1c0058f46075f832890">mbedtls_x509_crt::ca_istrue</a></div><div class="ttdeci">int ca_istrue</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00078">x509_crt.h:78</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a879ea07a05ab857c0f5793572bf1696e"><div class="ttname"><a href="structmbedtls__x509__crt.html#a879ea07a05ab857c0f5793572bf1696e">mbedtls_x509_crt::version</a></div><div class="ttdeci">int version</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00057">x509_crt.h:57</a></div></div>
<div class="ttc" id="structmbedtls__x509__crt_html_a5c56937aaf2a51a1d8bc814b142734ca"><div class="ttname"><a href="structmbedtls__x509__crt.html#a5c56937aaf2a51a1d8bc814b142734ca">mbedtls_x509_crt::sig_md</a></div><div class="ttdeci">mbedtls_md_type_t sig_md</div><div class="ttdef"><b>Definition:</b> <a href="x509__crt_8h_source.html#l00088">x509_crt.h:88</a></div></div>
<div class="ttc" id="group__x509__module_html_ga28705c8c3091a013487df25842249c0f"><div class="ttname"><a href="group__x509__module.html#ga28705c8c3091a013487df25842249c0f">MBEDTLS_X509_BADCERT_KEY_USAGE</a></div><div class="ttdeci">#define MBEDTLS_X509_BADCERT_KEY_USAGE</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00097">x509.h:97</a></div></div>
<div class="ttc" id="group__x509__module_html_ga185bc7f27a2b1f7742537a2377c52ee3"><div class="ttname"><a href="group__x509__module.html#ga185bc7f27a2b1f7742537a2377c52ee3">MBEDTLS_ERR_X509_FEATURE_UNAVAILABLE</a></div><div class="ttdeci">#define MBEDTLS_ERR_X509_FEATURE_UNAVAILABLE</div><div class="ttdef"><b>Definition:</b> <a href="mbedtls_2x509_8h_source.html#l00060">x509.h:60</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
