<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>even-network: prerequisites/botan/src/lib/pubkey/newhope/newhope.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="2018-12-27 at 10-36-23.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">even-network
   </div>
   <div id="projectbrief">EVEN Network â€” is an open cross-chain platform with EVEN cryptocurrency that allows users to interact with more than one blockchain at a time.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0dc8670ce003965ad6657bffb381fe41.html">prerequisites</a></li><li class="navelem"><a class="el" href="dir_3760fb49a0b0a4f2f97de0930ae08865.html">botan</a></li><li class="navelem"><a class="el" href="dir_56323fda444bbff8c83ffd108b904fad.html">src</a></li><li class="navelem"><a class="el" href="dir_ab6dd00da65dd782ab1d9660707552bf.html">lib</a></li><li class="navelem"><a class="el" href="dir_eb8bca717218687c1ea60f72768494b0.html">pubkey</a></li><li class="navelem"><a class="el" href="dir_1ea893d6646b3dd1497aed5c66a0bd22.html">newhope</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">newhope.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">* NEWHOPE Ring-LWE scheme</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">* Based on the public domain reference implementation by the</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">* designers (https://github.com/tpoeppelmann/newhope)</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">* Further changes</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">* (C) 2016 Jack Lloyd</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">* Botan is released under the Simplified BSD License (see license.txt)</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;botan/newhope.h&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;botan/hash.h&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;botan/rng.h&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;botan/stream_cipher.h&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;botan/loadstor.h&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_botan.html">Botan</a> {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">typedef</span> newhope_poly poly;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> uint16_t PARAM_Q = 12289;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> PARAM_N = 1024;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/* Incomplete-reduction routines; for details on allowed input ranges</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * and produced output ranges, see the description in the paper:</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * https://cryptojedi.org/papers/#newhope */</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">inline</span> uint16_t montgomery_reduce(uint32_t a)</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;   {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;   <span class="keyword">const</span> uint32_t qinv = 12287; <span class="comment">// -inverse_mod(p,2^18)</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;   <span class="keyword">const</span> uint32_t rlog = 18;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;   <span class="keyword">const</span> uint32_t rlog_mask = ((1 &lt;&lt; rlog) - 1);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;   uint32_t u = (a * qinv);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;   u &amp;= rlog_mask;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;   u *= PARAM_Q;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;   u += a;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;   <span class="keywordflow">return</span> (u &gt;&gt; rlog);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;   }</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">inline</span> uint16_t barrett_reduce(uint16_t a)</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;   {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;   uint32_t u = (<span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(a) * 5) &gt;&gt; 16;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;   u *= PARAM_Q;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;   a -= u;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;   <span class="keywordflow">return</span> a;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;   }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> mul_coefficients(uint16_t* poly, <span class="keyword">const</span> uint16_t* factors)</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; PARAM_N; i++)</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      poly[i] = montgomery_reduce(poly[i] * factors[i]);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   }</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">/* GS_bo_to_no; omegas need to be in Montgomery domain */</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> ntt(uint16_t* a, <span class="keyword">const</span> uint16_t* omega)</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;   {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; 10; i+=2)</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <span class="comment">// Even level</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="keywordtype">size_t</span> distance = (1&lt;&lt;i);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> start = 0; start &lt; distance; start++)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;         {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;         <span class="keywordtype">size_t</span> jTwiddle = 0;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;         <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = start; j &lt; PARAM_N-1; j += 2*distance)</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            uint16_t W = omega[jTwiddle++];</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            uint16_t temp = a[j];</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            a[j] = (temp + a[j + distance]); <span class="comment">// Omit reduction (be lazy)</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            a[j + distance] = montgomery_reduce((W * (static_cast&lt;uint32_t&gt;(temp) + 3*PARAM_Q - a[j + distance])));</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;         }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="comment">// Odd level</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      distance &lt;&lt;= 1;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> start = 0; start &lt; distance; start++)</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;         {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;         <span class="keywordtype">size_t</span> jTwiddle = 0;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;         <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = start; j &lt; PARAM_N-1; j += 2*distance)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            uint16_t W = omega[jTwiddle++];</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            uint16_t temp = a[j];</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            a[j] = barrett_reduce((temp + a[j + distance]));</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            a[j + distance] = montgomery_reduce((W * (static_cast&lt;uint32_t&gt;(temp) + 3*PARAM_Q - a[j + distance])));</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;         }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> poly_frombytes(poly* r, <span class="keyword">const</span> uint8_t* a)</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; PARAM_N/4; i++)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      r-&gt;coeffs[4*i+0] =  a[7*i+0]       | ((<span class="keyword">static_cast&lt;</span>uint16_t<span class="keyword">&gt;</span>(a[7*i+1]) &amp; 0x3f) &lt;&lt; 8);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      r-&gt;coeffs[4*i+1] = (a[7*i+1] &gt;&gt; 6) | (static_cast&lt;uint16_t&gt;(a[7*i+2]) &lt;&lt; 2) | (static_cast&lt;uint16_t&gt;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                         (a[7*i+3] &amp; 0x0f) &lt;&lt; 10);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      r-&gt;coeffs[4*i+2] = (a[7*i+3] &gt;&gt; 4) | (static_cast&lt;uint16_t&gt;(a[7*i+4]) &lt;&lt; 4) | (static_cast&lt;uint16_t&gt;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                         (a[7*i+5] &amp; 0x03) &lt;&lt; 12);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      r-&gt;coeffs[4*i+3] = (a[7*i+5] &gt;&gt; 2) | (static_cast&lt;uint16_t&gt;(a[7*i+6]) &lt;&lt; 6);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> poly_tobytes(uint8_t* r, <span class="keyword">const</span> poly* p)</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;   {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; PARAM_N/4; i++)</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      uint16_t t0 = barrett_reduce(p-&gt;coeffs[4*i+0]); <span class="comment">//Make sure that coefficients have only 14 bits</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      uint16_t t1 = barrett_reduce(p-&gt;coeffs[4*i+1]);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      uint16_t t2 = barrett_reduce(p-&gt;coeffs[4*i+2]);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      uint16_t t3 = barrett_reduce(p-&gt;coeffs[4*i+3]);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      uint16_t m;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      int16_t c;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      m = t0 - PARAM_Q;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      c = m;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      c &gt;&gt;= 15;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      t0 = m ^ ((t0^m)&amp;c); <span class="comment">// &lt;Make sure that coefficients are in [0,q]</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      m = t1 - PARAM_Q;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      c = m;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      c &gt;&gt;= 15;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      t1 = m ^ ((t1^m)&amp;c); <span class="comment">// &lt;Make sure that coefficients are in [0,q]</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      m = t2 - PARAM_Q;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      c = m;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      c &gt;&gt;= 15;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      t2 = m ^ ((t2^m)&amp;c); <span class="comment">// &lt;Make sure that coefficients are in [0,q]</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      m = t3 - PARAM_Q;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      c = m;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      c &gt;&gt;= 15;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      t3 = m ^ ((t3^m)&amp;c); <span class="comment">// &lt;Make sure that coefficients are in [0,q]</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      r[7*i+0] =  t0 &amp; 0xff;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      r[7*i+1] = (t0 &gt;&gt; 8) | (t1 &lt;&lt; 6);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      r[7*i+2] = (t1 &gt;&gt; 2);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      r[7*i+3] = (t1 &gt;&gt; 10) | (t2 &lt;&lt; 4);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      r[7*i+4] = (t2 &gt;&gt; 4);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      r[7*i+5] = (t2 &gt;&gt; 12) | (t3 &lt;&lt; 2);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      r[7*i+6] = (t3 &gt;&gt; 6);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> poly_getnoise(Botan::RandomNumberGenerator&amp; rng, poly* r)</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;   {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   uint8_t buf[4*PARAM_N];</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   rng.randomize(buf, 4*PARAM_N);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; PARAM_N; i++)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keyword">const</span> uint32_t t = <a class="code" href="namespace_botan.html#a2d9442a9a8c4177d35388d0c82f7f2e0">load_le&lt;uint32_t&gt;</a>(buf, i);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      uint32_t d = 0;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; 8; j++)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;         {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;         d += (t &gt;&gt; j) &amp; 0x01010101;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;         }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="keyword">const</span> uint32_t a = ((d &gt;&gt; 8) &amp; 0xff) + (d &amp; 0xff);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keyword">const</span> uint32_t b = (d &gt;&gt; 24) + ((d &gt;&gt; 16) &amp; 0xff);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      r-&gt;coeffs[i] = a + PARAM_Q - b;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;   }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> poly_pointwise(poly* r, <span class="keyword">const</span> poly* a, <span class="keyword">const</span> poly* b)</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;   {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; PARAM_N; i++)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keyword">const</span> uint16_t t = montgomery_reduce(3186*b-&gt;coeffs[i]); <span class="comment">/* t is now in Montgomery domain */</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      r-&gt;coeffs[i] = montgomery_reduce(a-&gt;coeffs[i] * t); <span class="comment">/* r-&gt;coeffs[i] is back in normal domain */</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;   }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> poly_add(poly* r, <span class="keyword">const</span> poly* a, <span class="keyword">const</span> poly* b)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; PARAM_N; i++)</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      r-&gt;coeffs[i] = barrett_reduce(a-&gt;coeffs[i] + b-&gt;coeffs[i]);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> poly_ntt(poly* r)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> uint16_t omegas_montgomery[PARAM_N/2] =</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      4075, 6974, 7373, 7965, 3262, 5079, 522, 2169, 6364, 1018, 1041, 8775, 2344,</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      11011, 5574, 1973, 4536, 1050, 6844, 3860, 3818, 6118, 2683, 1190, 4789,</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      7822, 7540, 6752, 5456, 4449, 3789, 12142, 11973, 382, 3988, 468, 6843, 5339,</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      6196, 3710, 11316, 1254, 5435, 10930, 3998, 10256, 10367, 3879, 11889, 1728,</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      6137, 4948, 5862, 6136, 3643, 6874, 8724, 654, 10302, 1702, 7083, 6760, 56,</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      3199, 9987, 605, 11785, 8076, 5594, 9260, 6403, 4782, 6212, 4624, 9026, 8689,</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      4080, 11868, 6221, 3602, 975, 8077, 8851, 9445, 5681, 3477, 1105, 142, 241,</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      12231, 1003, 3532, 5009, 1956, 6008, 11404, 7377, 2049, 10968, 12097, 7591,</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      5057, 3445, 4780, 2920, 7048, 3127, 8120, 11279, 6821, 11502, 8807, 12138,</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      2127, 2839, 3957, 431, 1579, 6383, 9784, 5874, 677, 3336, 6234, 2766, 1323,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      9115, 12237, 2031, 6956, 6413, 2281, 3969, 3991, 12133, 9522, 4737, 10996,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      4774, 5429, 11871, 3772, 453, 5908, 2882, 1805, 2051, 1954, 11713, 3963,</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      2447, 6142, 8174, 3030, 1843, 2361, 12071, 2908, 3529, 3434, 3202, 7796,</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      2057, 5369, 11939, 1512, 6906, 10474, 11026, 49, 10806, 5915, 1489, 9789,</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      5942, 10706, 10431, 7535, 426, 8974, 3757, 10314, 9364, 347, 5868, 9551,</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      9634, 6554, 10596, 9280, 11566, 174, 2948, 2503, 6507, 10723, 11606, 2459,</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      64, 3656, 8455, 5257, 5919, 7856, 1747, 9166, 5486, 9235, 6065, 835, 3570,</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      4240, 11580, 4046, 10970, 9139, 1058, 8210, 11848, 922, 7967, 1958, 10211,</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      1112, 3728, 4049, 11130, 5990, 1404, 325, 948, 11143, 6190, 295, 11637, 5766,</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      8212, 8273, 2919, 8527, 6119, 6992, 8333, 1360, 2555, 6167, 1200, 7105, 7991,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      3329, 9597, 12121, 5106, 5961, 10695, 10327, 3051, 9923, 4896, 9326, 81,</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      3091, 1000, 7969, 4611, 726, 1853, 12149, 4255, 11112, 2768, 10654, 1062,</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      2294, 3553, 4805, 2747, 4846, 8577, 9154, 1170, 2319, 790, 11334, 9275, 9088,</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      1326, 5086, 9094, 6429, 11077, 10643, 3504, 3542, 8668, 9744, 1479, 1, 8246,</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      7143, 11567, 10984, 4134, 5736, 4978, 10938, 5777, 8961, 4591, 5728, 6461,</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      5023, 9650, 7468, 949, 9664, 2975, 11726, 2744, 9283, 10092, 5067, 12171,</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      2476, 3748, 11336, 6522, 827, 9452, 5374, 12159, 7935, 3296, 3949, 9893,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      4452, 10908, 2525, 3584, 8112, 8011, 10616, 4989, 6958, 11809, 9447, 12280,</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      1022, 11950, 9821, 11745, 5791, 5092, 2089, 9005, 2881, 3289, 2013, 9048,</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      729, 7901, 1260, 5755, 4632, 11955, 2426, 10593, 1428, 4890, 5911, 3932,</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      9558, 8830, 3637, 5542, 145, 5179, 8595, 3707, 10530, 355, 3382, 4231, 9741,</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      1207, 9041, 7012, 1168, 10146, 11224, 4645, 11885, 10911, 10377, 435, 7952,</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      4096, 493, 9908, 6845, 6039, 2422, 2187, 9723, 8643, 9852, 9302, 6022, 7278,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      1002, 4284, 5088, 1607, 7313, 875, 8509, 9430, 1045, 2481, 5012, 7428, 354,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      6591, 9377, 11847, 2401, 1067, 7188, 11516, 390, 8511, 8456, 7270, 545, 8585,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      9611, 12047, 1537, 4143, 4714, 4885, 1017, 5084, 1632, 3066, 27, 1440, 8526,</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      9273, 12046, 11618, 9289, 3400, 9890, 3136, 7098, 8758, 11813, 7384, 3985,</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      11869, 6730, 10745, 10111, 2249, 4048, 2884, 11136, 2126, 1630, 9103, 5407,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      2686, 9042, 2969, 8311, 9424, 9919, 8779, 5332, 10626, 1777, 4654, 10863,</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      7351, 3636, 9585, 5291, 8374, 2166, 4919, 12176, 9140, 12129, 7852, 12286,</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      4895, 10805, 2780, 5195, 2305, 7247, 9644, 4053, 10600, 3364, 3271, 4057,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      4414, 9442, 7917, 2174</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      };</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> uint16_t psis_bitrev_montgomery[PARAM_N] =</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      4075, 6974, 7373, 7965, 3262, 5079, 522, 2169, 6364, 1018, 1041, 8775, 2344,</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      11011, 5574, 1973, 4536, 1050, 6844, 3860, 3818, 6118, 2683, 1190, 4789,</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      7822, 7540, 6752, 5456, 4449, 3789, 12142, 11973, 382, 3988, 468, 6843, 5339,</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      6196, 3710, 11316, 1254, 5435, 10930, 3998, 10256, 10367, 3879, 11889, 1728,</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      6137, 4948, 5862, 6136, 3643, 6874, 8724, 654, 10302, 1702, 7083, 6760, 56,</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      3199, 9987, 605, 11785, 8076, 5594, 9260, 6403, 4782, 6212, 4624, 9026, 8689,</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      4080, 11868, 6221, 3602, 975, 8077, 8851, 9445, 5681, 3477, 1105, 142, 241,</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      12231, 1003, 3532, 5009, 1956, 6008, 11404, 7377, 2049, 10968, 12097, 7591,</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      5057, 3445, 4780, 2920, 7048, 3127, 8120, 11279, 6821, 11502, 8807, 12138,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      2127, 2839, 3957, 431, 1579, 6383, 9784, 5874, 677, 3336, 6234, 2766, 1323,</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      9115, 12237, 2031, 6956, 6413, 2281, 3969, 3991, 12133, 9522, 4737, 10996,</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      4774, 5429, 11871, 3772, 453, 5908, 2882, 1805, 2051, 1954, 11713, 3963,</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      2447, 6142, 8174, 3030, 1843, 2361, 12071, 2908, 3529, 3434, 3202, 7796,</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      2057, 5369, 11939, 1512, 6906, 10474, 11026, 49, 10806, 5915, 1489, 9789,</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      5942, 10706, 10431, 7535, 426, 8974, 3757, 10314, 9364, 347, 5868, 9551,</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      9634, 6554, 10596, 9280, 11566, 174, 2948, 2503, 6507, 10723, 11606, 2459,</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      64, 3656, 8455, 5257, 5919, 7856, 1747, 9166, 5486, 9235, 6065, 835, 3570,</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      4240, 11580, 4046, 10970, 9139, 1058, 8210, 11848, 922, 7967, 1958, 10211,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      1112, 3728, 4049, 11130, 5990, 1404, 325, 948, 11143, 6190, 295, 11637, 5766,</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      8212, 8273, 2919, 8527, 6119, 6992, 8333, 1360, 2555, 6167, 1200, 7105, 7991,</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      3329, 9597, 12121, 5106, 5961, 10695, 10327, 3051, 9923, 4896, 9326, 81,</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      3091, 1000, 7969, 4611, 726, 1853, 12149, 4255, 11112, 2768, 10654, 1062,</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      2294, 3553, 4805, 2747, 4846, 8577, 9154, 1170, 2319, 790, 11334, 9275, 9088,</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      1326, 5086, 9094, 6429, 11077, 10643, 3504, 3542, 8668, 9744, 1479, 1, 8246,</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      7143, 11567, 10984, 4134, 5736, 4978, 10938, 5777, 8961, 4591, 5728, 6461,</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      5023, 9650, 7468, 949, 9664, 2975, 11726, 2744, 9283, 10092, 5067, 12171,</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      2476, 3748, 11336, 6522, 827, 9452, 5374, 12159, 7935, 3296, 3949, 9893,</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      4452, 10908, 2525, 3584, 8112, 8011, 10616, 4989, 6958, 11809, 9447, 12280,</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      1022, 11950, 9821, 11745, 5791, 5092, 2089, 9005, 2881, 3289, 2013, 9048,</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      729, 7901, 1260, 5755, 4632, 11955, 2426, 10593, 1428, 4890, 5911, 3932,</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      9558, 8830, 3637, 5542, 145, 5179, 8595, 3707, 10530, 355, 3382, 4231, 9741,</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      1207, 9041, 7012, 1168, 10146, 11224, 4645, 11885, 10911, 10377, 435, 7952,</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      4096, 493, 9908, 6845, 6039, 2422, 2187, 9723, 8643, 9852, 9302, 6022, 7278,</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      1002, 4284, 5088, 1607, 7313, 875, 8509, 9430, 1045, 2481, 5012, 7428, 354,</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      6591, 9377, 11847, 2401, 1067, 7188, 11516, 390, 8511, 8456, 7270, 545, 8585,</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      9611, 12047, 1537, 4143, 4714, 4885, 1017, 5084, 1632, 3066, 27, 1440, 8526,</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      9273, 12046, 11618, 9289, 3400, 9890, 3136, 7098, 8758, 11813, 7384, 3985,</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      11869, 6730, 10745, 10111, 2249, 4048, 2884, 11136, 2126, 1630, 9103, 5407,</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      2686, 9042, 2969, 8311, 9424, 9919, 8779, 5332, 10626, 1777, 4654, 10863,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      7351, 3636, 9585, 5291, 8374, 2166, 4919, 12176, 9140, 12129, 7852, 12286,</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      4895, 10805, 2780, 5195, 2305, 7247, 9644, 4053, 10600, 3364, 3271, 4057,</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      4414, 9442, 7917, 2174, 3947, 11951, 2455, 6599, 10545, 10975, 3654, 2894,</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      7681, 7126, 7287, 12269, 4119, 3343, 2151, 1522, 7174, 7350, 11041, 2442,</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      2148, 5959, 6492, 8330, 8945, 5598, 3624, 10397, 1325, 6565, 1945, 11260,</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      10077, 2674, 3338, 3276, 11034, 506, 6505, 1392, 5478, 8778, 1178, 2776,</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      3408, 10347, 11124, 2575, 9489, 12096, 6092, 10058, 4167, 6085, 923, 11251,</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      11912, 4578, 10669, 11914, 425, 10453, 392, 10104, 8464, 4235, 8761, 7376,</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      2291, 3375, 7954, 8896, 6617, 7790, 1737, 11667, 3982, 9342, 6680, 636, 6825,</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      7383, 512, 4670, 2900, 12050, 7735, 994, 1687, 11883, 7021, 146, 10485, 1403,</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      5189, 6094, 2483, 2054, 3042, 10945, 3981, 10821, 11826, 8882, 8151, 180,</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      9600, 7684, 5219, 10880, 6780, 204, 11232, 2600, 7584, 3121, 3017, 11053,</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      7814, 7043, 4251, 4739, 11063, 6771, 7073, 9261, 2360, 11925, 1928, 11825,</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      8024, 3678, 3205, 3359, 11197, 5209, 8581, 3238, 8840, 1136, 9363, 1826,</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      3171, 4489, 7885, 346, 2068, 1389, 8257, 3163, 4840, 6127, 8062, 8921, 612,</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      4238, 10763, 8067, 125, 11749, 10125, 5416, 2110, 716, 9839, 10584, 11475,</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      11873, 3448, 343, 1908, 4538, 10423, 7078, 4727, 1208, 11572, 3589, 2982,</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      1373, 1721, 10753, 4103, 2429, 4209, 5412, 5993, 9011, 438, 3515, 7228, 1218,</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      8347, 5232, 8682, 1327, 7508, 4924, 448, 1014, 10029, 12221, 4566, 5836,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      12229, 2717, 1535, 3200, 5588, 5845, 412, 5102, 7326, 3744, 3056, 2528, 7406,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      8314, 9202, 6454, 6613, 1417, 10032, 7784, 1518, 3765, 4176, 5063, 9828,</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      2275, 6636, 4267, 6463, 2065, 7725, 3495, 8328, 8755, 8144, 10533, 5966,</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      12077, 9175, 9520, 5596, 6302, 8400, 579, 6781, 11014, 5734, 11113, 11164,</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      4860, 1131, 10844, 9068, 8016, 9694, 3837, 567, 9348, 7000, 6627, 7699, 5082,</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      682, 11309, 5207, 4050, 7087, 844, 7434, 3769, 293, 9057, 6940, 9344, 10883,</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      2633, 8190, 3944, 5530, 5604, 3480, 2171, 9282, 11024, 2213, 8136, 3805, 767,</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      12239, 216, 11520, 6763, 10353, 7, 8566, 845, 7235, 3154, 4360, 3285, 10268,</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      2832, 3572, 1282, 7559, 3229, 8360, 10583, 6105, 3120, 6643, 6203, 8536,</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      8348, 6919, 3536, 9199, 10891, 11463, 5043, 1658, 5618, 8787, 5789, 4719,</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      751, 11379, 6389, 10783, 3065, 7806, 6586, 2622, 5386, 510, 7628, 6921, 578,</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      10345, 11839, 8929, 4684, 12226, 7154, 9916, 7302, 8481, 3670, 11066, 2334,</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      1590, 7878, 10734, 1802, 1891, 5103, 6151, 8820, 3418, 7846, 9951, 4693, 417,</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      9996, 9652, 4510, 2946, 5461, 365, 881, 1927, 1015, 11675, 11009, 1371,</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      12265, 2485, 11385, 5039, 6742, 8449, 1842, 12217, 8176, 9577, 4834, 7937,</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      9461, 2643, 11194, 3045, 6508, 4094, 3451, 7911, 11048, 5406, 4665, 3020,</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      6616, 11345, 7519, 3669, 5287, 1790, 7014, 5410, 11038, 11249, 2035, 6125,</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      10407, 4565, 7315, 5078, 10506, 2840, 2478, 9270, 4194, 9195, 4518, 7469,</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      1160, 6878, 2730, 10421, 10036, 1734, 3815, 10939, 5832, 10595, 10759, 4423,</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      8420, 9617, 7119, 11010, 11424, 9173, 189, 10080, 10526, 3466, 10588, 7592,</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      3578, 11511, 7785, 9663, 530, 12150, 8957, 2532, 3317, 9349, 10243, 1481,</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      9332, 3454, 3758, 7899, 4218, 2593, 11410, 2276, 982, 6513, 1849, 8494, 9021,</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      4523, 7988, 8, 457, 648, 150, 8000, 2307, 2301, 874, 5650, 170, 9462, 2873,</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      9855, 11498, 2535, 11169, 5808, 12268, 9687, 1901, 7171, 11787, 3846, 1573,</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      6063, 3793, 466, 11259, 10608, 3821, 6320, 4649, 6263, 2929</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      };</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   mul_coefficients(r-&gt;coeffs, psis_bitrev_montgomery);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   ntt(r-&gt;coeffs, omegas_montgomery);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> bitrev_vector(uint16_t* poly)</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> uint16_t bitrev_table[1024] =</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      0, 512, 256, 768, 128, 640, 384, 896, 64, 576, 320, 832, 192, 704, 448, 960, 32, 544, 288, 800, 160, 672, 416, 928, 96, 608, 352, 864, 224, 736, 480, 992,</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      16, 528, 272, 784, 144, 656, 400, 912, 80, 592, 336, 848, 208, 720, 464, 976, 48, 560, 304, 816, 176, 688, 432, 944, 112, 624, 368, 880, 240, 752, 496, 1008,</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      8, 520, 264, 776, 136, 648, 392, 904, 72, 584, 328, 840, 200, 712, 456, 968, 40, 552, 296, 808, 168, 680, 424, 936, 104, 616, 360, 872, 232, 744, 488, 1000,</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      24, 536, 280, 792, 152, 664, 408, 920, 88, 600, 344, 856, 216, 728, 472, 984, 56, 568, 312, 824, 184, 696, 440, 952, 120, 632, 376, 888, 248, 760, 504, 1016,</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      4, 516, 260, 772, 132, 644, 388, 900, 68, 580, 324, 836, 196, 708, 452, 964, 36, 548, 292, 804, 164, 676, 420, 932, 100, 612, 356, 868, 228, 740, 484, 996,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      20, 532, 276, 788, 148, 660, 404, 916, 84, 596, 340, 852, 212, 724, 468, 980, 52, 564, 308, 820, 180, 692, 436, 948, 116, 628, 372, 884, 244, 756, 500, 1012,</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      12, 524, 268, 780, 140, 652, 396, 908, 76, 588, 332, 844, 204, 716, 460, 972, 44, 556, 300, 812, 172, 684, 428, 940, 108, 620, 364, 876, 236, 748, 492, 1004,</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      28, 540, 284, 796, 156, 668, 412, 924, 92, 604, 348, 860, 220, 732, 476, 988, 60, 572, 316, 828, 188, 700, 444, 956, 124, 636, 380, 892, 252, 764, 508, 1020,</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      2, 514, 258, 770, 130, 642, 386, 898, 66, 578, 322, 834, 194, 706, 450, 962, 34, 546, 290, 802, 162, 674, 418, 930, 98, 610, 354, 866, 226, 738, 482, 994,</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      18, 530, 274, 786, 146, 658, 402, 914, 82, 594, 338, 850, 210, 722, 466, 978, 50, 562, 306, 818, 178, 690, 434, 946, 114, 626, 370, 882, 242, 754, 498, 1010,</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      10, 522, 266, 778, 138, 650, 394, 906, 74, 586, 330, 842, 202, 714, 458, 970, 42, 554, 298, 810, 170, 682, 426, 938, 106, 618, 362, 874, 234, 746, 490, 1002,</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      26, 538, 282, 794, 154, 666, 410, 922, 90, 602, 346, 858, 218, 730, 474, 986, 58, 570, 314, 826, 186, 698, 442, 954, 122, 634, 378, 890, 250, 762, 506, 1018,</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      6, 518, 262, 774, 134, 646, 390, 902, 70, 582, 326, 838, 198, 710, 454, 966, 38, 550, 294, 806, 166, 678, 422, 934, 102, 614, 358, 870, 230, 742, 486, 998,</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      22, 534, 278, 790, 150, 662, 406, 918, 86, 598, 342, 854, 214, 726, 470, 982, 54, 566, 310, 822, 182, 694, 438, 950, 118, 630, 374, 886, 246, 758, 502, 1014,</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      14, 526, 270, 782, 142, 654, 398, 910, 78, 590, 334, 846, 206, 718, 462, 974, 46, 558, 302, 814, 174, 686, 430, 942, 110, 622, 366, 878, 238, 750, 494, 1006,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      30, 542, 286, 798, 158, 670, 414, 926, 94, 606, 350, 862, 222, 734, 478, 990, 62, 574, 318, 830, 190, 702, 446, 958, 126, 638, 382, 894, 254, 766, 510, 1022,</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      1, 513, 257, 769, 129, 641, 385, 897, 65, 577, 321, 833, 193, 705, 449, 961, 33, 545, 289, 801, 161, 673, 417, 929, 97, 609, 353, 865, 225, 737, 481, 993,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      17, 529, 273, 785, 145, 657, 401, 913, 81, 593, 337, 849, 209, 721, 465, 977, 49, 561, 305, 817, 177, 689, 433, 945, 113, 625, 369, 881, 241, 753, 497, 1009,</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      9, 521, 265, 777, 137, 649, 393, 905, 73, 585, 329, 841, 201, 713, 457, 969, 41, 553, 297, 809, 169, 681, 425, 937, 105, 617, 361, 873, 233, 745, 489, 1001,</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      25, 537, 281, 793, 153, 665, 409, 921, 89, 601, 345, 857, 217, 729, 473, 985, 57, 569, 313, 825, 185, 697, 441, 953, 121, 633, 377, 889, 249, 761, 505, 1017,</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      5, 517, 261, 773, 133, 645, 389, 901, 69, 581, 325, 837, 197, 709, 453, 965, 37, 549, 293, 805, 165, 677, 421, 933, 101, 613, 357, 869, 229, 741, 485, 997,</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      21, 533, 277, 789, 149, 661, 405, 917, 85, 597, 341, 853, 213, 725, 469, 981, 53, 565, 309, 821, 181, 693, 437, 949, 117, 629, 373, 885, 245, 757, 501, 1013,</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      13, 525, 269, 781, 141, 653, 397, 909, 77, 589, 333, 845, 205, 717, 461, 973, 45, 557, 301, 813, 173, 685, 429, 941, 109, 621, 365, 877, 237, 749, 493, 1005,</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      29, 541, 285, 797, 157, 669, 413, 925, 93, 605, 349, 861, 221, 733, 477, 989, 61, 573, 317, 829, 189, 701, 445, 957, 125, 637, 381, 893, 253, 765, 509, 1021,</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      3, 515, 259, 771, 131, 643, 387, 899, 67, 579, 323, 835, 195, 707, 451, 963, 35, 547, 291, 803, 163, 675, 419, 931, 99, 611, 355, 867, 227, 739, 483, 995,</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      19, 531, 275, 787, 147, 659, 403, 915, 83, 595, 339, 851, 211, 723, 467, 979, 51, 563, 307, 819, 179, 691, 435, 947, 115, 627, 371, 883, 243, 755, 499, 1011,</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      11, 523, 267, 779, 139, 651, 395, 907, 75, 587, 331, 843, 203, 715, 459, 971, 43, 555, 299, 811, 171, 683, 427, 939, 107, 619, 363, 875, 235, 747, 491, 1003,</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      27, 539, 283, 795, 155, 667, 411, 923, 91, 603, 347, 859, 219, 731, 475, 987, 59, 571, 315, 827, 187, 699, 443, 955, 123, 635, 379, 891, 251, 763, 507, 1019,</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      7, 519, 263, 775, 135, 647, 391, 903, 71, 583, 327, 839, 199, 711, 455, 967, 39, 551, 295, 807, 167, 679, 423, 935, 103, 615, 359, 871, 231, 743, 487, 999,</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      23, 535, 279, 791, 151, 663, 407, 919, 87, 599, 343, 855, 215, 727, 471, 983, 55, 567, 311, 823, 183, 695, 439, 951, 119, 631, 375, 887, 247, 759, 503, 1015,</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      15, 527, 271, 783, 143, 655, 399, 911, 79, 591, 335, 847, 207, 719, 463, 975, 47, 559, 303, 815, 175, 687, 431, 943, 111, 623, 367, 879, 239, 751, 495, 1007,</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      31, 543, 287, 799, 159, 671, 415, 927, 95, 607, 351, 863, 223, 735, 479, 991, 63, 575, 319, 831, 191, 703, 447, 959, 127, 639, 383, 895, 255, 767, 511, 1023</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      };</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; PARAM_N; i++)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keyword">const</span> uint16_t r = bitrev_table[i];</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">if</span>(i &lt; r)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;         {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;         <span class="keyword">const</span> uint16_t tmp = poly[i];</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;         poly[i] = poly[r];</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;         poly[r] = tmp;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;         }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;   }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> poly_invntt(poly* r)</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> uint16_t omegas_inv_montgomery[PARAM_N/2] =</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      4075, 5315, 4324, 4916, 10120, 11767, 7210, 9027, 10316, 6715, 1278, 9945,</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      3514, 11248, 11271, 5925, 147, 8500, 7840, 6833, 5537, 4749, 4467, 7500,</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      11099, 9606, 6171, 8471, 8429, 5445, 11239, 7753, 9090, 12233, 5529, 5206,</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      10587, 1987, 11635, 3565, 5415, 8646, 6153, 6427, 7341, 6152, 10561, 400,</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      8410, 1922, 2033, 8291, 1359, 6854, 11035, 973, 8579, 6093, 6950, 5446,</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      11821, 8301, 11907, 316, 52, 3174, 10966, 9523, 6055, 8953, 11612, 6415,</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      2505, 5906, 10710, 11858, 8332, 9450, 10162, 151, 3482, 787, 5468, 1010,</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      4169, 9162, 5241, 9369, 7509, 8844, 7232, 4698, 192, 1321, 10240, 4912, 885,</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      6281, 10333, 7280, 8757, 11286, 58, 12048, 12147, 11184, 8812, 6608, 2844,</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      3438, 4212, 11314, 8687, 6068, 421, 8209, 3600, 3263, 7665, 6077, 7507, 5886,</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      3029, 6695, 4213, 504, 11684, 2302, 1962, 1594, 6328, 7183, 168, 2692, 8960,</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      4298, 5184, 11089, 6122, 9734, 10929, 3956, 5297, 6170, 3762, 9370, 4016,</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      4077, 6523, 652, 11994, 6099, 1146, 11341, 11964, 10885, 6299, 1159, 8240,</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      8561, 11177, 2078, 10331, 4322, 11367, 441, 4079, 11231, 3150, 1319, 8243,</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      709, 8049, 8719, 11454, 6224, 3054, 6803, 3123, 10542, 4433, 6370, 7032,</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      3834, 8633, 12225, 9830, 683, 1566, 5782, 9786, 9341, 12115, 723, 3009, 1693,</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      5735, 2655, 2738, 6421, 11942, 2925, 1975, 8532, 3315, 11863, 4754, 1858,</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      1583, 6347, 2500, 10800, 6374, 1483, 12240, 1263, 1815, 5383, 10777, 350,</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      6920, 10232, 4493, 9087, 8855, 8760, 9381, 218, 9928, 10446, 9259, 4115,</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      6147, 9842, 8326, 576, 10335, 10238, 10484, 9407, 6381, 11836, 8517, 418,</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      6860, 7515, 1293, 7552, 2767, 156, 8298, 8320, 10008, 5876, 5333, 10258,</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      10115, 4372, 2847, 7875, 8232, 9018, 8925, 1689, 8236, 2645, 5042, 9984,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      7094, 9509, 1484, 7394, 3, 4437, 160, 3149, 113, 7370, 10123, 3915, 6998,</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      2704, 8653, 4938, 1426, 7635, 10512, 1663, 6957, 3510, 2370, 2865, 3978,</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      9320, 3247, 9603, 6882, 3186, 10659, 10163, 1153, 9405, 8241, 10040, 2178,</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      1544, 5559, 420, 8304, 4905, 476, 3531, 5191, 9153, 2399, 8889, 3000, 671,</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      243, 3016, 3763, 10849, 12262, 9223, 10657, 7205, 11272, 7404, 7575, 8146,</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      10752, 242, 2678, 3704, 11744, 5019, 3833, 3778, 11899, 773, 5101, 11222,</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      9888, 442, 2912, 5698, 11935, 4861, 7277, 9808, 11244, 2859, 3780, 11414,</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      4976, 10682, 7201, 8005, 11287, 5011, 6267, 2987, 2437, 3646, 2566, 10102,</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      9867, 6250, 5444, 2381, 11796, 8193, 4337, 11854, 1912, 1378, 404, 7644,</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      1065, 2143, 11121, 5277, 3248, 11082, 2548, 8058, 8907, 11934, 1759, 8582,</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      3694, 7110, 12144, 6747, 8652, 3459, 2731, 8357, 6378, 7399, 10861, 1696,</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      9863, 334, 7657, 6534, 11029, 4388, 11560, 3241, 10276, 9000, 9408, 3284,</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      10200, 7197, 6498, 544, 2468, 339, 11267, 9, 2842, 480, 5331, 7300, 1673,</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      4278, 4177, 8705, 9764, 1381, 7837, 2396, 8340, 8993, 4354, 130, 6915, 2837,</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      11462, 5767, 953, 8541, 9813, 118, 7222, 2197, 3006, 9545, 563, 9314, 2625,</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      11340, 4821, 2639, 7266, 5828, 6561, 7698, 3328, 6512, 1351, 7311, 6553,</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      8155, 1305, 722, 5146, 4043, 12288, 10810, 2545, 3621, 8747, 8785, 1646,</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      1212, 5860, 3195, 7203, 10963, 3201, 3014, 955, 11499, 9970, 11119, 3135,</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      3712, 7443, 9542, 7484, 8736, 9995, 11227, 1635, 9521, 1177, 8034, 140,</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      10436, 11563, 7678, 4320, 11289, 9198, 12208, 2963, 7393, 2366, 9238</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      };</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> uint16_t psis_inv_montgomery[PARAM_N] =</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      256, 10570, 1510, 7238, 1034, 7170, 6291, 7921, 11665, 3422, 4000, 2327,</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      2088, 5565, 795, 10647, 1521, 5484, 2539, 7385, 1055, 7173, 8047, 11683,</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      1669, 1994, 3796, 5809, 4341, 9398, 11876, 12230, 10525, 12037, 12253, 3506,</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      4012, 9351, 4847, 2448, 7372, 9831, 3160, 2207, 5582, 2553, 7387, 6322, 9681,</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      1383, 10731, 1533, 219, 5298, 4268, 7632, 6357, 9686, 8406, 4712, 9451,</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      10128, 4958, 5975, 11387, 8649, 11769, 6948, 11526, 12180, 1740, 10782, 6807,</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      2728, 7412, 4570, 4164, 4106, 11120, 12122, 8754, 11784, 3439, 5758, 11356,</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      6889, 9762, 11928, 1704, 1999, 10819, 12079, 12259, 7018, 11536, 1648, 1991,</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      2040, 2047, 2048, 10826, 12080, 8748, 8272, 8204, 1172, 1923, 7297, 2798,</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      7422, 6327, 4415, 7653, 6360, 11442, 12168, 7005, 8023, 9924, 8440, 8228,</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      2931, 7441, 1063, 3663, 5790, 9605, 10150, 1450, 8985, 11817, 10466, 10273,</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      12001, 3470, 7518, 1074, 1909, 7295, 9820, 4914, 702, 5367, 7789, 8135, 9940,</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      1420, 3714, 11064, 12114, 12264, 1752, 5517, 9566, 11900, 1700, 3754, 5803,</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      829, 1874, 7290, 2797, 10933, 5073, 7747, 8129, 6428, 6185, 11417, 1631, 233,</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      5300, 9535, 10140, 11982, 8734, 8270, 2937, 10953, 8587, 8249, 2934, 9197,</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      4825, 5956, 4362, 9401, 1343, 3703, 529, 10609, 12049, 6988, 6265, 895, 3639,</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      4031, 4087, 4095, 585, 10617, 8539, 4731, 4187, 9376, 3095, 9220, 10095,</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      10220, 1460, 10742, 12068, 1724, 5513, 11321, 6884, 2739, 5658, 6075, 4379,</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      11159, 10372, 8504, 4726, 9453, 3106, 7466, 11600, 10435, 8513, 9994, 8450,</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      9985, 3182, 10988, 8592, 2983, 9204, 4826, 2445, 5616, 6069, 867, 3635, 5786,</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      11360, 5134, 2489, 10889, 12089, 1727, 7269, 2794, 9177, 1311, 5454, 9557,</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      6632, 2703, 9164, 10087, 1441, 3717, 531, 3587, 2268, 324, 5313, 759, 1864,</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      5533, 2546, 7386, 9833, 8427, 4715, 11207, 1601, 7251, 4547, 11183, 12131,</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      1733, 10781, 10318, 1474, 10744, 5046, 4232, 11138, 10369, 6748, 964, 7160,</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      4534, 7670, 8118, 8182, 4680, 11202, 6867, 981, 8918, 1274, 182, 26, 7026,</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      8026, 11680, 12202, 10521, 1503, 7237, 4545, 5916, 9623, 8397, 11733, 10454,</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      3249, 9242, 6587, 941, 1890, 270, 10572, 6777, 9746, 6659, 6218, 6155, 6146,</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      878, 1881, 7291, 11575, 12187, 1741, 7271, 8061, 11685, 6936, 4502, 9421,</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      4857, 4205, 7623, 1089, 10689, 1527, 8996, 10063, 11971, 10488, 6765, 2722,</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      3900, 9335, 11867, 6962, 11528, 5158, 4248, 4118, 5855, 2592, 5637, 6072,</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      2623, 7397, 8079, 9932, 4930, 5971, 853, 3633, 519, 8852, 11798, 3441, 11025,</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      1575, 225, 8810, 11792, 12218, 3501, 9278, 3081, 9218, 4828, 7712, 8124,</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      11694, 12204, 3499, 4011, 573, 3593, 5780, 7848, 9899, 10192, 1456, 208,</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      7052, 2763, 7417, 11593, 10434, 12024, 8740, 11782, 10461, 3250, 5731, 7841,</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      9898, 1414, 202, 3540, 7528, 2831, 2160, 10842, 5060, 4234, 4116, 588, 84,</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      12, 7024, 2759, 9172, 6577, 11473, 1639, 9012, 3043, 7457, 6332, 11438, 1634,</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      1989, 9062, 11828, 8712, 11778, 12216, 10523, 6770, 9745, 10170, 4964, 9487,</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      6622, 946, 8913, 6540, 6201, 4397, 9406, 8366, 9973, 8447, 8229, 11709, 8695,</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      10020, 3187, 5722, 2573, 10901, 6824, 4486, 4152, 9371, 8361, 2950, 2177,</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      311, 1800, 9035, 8313, 11721, 3430, 490, 70, 10, 1757, 251, 3547, 7529,</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      11609, 3414, 7510, 4584, 4166, 9373, 1339, 5458, 7802, 11648, 1664, 7260,</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      9815, 10180, 6721, 9738, 10169, 8475, 8233, 9954, 1422, 8981, 1283, 5450,</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      11312, 1616, 3742, 11068, 10359, 4991, 713, 3613, 9294, 8350, 4704, 672, 96,</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      7036, 9783, 11931, 3460, 5761, 823, 10651, 12055, 10500, 1500, 5481, 783,</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      3623, 11051, 8601, 8251, 8201, 11705, 10450, 5004, 4226, 7626, 2845, 2162,</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      3820, 7568, 9859, 3164, 452, 10598, 1514, 5483, 6050, 6131, 4387, 7649, 8115,</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      6426, 918, 8909, 8295, 1185, 5436, 11310, 8638, 1234, 5443, 11311, 5127,</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      2488, 2111, 10835, 5059, 7745, 2862, 3920, 560, 80, 1767, 2008, 3798, 11076,</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      6849, 2734, 10924, 12094, 8750, 1250, 10712, 6797, 971, 7161, 1023, 8924,</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      4786, 7706, 4612, 4170, 7618, 6355, 4419, 5898, 11376, 10403, 10264, 6733,</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      4473, 639, 5358, 2521, 9138, 3061, 5704, 4326, 618, 5355, 765, 5376, 768,</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      7132, 4530, 9425, 3102, 9221, 6584, 11474, 10417, 10266, 12000, 6981, 6264,</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      4406, 2385, 7363, 4563, 4163, 7617, 9866, 3165, 9230, 11852, 10471, 5007,</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      5982, 11388, 5138, 734, 3616, 11050, 12112, 6997, 11533, 12181, 10518, 12036,</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      3475, 2252, 7344, 9827, 4915, 9480, 6621, 4457, 7659, 9872, 6677, 4465, 4149,</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      7615, 4599, 657, 3605, 515, 10607, 6782, 4480, 640, 1847, 3775, 5806, 2585,</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      5636, 9583, 1369, 10729, 8555, 10000, 11962, 5220, 7768, 8132, 8184, 9947,</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      1421, 203, 29, 8782, 11788, 1684, 10774, 10317, 4985, 9490, 8378, 4708,</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      11206, 5112, 5997, 7879, 11659, 12199, 8765, 10030, 4944, 5973, 6120, 6141,</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      6144, 7900, 11662, 1666, 238, 34, 3516, 5769, 9602, 8394, 9977, 6692, 956,</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      10670, 6791, 9748, 11926, 8726, 11780, 5194, 742, 106, 8793, 10034, 3189,</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      10989, 5081, 4237, 5872, 4350, 2377, 10873, 6820, 6241, 11425, 10410, 10265,</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      3222, 5727, 9596, 4882, 2453, 2106, 3812, 11078, 12116, 5242, 4260, 11142,</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      8614, 11764, 12214, 5256, 4262, 4120, 11122, 5100, 11262, 5120, 2487, 5622,</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      9581, 8391, 8221, 2930, 10952, 12098, 6995, 6266, 9673, 4893, 699, 3611,</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      4027, 5842, 11368, 1624, 232, 8811, 8281, 1183, 169, 8802, 3013, 2186, 5579,</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      797, 3625, 4029, 11109, 1587, 7249, 11569, 8675, 6506, 2685, 10917, 12093,</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      12261, 12285, 1755, 7273, 1039, 1904, 272, 3550, 9285, 3082, 5707, 6082,</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      4380, 7648, 11626, 5172, 4250, 9385, 8363, 8217, 4685, 5936, 848, 8899, 6538,</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      934, 1889, 3781, 9318, 10109, 10222, 6727, 961, 5404, 772, 5377, 9546, 8386,</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      1198, 8949, 3034, 2189, 7335, 4559, 5918, 2601, 10905, 5069, 9502, 3113,</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      7467, 8089, 11689, 5181, 9518, 8382, 2953, 3933, 4073, 4093, 7607, 8109,</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      2914, 5683, 4323, 11151, 1593, 10761, 6804, 972, 3650, 2277, 5592, 4310,</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      7638, 9869, 4921, 703, 1856, 9043, 4803, 9464, 1352, 8971, 11815, 5199, 7765,</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      6376, 4422, 7654, 2849, 407, 8836, 6529, 7955, 2892, 9191, 1313, 10721,</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      12065, 12257, 1751, 9028, 8312, 2943, 2176, 3822, 546, 78, 8789, 11789,</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      10462, 12028, 6985, 4509, 9422, 1346, 5459, 4291, 613, 10621, 6784, 9747,</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      3148, 7472, 2823, 5670, 810, 7138, 8042, 4660, 7688, 6365, 6176, 6149, 2634,</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      5643, 9584, 10147, 11983, 5223, 9524, 11894, 10477, 8519, 1217, 3685, 2282,</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      326, 10580, 3267, 7489, 4581, 2410, 5611, 11335, 6886, 8006, 8166, 11700,</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      3427, 11023, 8597, 10006, 3185, 455, 65, 5276, 7776, 4622, 5927, 7869, 9902,</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      11948, 5218, 2501, 5624, 2559, 10899, 1557, 1978, 10816, 10323, 8497, 4725,</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      675, 1852, 10798, 12076, 10503, 3256, 9243, 3076, 2195, 10847, 12083, 10504,</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      12034, 10497</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      };</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;   bitrev_vector(r-&gt;coeffs);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;   ntt(r-&gt;coeffs, omegas_inv_montgomery);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;   mul_coefficients(r-&gt;coeffs, psis_inv_montgomery);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;   }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> encode_a(uint8_t* r, <span class="keyword">const</span> poly* pk, <span class="keyword">const</span> uint8_t* seed)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;   {</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   poly_tobytes(r, pk);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; NEWHOPE_SEED_BYTES; i++)</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      r[NEWHOPE_POLY_BYTES+i] = seed[i];</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> decode_a(poly* pk, uint8_t* seed, <span class="keyword">const</span> uint8_t* r)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   poly_frombytes(pk, r);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; NEWHOPE_SEED_BYTES; i++)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      seed[i] = r[NEWHOPE_POLY_BYTES+i];</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> encode_b(uint8_t* r, <span class="keyword">const</span> poly* b, <span class="keyword">const</span> poly* c)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;   poly_tobytes(r, b);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; PARAM_N/4; i++)</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      r[NEWHOPE_POLY_BYTES+i] = c-&gt;coeffs[4*i] | (c-&gt;coeffs[4*i+1] &lt;&lt; 2) | (c-&gt;coeffs[4*i+2] &lt;&lt; 4) | (c-&gt;coeffs[4*i+3] &lt;&lt; 6);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;   }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> decode_b(poly* b, poly* c, <span class="keyword">const</span> uint8_t* r)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;   {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;   poly_frombytes(b, r);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; PARAM_N/4; i++)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      {</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      c-&gt;coeffs[4*i+0] =  r[NEWHOPE_POLY_BYTES+i]       &amp; 0x03;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      c-&gt;coeffs[4*i+1] = (r[NEWHOPE_POLY_BYTES+i] &gt;&gt; 2) &amp; 0x03;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      c-&gt;coeffs[4*i+2] = (r[NEWHOPE_POLY_BYTES+i] &gt;&gt; 4) &amp; 0x03;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      c-&gt;coeffs[4*i+3] = (r[NEWHOPE_POLY_BYTES+i] &gt;&gt; 6);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      }</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keyword">inline</span> int32_t ct_abs(int32_t v)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;   int32_t <a class="code" href="namespace_q_web_socket_protocol.html#aea90bd0da715cf6b30e614c8891e09ad">mask</a> = v &gt;&gt; 31;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <span class="keywordflow">return</span> (v ^ mask) - <a class="code" href="namespace_q_web_socket_protocol.html#aea90bd0da715cf6b30e614c8891e09ad">mask</a>;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   }</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keyword">inline</span> int32_t f(int32_t* v0, int32_t* v1, int32_t x)</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   {</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   int32_t xit, t, r, b;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <span class="comment">// Next 6 lines compute t = x/PARAM_Q;</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   b = x*2730;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   t = b &gt;&gt; 25;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   b = x - t*12289;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   b = 12288 - b;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   b &gt;&gt;= 31;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;   t -= b;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;   r = t &amp; 1;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   xit = (t&gt;&gt;1);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;   *v0 = xit+r; <span class="comment">// v0 = round(x/(2*PARAM_Q))</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   t -= 1;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;   r = t &amp; 1;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   *v1 = (t&gt;&gt;1)+r;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;   <span class="keywordflow">return</span> ct_abs(x-((*v0)*2*PARAM_Q));</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> helprec(poly* c, <span class="keyword">const</span> poly* v, RandomNumberGenerator&amp; rng)</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;   uint8_t rand[32];</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   rng.randomize(rand, 32);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; 256; i++)</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      int32_t v0[4], v1[4];</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      uint8_t rbit = (rand[i&gt;&gt;3] &gt;&gt; (i&amp;7)) &amp; 1;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      int32_t k;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      k  = f(v0+0, v1+0, 8*v-&gt;coeffs[  0+i] + 4*rbit);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      k += f(v0+1, v1+1, 8*v-&gt;coeffs[256+i] + 4*rbit);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      k += f(v0+2, v1+2, 8*v-&gt;coeffs[512+i] + 4*rbit);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      k += f(v0+3, v1+3, 8*v-&gt;coeffs[768+i] + 4*rbit);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      k = (2*PARAM_Q-1-k) &gt;&gt; 31;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      int32_t v_tmp[4];</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      v_tmp[0] = ((~k) &amp; v0[0]) ^ (k &amp; v1[0]);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      v_tmp[1] = ((~k) &amp; v0[1]) ^ (k &amp; v1[1]);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      v_tmp[2] = ((~k) &amp; v0[2]) ^ (k &amp; v1[2]);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      v_tmp[3] = ((~k) &amp; v0[3]) ^ (k &amp; v1[3]);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      c-&gt;coeffs[  0+i] = (v_tmp[0] -   v_tmp[3]) &amp; 3;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      c-&gt;coeffs[256+i] = (v_tmp[1] -   v_tmp[3]) &amp; 3;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      c-&gt;coeffs[512+i] = (v_tmp[2] -   v_tmp[3]) &amp; 3;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      c-&gt;coeffs[768+i] = (-   k    + 2*v_tmp[3]) &amp; 3;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keyword">inline</span> int32_t g(int32_t x)</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;   {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   int32_t t, c, b;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   <span class="comment">// Next 6 lines compute t = x/(4*PARAM_Q);</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;   b = x*2730;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   t = b &gt;&gt; 27;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   b = x - t*49156;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;   b = 49155 - b;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   b &gt;&gt;= 31;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;   t -= b;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   c = t &amp; 1;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;   t = (t &gt;&gt; 1) + c; <span class="comment">// t = round(x/(8*PARAM_Q))</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;   t *= 8*PARAM_Q;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;   <span class="keywordflow">return</span> ct_abs(t - x);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;   }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="keyword">inline</span> int16_t LDDecode(int32_t xi0, int32_t xi1, int32_t xi2, int32_t xi3)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;   {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;   int32_t t;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   t  = g(xi0);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;   t += g(xi1);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;   t += g(xi2);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;   t += g(xi3);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;   t -= 8*PARAM_Q;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;   t &gt;&gt;= 31;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   <span class="keywordflow">return</span> t&amp;1;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> rec(uint8_t* key, <span class="keyword">const</span> poly* v, <span class="keyword">const</span> poly* c)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;   {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   <a class="code" href="namespace_botan.html#aeb6cf2051aa89f9d76cf4d55c126b314">clear_mem</a>(key, 32);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; 256; i++)</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keyword">const</span> int32_t tmp0 = 16*PARAM_Q + 8*<span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(v-&gt;coeffs[  0+i]) - PARAM_Q * (2*c-&gt;coeffs[  0+i]+c-&gt;coeffs[768+i]);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keyword">const</span> int32_t tmp1 = 16*PARAM_Q + 8*<span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(v-&gt;coeffs[256+i]) - PARAM_Q * (2*c-&gt;coeffs[256+i]+c-&gt;coeffs[768+i]);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keyword">const</span> int32_t tmp2 = 16*PARAM_Q + 8*<span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(v-&gt;coeffs[512+i]) - PARAM_Q * (2*c-&gt;coeffs[512+i]+c-&gt;coeffs[768+i]);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="keyword">const</span> int32_t tmp3 = 16*PARAM_Q + 8*<span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(v-&gt;coeffs[768+i]) - PARAM_Q * (c-&gt;coeffs[768+i]);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      key[i&gt;&gt;3] |= LDDecode(tmp0, tmp1, tmp2, tmp3) &lt;&lt; (i &amp; 7);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;   }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="keywordtype">void</span> gen_a(poly* a, <span class="keyword">const</span> uint8_t* seed, <a class="code" href="namespace_botan.html#a42a70d7cfb95e4f7773d3b52dc98ad61">Newhope_Mode</a> mode)</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;   {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;   std::vector&lt;uint8_t&gt; buf(168*16);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;   std::unique_ptr&lt;StreamCipher&gt; xof;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;   <span class="keywordflow">if</span>(mode == Newhope_Mode::BoringSSL)</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      xof = StreamCipher::create_or_throw(<span class="stringliteral">&quot;CTR-BE(AES-128)&quot;</span>);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      xof-&gt;set_key(seed, 16);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      xof-&gt;set_iv(seed + 16, 16);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      xof = StreamCipher::create_or_throw(<span class="stringliteral">&quot;SHAKE-128&quot;</span>);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      xof-&gt;set_key(seed, NEWHOPE_SEED_BYTES);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      }</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;   <a class="code" href="namespace_botan.html#a09ce987463cc4e1b7682f31bb486fdb1">zeroise</a>(buf);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;   xof-&gt;encrypt(buf);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   <span class="keywordtype">size_t</span> pos = 0, ctr = 0;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   <span class="keywordflow">while</span>(ctr &lt; PARAM_N)</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      {</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="comment">// Specialized for q = 12889</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keyword">const</span> uint16_t val = (buf[pos] | (<span class="keyword">static_cast&lt;</span>uint16_t<span class="keyword">&gt;</span>(buf[pos+1]) &lt;&lt; 8)) &amp; 0x3fff;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="keywordflow">if</span>(val &lt; PARAM_Q)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;         {</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;         a-&gt;coeffs[ctr++] = val;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;         }</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      pos += 2;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="keywordflow">if</span>(pos &gt;= buf.size())</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;         {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;         <a class="code" href="namespace_botan.html#a09ce987463cc4e1b7682f31bb486fdb1">zeroise</a>(buf);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;         xof-&gt;encrypt(buf);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;         pos = 0;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;         }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;   }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;}</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">// API FUNCTIONS</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="keywordtype">void</span> newhope_keygen(uint8_t* send, poly* sk, RandomNumberGenerator&amp; rng,</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                    <a class="code" href="namespace_botan.html#a42a70d7cfb95e4f7773d3b52dc98ad61">Newhope_Mode</a> mode)</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;   poly a, e, r, pk;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;   uint8_t seed[NEWHOPE_SEED_BYTES];</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;   rng.randomize(seed, NEWHOPE_SEED_BYTES);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;   gen_a(&amp;a, seed, mode);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;   poly_getnoise(rng, sk);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;   poly_ntt(sk);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;   poly_getnoise(rng, &amp;e);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;   poly_ntt(&amp;e);</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;   poly_pointwise(&amp;r, sk, &amp;a);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;   poly_add(&amp;pk, &amp;e, &amp;r);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;   encode_a(send, &amp;pk, seed);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;   }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="keywordtype">void</span> newhope_sharedb(uint8_t* sharedkey, uint8_t* send, <span class="keyword">const</span> uint8_t* received,</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                     RandomNumberGenerator&amp; rng,</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                     <a class="code" href="namespace_botan.html#a42a70d7cfb95e4f7773d3b52dc98ad61">Newhope_Mode</a> mode)</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;   {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   poly sp, ep, v, a, pka, c, epp, bp;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;   uint8_t seed[NEWHOPE_SEED_BYTES];</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;   decode_a(&amp;pka, seed, received);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   gen_a(&amp;a, seed, mode);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;   poly_getnoise(rng, &amp;sp);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   poly_ntt(&amp;sp);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   poly_getnoise(rng, &amp;ep);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   poly_ntt(&amp;ep);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   poly_pointwise(&amp;bp, &amp;a, &amp;sp);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;   poly_add(&amp;bp, &amp;bp, &amp;ep);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;   poly_pointwise(&amp;v, &amp;pka, &amp;sp);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;   poly_invntt(&amp;v);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   poly_getnoise(rng, &amp;epp);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   poly_add(&amp;v, &amp;v, &amp;epp);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   helprec(&amp;c, &amp;v, rng);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   encode_b(send, &amp;bp, &amp;c);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   rec(sharedkey, &amp;v, &amp;c);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;   <span class="keyword">const</span> std::string kdf_hash = (mode == Newhope_Mode::SHA3) ? <span class="stringliteral">&quot;SHA-3(256)&quot;</span> : <span class="stringliteral">&quot;SHA-256&quot;</span>;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;   std::unique_ptr&lt;HashFunction&gt; hash = HashFunction::create_or_throw(kdf_hash);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   hash-&gt;update(sharedkey, 32);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;   hash-&gt;final(sharedkey);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="keywordtype">void</span> newhope_shareda(uint8_t sharedkey[],</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                     <span class="keyword">const</span> poly* sk,</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                     <span class="keyword">const</span> uint8_t received[],</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                     <a class="code" href="namespace_botan.html#a42a70d7cfb95e4f7773d3b52dc98ad61">Newhope_Mode</a> mode)</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;   {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;   poly v, bp, c;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;   decode_b(&amp;bp, &amp;c, received);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;   poly_pointwise(&amp;v, sk, &amp;bp);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;   poly_invntt(&amp;v);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;   rec(sharedkey, &amp;v, &amp;c);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;   <span class="keyword">const</span> std::string kdf_hash = (mode == Newhope_Mode::SHA3) ? <span class="stringliteral">&quot;SHA-3(256)&quot;</span> : <span class="stringliteral">&quot;SHA-256&quot;</span>;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   std::unique_ptr&lt;HashFunction&gt; hash = HashFunction::create_or_throw(kdf_hash);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;   hash-&gt;update(sharedkey, 32);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;   hash-&gt;final(sharedkey);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;   }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;}</div><div class="ttc" id="namespace_botan_html_a09ce987463cc4e1b7682f31bb486fdb1"><div class="ttname"><a href="namespace_botan.html#a09ce987463cc4e1b7682f31bb486fdb1">Botan::zeroise</a></div><div class="ttdeci">void zeroise(std::vector&lt; T, Alloc &gt; &amp;vec)</div><div class="ttdef"><b>Definition:</b> <a href="secmem_8h_source.html#l00160">secmem.h:160</a></div></div>
<div class="ttc" id="namespace_q_web_socket_protocol_html_aea90bd0da715cf6b30e614c8891e09ad"><div class="ttname"><a href="namespace_q_web_socket_protocol.html#aea90bd0da715cf6b30e614c8891e09ad">QWebSocketProtocol::mask</a></div><div class="ttdeci">void Q_AUTOTEST_EXPORT mask(QByteArray *payload, quint32 maskingKey)</div><div class="ttdef"><b>Definition:</b> <a href="qwebsocketprotocol_8cpp_source.html#l00193">qwebsocketprotocol.cpp:193</a></div></div>
<div class="ttc" id="namespace_botan_html"><div class="ttname"><a href="namespace_botan.html">Botan</a></div><div class="ttdef"><b>Definition:</b> <a href="botan_2src_2cli_2cli_8h_source.html#l00019">cli.h:19</a></div></div>
<div class="ttc" id="namespace_botan_html_aeb6cf2051aa89f9d76cf4d55c126b314"><div class="ttname"><a href="namespace_botan.html#aeb6cf2051aa89f9d76cf4d55c126b314">Botan::clear_mem</a></div><div class="ttdeci">void clear_mem(T *ptr, size_t n)</div><div class="ttdef"><b>Definition:</b> <a href="mem__ops_8h_source.html#l00097">mem_ops.h:97</a></div></div>
<div class="ttc" id="namespace_botan_html_a2d9442a9a8c4177d35388d0c82f7f2e0"><div class="ttname"><a href="namespace_botan.html#a2d9442a9a8c4177d35388d0c82f7f2e0">Botan::load_le&lt; uint32_t &gt;</a></div><div class="ttdeci">uint32_t load_le&lt; uint32_t &gt;(const uint8_t in[], size_t off)</div><div class="ttdef"><b>Definition:</b> <a href="loadstor_8h_source.html#l00196">loadstor.h:196</a></div></div>
<div class="ttc" id="namespace_botan_html_a42a70d7cfb95e4f7773d3b52dc98ad61"><div class="ttname"><a href="namespace_botan.html#a42a70d7cfb95e4f7773d3b52dc98ad61">Botan::Newhope_Mode</a></div><div class="ttdeci">Newhope_Mode</div><div class="ttdef"><b>Definition:</b> <a href="newhope_8h_source.html#l00058">newhope.h:58</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
